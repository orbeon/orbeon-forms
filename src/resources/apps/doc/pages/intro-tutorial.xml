<?xml version="1.0" encoding="windows-1252"?>
<!--
    Copyright (C) 2006 Orbeon, Inc.

    The Orbeon documentation is not distributed under the LGPL license. Use of the documentation is
    subject to the following terms:

    * Conversion to other formats is allowed, but the actual content may not be altered or edited
      in any way.

    * You may create printed copies for your own personal use.

    * For all other uses, such as selling printed copies or using (parts of) the manual in another
      publication, prior written agreement from Orbeon, Inc. is required.

    Please contact Orbeon at info@orbeon.com for more information.
-->
<document>
    <header>
        <title>Orbeon Forms Tutorial</title>
    </header>
    <body>
        <section>
            <title>What is this?</title>
            <p>
                This is the tutorial for Orbeon Forms version 3.5.
            </p>
            <p>
                If you have questions, issues or suggestions related to this tutorial, please send a message to the
                <code>ops-users</code> mailing-list. It is easy to subscribe by following the instructions at <a
                href="http://www.orbeon.com/forms/mailing-list">http://www.orbeon.com/forms/mailing-list</a>.
            </p>
        </section>
        <a name="background"/>
        <section>
            <title>A Little Bit of Background</title>
            <section>
                <title>What Orbeon Forms Does for You</title>
                <p>
                    Orbeon Forms is an open source solution to build and deploy web forms. For more information, please
                    visit the Orbeon home page at <a href="http://www.orbeon.com/">http://www.orbeon.com/</a>.
                </p>
            </section>
            <section>
                <title>Prerequisites</title>
                <p>
                    To go through this tutorial, you don't need much: any reasonably modern computer on which you can
                    install Java 1.5 or 1.6 should do (Java 1.4.2 may work for you but 1.5 or 1.6 is strongly
                    recommended). You should be comfortable with installing new software on your computer, including
                    uncompressing zip or gzip archives. You will also have to edit XML files. If you are familiar with
                    HTML, this should not be a problem.
                </p>
                <p>
                    You also need a reasonably recent web browser. We recommend one of the following browsers:
                </p>
                <ul>
                    <li>
                        <p>
                            Mozilla Firefox 1.5 or 2 or greater.
                        </p>
                    </li>
                    <li>
                        <p>
                            Safari 2 or greater.
                        </p>
                    </li>
                    <li>
                        <p>
                            Opera 9 or greater.
                        </p>
                    </li>
                    <li>
                        <p>
                            Internet Explorer 6 or 7 or greater.
                        </p>
                    </li>
                </ul>
                <p>
                    You will <i>not</i> have to:
                </p>
                <ul>
                    <li>
                        <p>
                             Write any Java code or any scripting language code.
                        </p>
                    </li>
                    <li>
                        <p>
                            Use a compiler or other complicated build tool.
                        </p>
                    </li>
                    <li>
                        <p>
                            Install browser plugins or any other client-side software, besides your regular web browser!
                        </p>
                    </li>
                </ul>
            </section>
            <section>
                <title>Principles of Orbeon Forms</title>
                <p>
                    Orbeon Forms follows a few principles:
                </p>
                <ul>
                    <li>
                        <p>
                            <b>More standards.</b> You use standards whenever possible. For example, Orbeon Forms
                            applications are created using XForms and XHTML, which are W3C standards.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>Less scripting.</b> You write most applications without writing Java, JavaScript, or
                            other scripting code. (But you can if you really want.)
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>Instant gratification.</b> You get instant gratification by making changes to your
                            application and just reloading your page in your web browser. (You don't need to "compile"
                            or "build".)
                        </p>
                    </li>
                    <!--<li>-->
                        <!--<p>-->
                            <!--Orbeon Forms aims at "convention over configuration" and the "DRY" concept (don't repeat-->
                            <!--yourself).-->
                        <!--</p>-->
                    <!--</li>-->
                </ul>
            </section>
        </section>
        <a name="installing"/>
        <section>
            <title>Installing and Configuring Orbeon Forms</title>
            <a name="installing-java"/>
            <section>
                <title>Downloading and Installing Java</title>
                <p>
                    Java provides the cross-platform environment in which Orbeon Forms runs.
                </p>
                <p>
                    If you don't have Java installed yet, download it from the Sun web site at <a
                    href="http://java.sun.com/javase/downloads/index.jsp">http://java.sun.com/javase/downloads/index.jsp</a>.
                    Sun provides Windows, Linux and Solaris versions. If you use a Mac with Mac OS X, you probably have
                    Java already installed on your machine, but if not visit <a
                    href="http://www.apple.com/macosx/features/java/">http://www.apple.com/macosx/features/java/</a>.
                    Then follow the instructions to install Java.
                </p>
            </section>
            <a name="installing-tomcat"/>
            <section>
                <title>Downloading and Installing Apache Tomcat</title>
                <p>
                    Tomcat is the container application into which Orbeon Forms deploys. Follow these steps to download
                    and install Tomcat if you don't have it installed yet:
                </p>
                <ol>
                    <li>
                        <p>
                            Download Tomcat 5.5 from the Apache web site at <a
                            href="http://tomcat.apache.org/download-55.cgi">http://tomcat.apache.org/download-55.cgi</a>.
                        </p>
                    </li>
                    <li>
                        <p>
                            Install Tomcat as per the instructions. If you downloaded the installer version (Windows
                            only), run the installer. If you downloaded a compressed archive, uncompress it to the
                            location of your choice. We call the install location <code>TOMCAT_HOME</code> (on
                            windows, this could be <code>c:/Program Files/Apache/Tomcat</code>, on a Unix system,
                            <code>/home/jdoe/tomcat</code>, etc.).
                        </p>
                    </li>
                    <li>
                        <p>
                            Check that your Tomcat installation is working correctly:
                        </p>
                        <ul>
                            <li>
                                <p>
                                    Run the Tomcat startup script under <code>TOMCAT_HOME/bin</code>
                                    (<code>startup.sh</code> or <code>startup.bat</code> depending on your platform), or
                                    start Tomcat with the control application (Windows only).
                                </p>
                            </li>
                            <li>
                                <p>
                                    Open a web browser and access the following URL:
                                </p>
                                <xml-source>
                                    http://localhost:8080/
                                </xml-source>
                                <p>
                                    You should see the Tomcat welcome page.
                                </p>
                                <figure src="../apps/doc/images/tutorial/01.png"/>
                            </li>
                        </ul>
                    </li>
                </ol>
                <note>
                    <p>
                        We recommend using Tomcat for this tutorial, but Orbeon Forms can deploy into containers other
                        than Tomcat.
                    </p>
                </note>
            </section>
            <a name="installing-orbeon-forms"/>
            <section>
                <title>Downloading and Installing Orbeon Forms</title>
                <p>
                    Follow these steps to download and install Orbeon Forms:
                </p>
                <ol>
                    <li>
                        <p>
                            Download Orbeon Forms 3.5 or later from <a
                            href="http://www.orbeon.com/forms/download">http://www.orbeon.com/forms/download</a>.
                        </p>
                    </li>
                    <li>
                        <p>
                            Uncompress the archive into a directory of your choice. We call that directory
                            <code>ORBEON_FORMS_HOME</code>.
                        </p>
                    </li>
                    <li>
                        <p>
                            Under <code>ORBEON_FORMS_HOME</code>, you find a file called <code>ops.war</code>. This
                            is the file to deploy into Tomcat. To do so, just copy it under
                            <code>TOMCAT_HOME/webapps</code> (alternatively, if you know what you are doing, you can
                            uncompress it at a location of your choice and configure a context in
                            <code>TOMCAT_HOME/conf/server.xml</code>). The <code>webapps</code> directory is already
                            present after you have installed Tomcat.
                        </p>
                    </li>
                </ol>
            </section>
            <a name="testing-setup"/>
            <section>
                <title>Testing your setup</title>
                <p>
                    Make sure you restart Tomcat (run the shutdown script under <code>TOMCAT_HOME/bin</code>, and then
                    the startup script again). Then open up with a web browser the following URL:
                </p>
                <xml-source>
                    http://localhost:8080/ops/
                </xml-source>
                <p>
                    You should see the Orbeon Forms welcome page:
                </p>
                <figure src="../apps/doc/images/tutorial/02.png"/>
                <p>
                    You can now navigate the list of sample applications listed on the left side. You can see the source
                    code of each application directly in your web browser by selecting the "View Source Code" tab at
                    the top of the page to open up the Orbeon Forms Source Viewer:
                </p>
                <figure src="../apps/doc/images/tutorial/00.png"/>
            </section>
        </section>
        <a name="hello-application"/>
        <section>
            <title>The Hello Application</title>
            <a name="running-hello"/>
            <section>
                <title>Running the Hello Application</title>
                <p>
                    The Hello application is about the simplest Orbeon Forms application you can think of. It asks for
                    your name and displays it back. You run the Hello application by selecting the link "XForms Hello"
                    in the list of applications. Here are direct links for running XForms Hello <a
                    href="/xforms-hello/">on your local Orbeon Forms install</a> or <a
                    href="http://www.orbeon.com/ops/xforms-hello/">online on the Orbeon web site</a>.
                </p>
                <p>
                    Simply enter your first name in the input field, for example "Joe". You should promptly see a
                    message underneath saying "Hello, Joe!".
                </p>
                <figure src="../apps/doc/images/tutorial/03.png"/>
                <p>
                    You can directly view the source code from your web browser by selecting the "View Source Code"
                    tab. There you see:
                </p>
                <figure src="../apps/doc/images/tutorial/04.png"/>
                <ul>
                    <li>
                        <p>
                            <code>view.xhtml</code>: this is the XHTML and XForms code for the Hello application.
                        </p>
                    </li>
                    <li>
                        <p>
                            <code>page-flow.xml</code>: this is the page flow for the Hello application. The main task
                            of a page flow is mapping external URLs (as typed in a web browser) to Orbeon Forms pages.
                        </p>
                    </li>
                </ul>
            </section>
            <a name="hello-source-code"/>
            <section>
                <title>The Source Code</title>
                <p>
                    You are now ready to look at the source code of the Hello application. This will give you an idea of
                    what an Orbeon Forms application looks like. First, select <code>view.xhtml</code> to make the
                    source code for that file appear on the right:
                </p>
                <xml-source show-namespaces="true">
                    <html xmlns="http://www.w3.org/1999/xhtml"
                          xmlns:xforms="http://www.w3.org/2002/xforms">
                        <head>
                            <title>XForms Hello</title>
                            <xforms:model>
                                <xforms:instance>
                                    <first-name xmlns=""/>
                                </xforms:instance>
                            </xforms:model>
                        </head>
                        <body>
                            <p>
                                Please enter your first name:
                                <xforms:input ref="/first-name" incremental="true"/>
                            </p>
                            <p>
                                <xforms:output value="if (normalize-space(/first-name) = '') then '' else concat('Hello, ', /first-name, '!')"/>
                            </p>
                        </body>
                    </html>
                </xml-source>
                <p>
                    The first thing you notice is that this looks very much like HTML (notice the <code>&lt;html></code>
                    tag). But in fact, this is XHTML, the XML-compatible version of XHTML. There are only a few
                    differences that matter between HTML and XHTML, in particular you must close all your tags and use
                    quotes around attributes. Also, you must place your tags in a <i>namespace</i>, which is why the
                    <code>&lt;html></code> tag features the <code>xmlns="http://www.w3.org/1999/xhtml"</code>
                    <i>namespace declaration</i>.
                </p>
                <p>
                    Another difference with plain HTML is that there are tags that start with the string
                    <code>xforms:</code>. Those are defined by the <a href="http://www.w3.org/TR/xforms/">XForms
                    specification</a> from W3C. They are at the heart of Orbeon Forms and enable all the cool forms
                    features that you see in Orbeon Forms demos. (In order to use XForms tags that start with
                    <code>xforms:</code>, you must add another namespace declaration on the <code>&lt;html></code> tag:
                    <code>xmlns:xforms="http://www.w3.org/2002/xforms"</code>.)
                </p>
                <p>
                     Using XForms in Orbeon Forms means that you don't have to use HTML forms at all. The benefit is
                     that XForms is much more powerful than HTML forms, as you will see in this tutorial.
                </p>
                <p>
                    You notice a tag called <code>&lt;xforms:model></code>. Because XForms follows a
                    Model-View-Controller (MVC) approach, most XForms pages contain one or more <i>models</i> that
                    usually encapsulate other XForms markup. You place these models under the XHTML
                    <code>&lt;head></code> tag.
                </p>
                <p>
                    Note that from now on, we prefer the term <i>element</i> to the term <i>tag</i>. An element is an
                    XML term that includes the start tag and end tag, and can have content such as other elements and
                    text.
                </p>
                <p>
                    With XForms, you store the data captured by controls such as input fields, combo boxes, etc. as text
                    contained within XML elements or attributes. Consider the following XML document containing a
                    single element called <code>first-name</code>.
                </p>
                <xml-source>
                    <first-name/>
                </xml-source>
                <p>
                    The <code>first-name</code> element is <i>empty</i>. Contrast with:
                </p>
                <xml-source>
                    <first-name>Joe</first-name>
                </xml-source>
                <p>
                    The element now contains the string "Joe". Notice how in <code>view.xhtml</code> the XML document
                    is encapsulated within an <code>&lt;xforms:instance></code> element:
                </p>
                <xml-source show-namespaces="true" ignore-root-element="true">
                    <html xmlns="http://www.w3.org/1999/xhtml" xmlns:xforms="http://www.w3.org/2002/xforms">
                        <xforms:instance>
                            <first-name xmlns=""/>
                        </xforms:instance>
                    </html>
                </xml-source>
                <p>
                    Also notice the special <code>xmlns=""</code> namespace attribute on <code>&lt;first-name></code>:
                    this is necessary because the root element of the XHTML document defines a default namespace with
                    <code>xmlns="http://www.w3.org/1999/xhtml"</code>. Because we want to make it clear that the element
                    <code>&lt;first-name></code> is not an XHTML element, but an element in no namespace, we add
                    <code>xmlns=""</code> to that element. If your instance document must be in no particular namespace,
                    you are always safe to add <code>xmlns=""</code> on the root element of that instance.
                </p>
                <p>
                    This element defines an XForms <i>instance</i>, which is just XForms' way of calling an XML document
                    used to store data.
                </p>
                <p>
                    Now consider the remaining XForms elements in the source file: <code>&lt;xforms:input></code> and
                    <code>&lt;xforms:output></code>. These two elements are not located under the XHTML
                    <code>&lt;head></code>, but under <code>&lt;body></code>. They are part of the <i>view</i> of your
                    page, in other words these elements directly help define visible controls on the page. Consider
                    <code>&lt;xforms:input></code>:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:input ref="/first-name" incremental="true" xmlns:xforms="http://www.w3.org/2002/xforms"/>
                </xml-source>
                <p>
                    You guessed that this element allows the user to <i>input</i> information.
                    <code>&lt;xforms:input></code> is usually displayed to the user as an input field. The
                    <code>ref</code> attribute is the magic that connects the input field to the XForms instance. It
                    contains an <i>XPath expression</i>, which in this case just looks like a file path. In this case,
                    <code>/first-name</code> points to the element called <code>first-name</code>, which happens to be
                    the only element we have in the XForms instance. Using the <code>ref</code> attribute this way is
                    called a <i>binding</i> and means two things:
                </p>
                <ul>
                    <li>
                        <p>
                            When the user enters text in the input field, the text is saved into the element called
                            <code>first-name</code>.
                        </p>
                    </li>
                    <li>
                        <p>
                            It also goes the other way: if somehow the text content of <code>first-name</code> in the
                            XForms instance changes, this is automatically reflected in the input field.
                        </p>
                    </li>
                </ul>
                <p>
                    Now consider <code>&lt;xforms:output></code>. As you guess from the name of the element, this simply
                    displays a value on screen. If you have tried running the Hello application, you have probably
                    guessed the logic that is being implemented: if the first name entered by the user is not a blank
                    string, then we display the "Hello" message followed by the first name and then an exclamation mark.
                    Otherwise if the first name consists only of spaces, we just display a blank string. The idea is to
                    avoid displaying things like "Hello !" without an actual first name.
                </p>
                <p>
                    With many client-side libraries, you express this type of logic with JavaScript. With XForms, you
                    use XPath instead. This means that you need to learn at least a few bits of the XPath syntax. While
                    XPath may be different from what you already know (it is based on expressions and definitely
                    targeted at XML), it is in fact a smaller language than JavaScript.
                </p>
                <p>
                    So how do you hook-up the logic within <code>&lt;xforms:output></code>? Here, instead of a
                    <code>ref</code> attribute, we use a <code>value</code> attribute. Like <code>ref</code>,
                    <code>value</code> takes an XPath expression, but it doesn't actually create a binding to instance
                    data: it just returns a string. The XPath is as follows:
                </p>
                <xml-source>
                    if (normalize-space(/first-name) = '') then '' else concat('Hello, ', /first-name, '!')
                </xml-source>
                <p>
                    A few things to point out:
                </p>
                <ul>
                    <li>
                        <p>
                            The main expression has the form <code>if () then ... else ...</code>. (This is actually an
                            XPath 2.0 expression, which supports the <code>if</code> construct.)
                        </p>
                    </li>
                    <li>
                        <p>
                            The <code>normalize-space()</code> function removes all leading and trailing space (and
                            simplifies internal spaces as well). This is a little trick to not only test whether the
                            first name is empty, but also to test whether it is an all-blank string.
                        </p>
                    </li>
                    <li>
                        <p>
                            Contrary to JavaScript, the equality test is expressed with a single <code>=</code> instead
                            of <code>==</code>.
                        </p>
                    </li>
                    <li>
                        <p>
                           The <code>concat</code> function concatenates all its parameters into a resulting string. It
                           is like the JavaScript <code>+</code> operator on strings.
                        </p>
                    </li>
                    <li>
                        <p>
                            Note the use of the single quote <code>'</code> around strings. This is needed because the
                            XPath expression is put within double quotes <code>"</code> in the <code>value</code>
                            attribute.
                        </p>
                    </li>
                </ul>
            </section>
            <a name="hello-page-flow"/>
            <section>
                <title>Page Flow</title>
                <p>
                    If you look at your browser's URL bar when showing the example, you notice that it looks like this:
                </p>
                <xml-source>
                    http://localhost:8080/ops/xforms-hello/
                </xml-source>
                <ul>
                    <li>
                        <p>
                            The first part of the URL, <code>http://localhost:8080/</code>, is self-explanatory: it
                            depends on what host and port your server is running.
                        </p>
                    </li>
                    <li>
                        <p>
                            The next part, <code>ops</code>, depends on what context you install Orbeon Forms into. By
                            default, because the WAR file is called <code>ops.war</code>, the context is
                            <code>ops</code>. (You could as well configure your container to use a different context, or
                            an empty (default) context.)
                        </p>
                    </li>
                    <li>
                        <p>
                            The last part, <code>/xforms-hello/</code>, automatically matches the name of the directory
                            you store your application into (more on this later when you look at the source code). This
                            causes the application's page flow (<code>page-flow.xml</code>) to run.
                        </p>
                    </li>
                </ul>
                <p>
                    So now look at <code>page-flow.xml</code> for the Hello application. It is very simple:
                </p>
                <xml-source show-namespaces="true">
                    <config xmlns="http://www.orbeon.com/oxf/controller">
                        <page path-info="*" view="view.xhtml"/>
                        <epilogue url="oxf:/config/epilogue.xpl"/>
                    </config>
                </xml-source>
                <p>
                    The important line in this page flow is this one:
                </p>
                <xml-source show-namespaces="false">
                    <page path-info="*" view="view.xhtml"/>
                </xml-source>
                <p>
                    It tells Orbeon Forms that any path (notice the wildcard <code>*</code>) sent by the web browser to
                    this application causes the page view stored in <code>view.xhtml</code> to be processed. You can
                    check this by entering the following path in your browser:
                </p>
                <xml-source>
                    http://localhost:8080/ops/xforms-hello/my-page
                </xml-source>
                <p>
                    The exact same result shows! Of course, page flows make the most sense when you have more than one
                    page in your application, which translates into more than one <code>&lt;page></code> element.
                </p>
            </section>
            <a name="orbeon-forms-resources"/>
            <section>
                <title>Orbeon Forms Resources</title>
                <p>
                    Under <code>TOMCAT_HOME/webapps/ops</code>, you find a <code>WEB-INF</code> directory. That
                    directory, in turn, contains a <code>resources</code> directory. We refer to that
                    <code>resources</code> directory as <code>RESOURCES</code> below.
                </p>
                <p>
                    The <code>RESOURCES</code> directory is very important: this is where your application lives.
                    This directory is called "resources" because it contains all the files (or resources) such as XHTML
                    documents, XML schemas, images, CSS, etc. needed by your Orbeon Forms application.
                </p>
                <note>
                    Orbeon Forms supports storing your resources pretty much anywhere you want. For convenience, by
                    default they are available under the WAR file's <code>WEB-INF/resources</code> so you can get up
                    and running without configuration.
                </note>
            </section>
            <a name="directory-structure"/>
            <section>
                <title>A Look Into the Resources Directory Structure</title>
                <p>
                    Under <code>RESOURCES</code>, you see the following files and directories:
                </p>
                <ul>
                    <li>
                        <p>
                            <code>apps</code> directory: contains one sub-directory for each application currently
                            running in Orbeon Forms. By default, it contains a series of sample applications - the ones
                            that you see on the left side of your screen when you start Orbeon Forms. Notice a directory
                            called <code>xforms-hello</code>: this is the directory that contains the Hello application.
                        </p>
                    </li>
                    <li>
                        <p>
                            <code>config</code> directory: contains several configuration files that you can modify if
                            needed. For now, you don't need to worry about this directory.
                        </p>
                    </li>
                    <li>
                        <p>
                            <code>page-flow.xml</code> file: the top-level page flow file. You should not worry about
                            this file just yet. Just know that by default, it is in charge of deciding which application
                            to run depending on the application name in the URL that you enter in your web browser.
                        </p>
                    </li>
                    <li>
                        <p>
                            <code>apps-list.xml</code> file: contains the list of sample applications to display on the
                            left side of the screen. This is not needed by your own application.
                        </p>
                    </li>
                </ul>
            </section>
            <a name="playing-with-source-code"/>
            <section>
                <title>Playing with the Hello Application Source Code</title>
                <p>
                    You find the application under <code>RESOURCES/apps/xforms-hello</code>. That directory contains
                    the two files that you have seen earlier through the Source Code Viewer in your web browser. Again,
                    the name <code>xforms-hello</code> is important and matches the <code>xforms-hello</code> part of
                    the URL in your web browser: <code>http://localhost:8080/ops/xforms-hello/</code>.
                </p>
                <note>
                    <p>
                        In this tutorial, you will often have to "reload" pages in your web browser to see the effects
                        of your changes to XHTML or XForms markup. Because of the way Orbeon Forms handles page reloads
                        with XForms, for consistent results we recommend that you don't simply use your browser's reload
                        button, but instead use one of the following two ways to reload a page:
                    </p>
                    <ul>
                        <li>
                            <p>
                                Position your text cursor on your browser's URL bar and press the "Enter" key. Browsers
                                often have keyboard shortcuts such as <code>CTRL-L</code> or <code>CMD-L</code> to
                                reach the URL bar.
                            </p>
                        </li>
                        <li>
                            <p>
                                Use your browser's "force reload" feature. This is often enabled by pressing the
                                <code>SHIFT</code> key and pressing the "reload" button at the same time. Browsers often
                                have keyboard shortcuts such as <code>CTRL-F5</code>, <code>CTRL-SHIFT-R</code>, or
                                <code>CMD-SHIFT-R</code> to perform this operation.
                            </p>
                        </li>
                    </ul>
                </note>
                <p>
                    Now, modify <code>view.xhtml</code>:
                </p>
                <ul>
                    <li>
                        <p>
                            Open <code>view.xhtml</code> in a text editor.
                        </p>
                    </li>
                    <li>
                        <p>
                            Modify the string "Please enter your first name:" with "Your name here:".
                        </p>
                    </li>
                    <li>
                        <p>
                            Save <code>view.xhtml</code>.
                        </p>
                    </li>
                    <li>
                        <p>
                             Go back to the Hello application in your web browser and reload the page. You should see
                             the new text appear:
                        </p>
                        <figure src="../apps/doc/images/tutorial/05.png"/>
                    </li>
                    <li>
                        <p>
                            Repeat the experience but add some XForms. For example, add a second
                            <code>&lt;xforms:input></code> right after the first one:
                        </p>
                        <xml-source show-namespaces="true" xmlns:xforms="http://www.w3.org/2002/xforms">
                            <xforms:input ref="/first-name" incremental="true"/>
                            <xforms:input ref="/first-name" incremental="true"/>
                        </xml-source>
                        <p>
                           Reload the page, and notice, as you type in an input field, how the other one updates as you
                           type. This happens because the two fields are bound to the same instance data. The
                           <code>incremental="true"</code> attribute allows the changes to occur as you type, instead of
                           occurring when you focus in and out of fields:
                        </p>
                        <figure src="../apps/doc/images/tutorial/06.png"/>
                    </li>
                </ul>
                <p>
                    You notice that you get instant gratification with Orbeon forms: just change files on disk, reload
                    your page, and your changes are taken into account with no compilation or other complex deployment.
                </p>
            </section>
        </section>
        <a name="bookcast-application"/>
        <section>
            <title>The Bookcast Application</title>
            <section>
                <title>What is it?</title>
                <p>
                    In this section, you will create a more complete XForms application: the Bookcast application. The
                    Bookcast application allows you to keep track of information about books you have read. For each
                    book, you enter information such as title, author, language, and your own comments. The information
                    is persisted so you can access it again. Then you can do cool things with the available data such
                    create an Atom feed of your entries.
                </p>
                <figure src="../apps/doc/images/tutorial/07.png"/>
                <p>
                    You can run the final application <a href="/xforms-bookcast/">on your local Orbeon Forms install</a> or <a
                    href="http://www.orbeon.com/ops/xforms-bookcast/">online on the Orbeon web site</a>.
                </p>
            </section>
            <a name="bookcast-getting-started"/>
            <section>
                <title>Getting Started</title>
                <p>
                    But first things first. Start by making a first functional page:
                </p>
                <ul>
                    <li>
                        <p>
                            The first thing to do is to create a new directory for your application. Orbeon Forms
                            already come with the complete <code>xforms-bookcast</code> application, so instead let's
                            decide on another name, for example <code>my-bookcast</code>. Create a directory with that
                            name as <code>RESOURCES/apps/my-bookcast</code>. For convenience, we refer to that new
                            directory as the <code>BOOKCAST</code> directory below.
                        </p>
                    </li>
                    <li>
                        <p>
                            Create a <code>page-flow.xml</code> file under <code>BOOKCAST</code>:
                        </p>
                        <xml-source>
                            <config xmlns="http://www.orbeon.com/oxf/controller">

                                <page path-info="/my-bookcast/" view="view.xhtml"/>

                                <epilogue url="oxf:/config/epilogue.xpl"/>

                            </config>
                        </xml-source>
                        <p>
                            This page flow is automatically called for any path that starts with
                            <code>/ops/my-bookcast/</code>. Here, it matches on the exact path
                            <code>/ops/my-bookcast/</code> and calls up the page view called <code>view.xhtml</code>.
                        </p>
                    </li>
                    <li>
                        <p>
                            Create a skeleton for your <code>view.xhtml</code> under <code>BOOKCAST</code>:
                        </p>
                        <xml-source>
                            <html xmlns="http://www.w3.org/1999/xhtml"
                                  xmlns:xhtml="http://www.w3.org/1999/xhtml"
                                  xmlns:xforms="http://www.w3.org/2002/xforms"
                                  xmlns:xs="http://www.w3.org/2001/XMLSchema"
                                  xmlns:ev="http://www.w3.org/2001/xml-events"
                                  xmlns:xxforms="http://orbeon.org/oxf/xml/xforms">
                                <head>
                                    <title>XForms Bookcast</title>
                                </head>
                                <body>
                                    <p>Hello!</p>
                                </body>
                            </html>
                        </xml-source>
                        <p>
                            This is a very basic XHTML document. It features a title in the <code>&lt;head></code> and a
                            "Hello!" message in the <code>&lt;body></code>/. It also declares a bunch of XML namespaces
                            that you need later in the document.
                        </p>
                    </li>
                </ul>
                <p>
                    Now go to:
                </p>
                <xml-source>
                    http://localhost:8080/ops/my-bookcast/
                </xml-source>
                <p>
                    You should something like this:
                </p>
                <figure src="../apps/doc/images/tutorial/08.png"/>
                <note>
                    <p>
                        If you get lost at some point in this tutorial, feel free to look at the reference
                        source files for the bookcast application:
                    </p>
                    <ul>
                        <li>
                            <a href="/source-viewer/xforms-bookcast/view.xhtml">view.xhtml</a>
                        </li>
                        <li>
                            <a href="/source-viewer/xforms-bookcast/page-flow.xml">page-flow.xml</a>
                        </li>
                    </ul>
                </note>
            </section>
            <a name="bookcast-model-instance"/>
            <section>
                <title>XForms Model and Instance</title>
                <p>
                    An XForms document that wants to do something really useful needs at least one model containing one
                    instance. But first it is wise to decide how you would like to represent the information captured by
                    your form. This is an example that shows a possible representation of the data of the Bookcast
                    application (notes are borrowed from Wikipedia and are under the GNU Free Documentation License):
                </p>
                <xml-source show-namespaces="true">
                    <books>
                        <book>
                            <title>Don Quixote de la Mancha</title>
                            <author>Miguel de Cervantes Saavedra</author>
                            <language>es</language>
                            <link>http://en.wikipedia.org/wiki/Don_Quixote</link>
                            <rating>5</rating>
                            <notes>
                                The book tells the story of Alonso Quixano, a man who has read so many stories about
                                brave errant knights that, in a half-mad and confused state, he believes himself to be a
                                knight, re-names himself Don Quixote de la Mancha, and sets out to fight injustice in
                                the name of his beloved maiden Aldonsa, or as he knows her in his mind, Dulcinea del
                                Toboso.
                            </notes>
                        </book>
                        <book>
                            <title>Jacques le fataliste et son maître</title>
                            <author>Denis Diderot</author>
                            <language>fr</language>
                            <link>http://en.wikipedia.org/wiki/Jacques_le_fataliste_et_son_ma%C3%AEtre</link>
                            <rating>5</rating>
                            <notes>
                                Ce roman complexe et déconcertant — sans doute l'œuvre de Diderot la plus commentée —
                                puise pour partie son inspiration dans l'ouvrage de Laurence Sterne, Vie et opinions de
                                Tristram Shandy paru quelques années auparavant (1759-1763).
                            </notes>
                        </book>
                        <book>
                            <title>Childhood's End</title>
                            <author>Arthur C. Clarke</author>
                            <language>en</language>
                            <link>http://en.wikipedia.org/wiki/Childhood%27s_End</link>
                            <rating>5</rating>
                            <notes>
                                Childhood's End deals with humanity's transformation and integration into an
                                interplanetary hive mind. The book also touches on the issues of the Occult, man's
                                inability to live in a utopian society, and cruelty to animals, as well as the cliché of
                                being the last man on Earth.
                            </notes>
                        </book>
                        <book>
                            <title>The Demon-Haunted World</title>
                            <author>Carl Sagan</author>
                            <language>en</language>
                            <link>http://en.wikipedia.org/wiki/The_Demon-Haunted_World</link>
                            <rating>5</rating>
                            <notes>
                                Sagan states that when new ideas are offered for consideration, they should be tested
                                by means of skeptical thinking, and should stand up to rigorous questioning.
                            </notes>
                        </book>
                    </books>
                </xml-source>
                <p>
                    As you can see, the idea is to store the information about all the books in a single XML document.
                    So under a top-level <code>&lt;books></code> element, we put as many <code>&lt;book></code> children
                    elements as needed. You will see later how it is possible with XForms to add and remove children
                    elements. For now, your initial instance declaration is empty and contains a single book:
                </p>
                <xml-source show-namespaces="true" ignore-root-element="true">
                    <html xmlns="http://www.w3.org/1999/xhtml" xmlns:xforms="http://www.w3.org/2002/xforms">
                        <xforms:instance id="books-instance">
                            <books xmlns="">
                                <book>
                                    <title/>
                                    <author/>
                                    <language/>
                                    <link/>
                                    <rating/>
                                    <notes/>
                                </book>
                            </books>
                        </xforms:instance>
                    </html>
                </xml-source>
                <p>
                    Notice the <code>id</code> attribute which allows other XForms constructs to refer to that
                    particular instance.
                </p>
                <p>
                    Now do the following:
                </p>
                <ul>
                    <li>
                        <p>
                            Insert the model and instance under the <code>&lt;head></code> element.
                        </p>
                    </li>
                    <li>
                        <p>
                            Reload the page.
                        </p>
                    </li>
                </ul>
                <p>
                    You should still see a blank page, because so far you haven't added any visual elements!
                </p>
            </section>
            <a name="bookcast-first-controls"/>
            <section>
                <title>First Controls</title>
                <p>
                    Now it's time to add some visual controls to your page. Start with the following under the
                    <code>&lt;body></code> element:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:group ref="book" xmlns:xforms="http://www.w3.org/2002/xforms">
                        <xforms:input ref="title">
                            <xforms:label>Title</xforms:label>
                        </xforms:input>
                        <br/>
                        <xforms:input ref="author">
                            <xforms:label>Author</xforms:label>
                        </xforms:input>
                    </xforms:group>
                </xml-source>
                <p>
                    Reload the page. You should seem something like this:
                </p>
                <figure src="../apps/doc/images/tutorial/09.png"/>
                <p>
                    After having looked at the Hello example, this should be clear, with a little novelty:
                    <code>&lt;xforms:group></code>: this element allows grouping XForms controls together. The
                    <code>ref="book"</code> element changes the current <i>evaluation context</i> for the nested
                    controls, which means that they can use simpler XPath expressions: <code>ref="title"</code> instead
                    of <code>ref="book/title"</code> and <code>ref="author"</code> instead of
                    <code>ref="book/author"</code> (groups have other uses but you don't need to learn that now).
                </p>
                <p>
                    Another thing: all XForms controls require a nested <code>&lt;xforms:label></code> element, as an
                    effort to help accessibility. In some cases, you won't want an actual label to display next to the
                    control: to achieve this, you can either hide the label with CSS, or use an empty label element
                    (<code>&lt;xforms:label/></code>).
                </p>
            </section>
            <a name="bookcast-adding-constraints"/>
            <section>
                <title>Adding Constraints</title>
                <p>
                    Now say you want to make the title and author required data. You control this with the
                    <code>&lt;xforms:bind></code> element in the XForms model. Add the following under
                    <code>&lt;xforms:model></code> after your instance:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:bind nodeset="book" xmlns:xforms="http://www.w3.org/2002/xforms">
                        <xforms:bind nodeset="title" required="true()"/>
                        <xforms:bind nodeset="author" required="true()"/>
                    </xforms:bind>
                </xml-source>
                <p>
                    Notice how, as you enter text in the title or author field, the field's background changes color to
                    indicate that the field must be filled out.
                </p>
                <p>
                    The above requires some explanations:
                </p>
                <ul>
                    <li>
                        <p>
                            The <code>&lt;xforms:bind></code> element is used to assign so-called <i>Model Item
                            Properties</i> (or <i>MIPs</i>) to XForms instance nodes (typically XML elements or
                            attributes). Such properties include whether a field is required, read-only, or visible;
                            whether the field has to satisfy a certain constraint or be of a particular type; and
                            whether the field is a calculated value.
                        </p>
                    </li>
                    <li>
                        <p>
                            Here we use the <code>required</code> attribute, which determines whether a field is, well,
                            required, that is, whether it has to be filled out by the user.
                        </p>
                    </li>
                    <li>
                        <p>
                            Much like <code>&lt;xforms:group></code> in the controls, <code>&lt;xforms:bind></code>
                            elements can be nested.
                        </p>
                    </li>
                    <li>
                        <p>
                            <code>&lt;xforms:bind></code> doesn't use a <code>ref</code> attribute to point to instance
                            nodes, but a <code>nodeset</code> attribute, which allows pointing at more than one node
                            using a single XPath expression.
                        </p>
                    </li>
                    <li>
                        <p>
                            The outer <code>&lt;xforms:bind></code> element points to the <code>&lt;book></code> element
                            under the top-level <code>&lt;books></code> element of your instance. This happens because
                            the evaluation context for a top-level XPath expression in an <code>&lt;xforms:bind></code>
                            element is the root element of the first XForms instance. You could be more explicit, for
                            example with:
                        </p>
                        <xml-source show-namespaces="false">
                            <xforms:bind nodeset="/books/book" xmlns:xforms="http://www.w3.org/2002/xforms">
                                ...
                            </xforms:bind>
                        </xml-source>
                        <p>
                            Or with:
                        </p>
                        <xml-source show-namespaces="false">
                            <xforms:bind nodeset="instance('books-instance')/book" xmlns:xforms="http://www.w3.org/2002/xforms">
                                ...
                            </xforms:bind>
                        </xml-source>
                        <p>
                            The latter makes it clear, with the XForms <code>instance()</code> function, that you are
                            addressing the <code>books-instance</code> instance and not another instance, so you will
                            probably tend to prefer that notation.
                        </p>
                    </li>
                    <li>
                        <p>
                            The inner <code>&lt;xforms:bind></code> elements apply the <i>required</i> MIP to the
                            <code>&lt;title></code> and <code>&lt;author></code> elements. The <code>required</code>
                            attribute must contain an XPath expression, which is why it contains <code>true()</code>
                            (the way to express a Boolean "true" value in XPath) and not simply <code>true</code>.
                            Using XPath expressions allows you to make MIPs dynamically change, so that, for example, a
                            form field can be required or not depending on other form fields.
                        </p>
                    </li>
                    <li>
                        <p>
                            Note that MIPs are assigned to XML nodes, not directly to controls. But they affect the
                            controls that are bound to those nodes. This is part of XForms's MVC philosophy.
                        </p>
                    </li>
                </ul>
            </section>
            <a name="bookcast-single-selection-controls"/>
            <section>
                <title>Single Selection Controls</title>
                <p>
                    XForms is of course not limited to simple input controls. Add the following after the second
                    <code>&lt;xforms:input></code> control:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:select1 ref="language" xmlns:xforms="http://www.w3.org/2002/xforms">
                        <xforms:label>Language</xforms:label>
                        <xforms:item>
                            <xforms:label>Choose one...</xforms:label>
                            <xforms:value></xforms:value>
                        </xforms:item>
                        <xforms:item>
                            <xforms:label>English</xforms:label>
                            <xforms:value>en</xforms:value>
                        </xforms:item>
                        <xforms:item>
                            <xforms:label>French</xforms:label>
                            <xforms:value>fr</xforms:value>
                        </xforms:item>
                        <xforms:item>
                            <xforms:label>Spanish</xforms:label>
                            <xforms:value>es</xforms:value>
                        </xforms:item>
                    </xforms:select1>
                </xml-source>
                <p>
                    Reload the page. You should see the following:
                </p>
                <figure src="../apps/doc/images/tutorial/11.png"/>
                <p>
                    You have just added a single selection control with <code>&lt;xforms:select1></code>. The name means
                    that the user can "select one" item among several items. (XForms tends to call controls using more
                    abstract terms, rather than giving them names such as "combo box" or "menu".) The single selection
                    control usually appears like a drop-down menu or combo box with most XForms implementations (but you
                    can change it's appearance as shown later).
                </p>
                <p>
                    Nested within the control, you find several <code>&lt;xforms:item></code> elements. Each one
                    creates an item in the drop-down menu. An item has to sides: the <code>&lt;xforms:label></code>
                    element specifies the <i>label</i> that is presented to the user, and the
                    <code>&lt;xforms:value></code> element specifies the <i>value</i> that is stored into the XForms
                    instance when the user selects that particular item.
                </p>
                <p>
                    Now XForms encourages you to store data in the model. For a selection control, this means storing
                    the list of labels and values in an XForms instance instead of statically listing the items under
                    the <code>&lt;xforms:select1></code> element. So let's do this! Create a new instance in the model:
                </p>
                <xml-source show-namespaces="true" ignore-root-element="true">
                    <html xmlns="http://www.w3.org/1999/xhtml" xmlns:xforms="http://www.w3.org/2002/xforms">
                        <xforms:instance id="languages-instance">
                            <languages xmlns="">
                                <language>
                                    <name>English</name>
                                    <value>en</value>
                                </language>
                                <language>
                                    <name>French</name>
                                    <value>fr</value>
                                </language>
                                <language>
                                    <name>Spanish</name>
                                    <value>es</value>
                                </language>
                            </languages>
                        </xforms:instance>
                    </html>
                </xml-source>
                <p>
                    Then modify the <code>&lt;xforms:select1></code> element as follows:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:select1 ref="language" xmlns:xforms="http://www.w3.org/2002/xforms">
                        <xforms:label>Language</xforms:label>
                        <xforms:item>
                            <xforms:label>Choose One...</xforms:label>
                            <xforms:value/>
                        </xforms:item>
                        <xforms:itemset nodeset="instance('languages-instance')/language">
                            <xforms:label ref="name"/>
                            <xforms:value ref="value"/>
                        </xforms:itemset>
                    </xforms:select1>
                </xml-source>
                <p>
                    Notice the new <code>&lt;xforms:itemset></code> element in addition to the
                    <code>&lt;xforms:item></code> previously used. That element specifies an <i>item set</i>, which
                    allows you to point to the list of <code>&lt;language></code> nodes in the
                    <code>languages-instance</code> instance, and for each of those to tell the control where to find
                    the label and the value.
                </p>
                <p>
                    You often don't have to use an item set, but using them gives you the flexibility of reusing
                    existing sets of data, dynamically changing the list of items, easing localization, etc.
                </p>
            </section>
            <a name="bookcast-textarea"/>
            <section>
                <title>Adding a Text Area</title>
                <p>
                    Now add yet another control, a text area:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:textarea ref="notes" appearance="xxforms:autosize" xmlns:xforms="http://www.w3.org/2002/xforms">
                        <xforms:label>Notes</xforms:label>
                    </xforms:textarea>
                </xml-source>
                <p>
                    The <code>&lt;xforms:textarea></code> element acts very much like the HTML <code>textarea</code>
                    element. It makes sense to use it to allow entering more than one line of text.
                </p>
                <p>
                    Here there is a little trick: you use the <code>appearance</code> attribute to tell Orbeon Forms to
                    use a particular appearance for the text area control. Instead of the standard text area,
                    <code>appearance="xxforms:autosize"</code> allows the text area to grow vertically as the user
                    enters more text. (This is an appearance which is specific to Orbeon Forms, and you can tell that
                    because of the <code>xxforms:</code> prefix in the appearance value.)
                </p>
                <p>
                    Note that the application captures the same data without the <code>appearance</code> attribute, it's
                    just that the control appears slightly differently and the user experience is changed.
                </p>
            </section>
            <a name="bookcast-finishing-controls"/>
            <section>
                <title>Finishing-Up the Controls</title>
                <p>
                    To create the ratings input, add this new instance:
                </p>
                <xml-source show-namespaces="true" ignore-root-element="true">
                    <html xmlns="http://www.w3.org/1999/xhtml" xmlns:xforms="http://www.w3.org/2002/xforms">
                        <xforms:instance id="ratings-instance">
                            <ratings xmlns="">
                                <rating>
                                    <name>1</name>
                                    <value>1</value>
                                </rating>
                                <rating>
                                    <name>2</name>
                                    <value>2</value>
                                </rating>
                                <rating>
                                    <name>3</name>
                                    <value>3</value>
                                </rating>
                                <rating>
                                    <name>4</name>
                                    <value>4</value>
                                </rating>
                                <rating>
                                    <name>5</name>
                                    <value>5</value>
                                </rating>
                            </ratings>
                        </xforms:instance>
                    </html>
                </xml-source>
                <p>
                    And then add another <code>&lt;xforms:select1></code> control:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:select1 ref="rating" appearance="full" xmlns:xforms="http://www.w3.org/2002/xforms">
                        <xforms:label>Rating</xforms:label>
                        <xforms:item>
                            <xforms:label>None</xforms:label>
                            <xforms:value/>
                        </xforms:item>
                        <xforms:itemset nodeset="instance('ratings-instance')/rating">
                            <xforms:label ref="name"/>
                            <xforms:value ref="value"/>
                        </xforms:itemset>
                    </xforms:select1>
                </xml-source>
                <p>
                    Here again, you store the list of items as a separate instance, but we keep the "empty" item as an
                    <code>&lt;xforms:item></code>. There is something new: the use of the <code>full</code> appearance,
                    which displays the selection control as a list of radio buttons. This is a standard XForms
                    appearance value, which is likely to be supported by all XForms implementations. (You can tell
                    that it is standard because there is no colon <code>:</code> in the appearance value.)
                </p>
                <p>
                    The only missing control now is the input field bound to the <code>&lt;link></code> element. Add
                    this, and you should have something like this in your controls:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:group ref="book" xmlns:xforms="http://www.w3.org/2002/xforms">
                        <xforms:input ref="title">
                            <xforms:label>Title</xforms:label>
                        </xforms:input>
                        <br/>
                        <xforms:input ref="author">
                            <xforms:label>Author</xforms:label>
                        </xforms:input>
                        <br/>
                        <xforms:select1 ref="language">
                            <xforms:label>Language</xforms:label>
                            <xforms:item>
                                <xforms:label>Choose One...</xforms:label>
                                <xforms:value/>
                            </xforms:item>
                            <xforms:itemset nodeset="instance('languages-instance')/language">
                                <xforms:label ref="name"/>
                                <xforms:value ref="value"/>
                            </xforms:itemset>
                        </xforms:select1>
                        <br/>
                        <xforms:input ref="link">
                            <xforms:label>Link</xforms:label>
                        </xforms:input>
                        <br/>
                        <xforms:select1 ref="rating" appearance="full">
                            <xforms:label>Rating</xforms:label>
                            <xforms:item>
                                <xforms:label>None</xforms:label>
                                <xforms:value/>
                            </xforms:item>
                            <xforms:itemset nodeset="instance('ratings-instance')/rating">
                                <xforms:label ref="name"/>
                                <xforms:value ref="value"/>
                            </xforms:itemset>
                        </xforms:select1>
                        <br/>
                        <xforms:textarea ref="notes" appearance="xxforms:autosize">
                            <xforms:label>Notes</xforms:label>
                        </xforms:textarea>
                    </xforms:group>
                </xml-source>
                <p>
                    And this is how the result should look like:
                </p>
                <figure src="../apps/doc/images/tutorial/12.png"/>
                <p>
                    By now you probably get the gist of it!
                </p>
            </section>
            <a name="bookcast-save-button"/>
            <section>
                <title>Adding a "Save" Button</title>
                <p>
                    The Bookcast application now allows you to capture some data. But it is not a very useful
                    application yet, because it doesn't do anything with it! So let's see how you can add a "Save"
                    button that, once pressed, well, saves the data in your form.
                </p>
                <p>
                    Many applications use relational databases as a persistence layer. But because Orbeon Forms and
                    XForms use XML as their native data format, it is very appropriate to use a database that
                    understands XML instead. Orbeon Forms comes with the open source <a
                    href="http://exist.sourceforge.net/">eXist database</a> that does just that.
                </p>
                <p>
                    So how do you save data from XForms to a database? An important feature of XForms is the XForms
                    <i>submission</i>. A submission allows you to read and write XML documents using HTTP and other
                    protocols. Because the eXist database has a REST API (in other words an HTTP-friendly interface),
                    XForms can directly talk to eXist to read and write XML documents and perform all the common CRUD
                    (Create, Retrieve, Update and Delete) operations.
                </p>
                <p>
                    So look at how you create a submission that saves the <code>books-instance</code> instance into
                    eXist:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:submission id="save-submission" ref="instance('books-instance')"
                        action="/exist/rest/db/orbeon/my-bookcast/books.xml"
                        method="put" replace="none" xmlns:xforms="http://www.w3.org/2002/xforms"/>
                </xml-source>
                <p>
                    Let's look at the details:
                </p>
                <ul>
                    <li>
                        <p>
                            The <code>&lt;xforms:submission></code> element declares a submission.
                        </p>
                    </li>
                    <li>
                        <p>
                            As usual, the <code>id</code> attribute allows referring to the submission from other XForms
                            constructs.
                        </p>
                    </li>
                    <li>
                        <p>
                            The <code>ref</code> attribute specifies what piece of XML must be handled by the
                            submission. It points to an instance node with an XPath expression. Here, we point to the
                            whole <code>books-instance</code> instance by using the <code>instance()</code> function.
                        </p>
                    </li>
                    <li>
                        <p>
                            The <code>action</code> attribute specifies to what URL the submission takes place. Here,
                            you use an absolute path:
                        </p>
                        <xml-source>
                            /exist/rest/db/orbeon/my-bookcast/books.xml
                        </xml-source>
                        <p>
                            This path is equivalent to  using the absolute URL:
                        </p>
                        <xml-source>
                            http://localhost:8080/ops/exist/rest/db/orbeon/my-bookcast/books.xml
                        </xml-source>
                        <p>
                            (Because it is inconvenient for you to always write absolute URLs when you want to address
                            an URL handle by Orbeon Forms, Orbeon Forms automatically resolves absolute paths against
                            the base <code>http://localhost:8080/ops/</code>.)
                        </p>
                        <p>
                            The paths starts with <code>/exist/rest/</code>, which maps to the built-in eXist database.
                            The rest of the path (<code>/db/orbeon/my-bookcast/books.xml</code>) specifies the
                            <i>collection</i> and <code>document</code> to access. Here, we decide to save the data to a
                            document called <code>books</code> within a collection called
                            <code>/db/orbeon/my-bookcast/</code>.
                        </p>
                    </li>
                    <li>
                        <p>
                            The <code>method</code> attribute specifies what HTTP method to use. Here, you use the value
                            <code>put</code>, which translates into using the HTTP PUT method. (You may not be very
                            familiar with the PUT method (HTML forms, for example, always use GET and POST), but PUT is
                            getting used more and more with REST interfaces. In just a few words, PUT allows you to
                            store a resource to a particular location on an HTTP server.)
                        </p>
                    </li>
                    <li>
                        <p>
                            Finally, the <code>replace</code> attribute specifies what to do with the response sent by
                            the server (here the server is the eXist database). Specifying a value of <code>none</code>
                            tells the XForms engine to discard the content of the response from the database.
                        </p>
                    </li>
                </ul>
                <p>
                    This is great, but specifying a submission does not do anything until you <i>send</i> (execute)
                    that submission. A simple way to do this is to use the submit control:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:submit submission="save-submission" xmlns:xforms="http://www.w3.org/2002/xforms">
                        <xforms:label>Save</xforms:label>
                    </xforms:submit>
                </xml-source>
                <p>
                    This control has a <code>submission</code> attribute which specifies what submission to send. The
                    control typically looks like a push button, into which the specified label appears. Pressing it
                    automatically sends the submission specified.
                </p>
                <p>
                    So go ahead and:
                </p>
                <ul>
                    <li>
                        <p>
                             Add the submit control just before the <code>&lt;xforms:group></code> element.
                        </p>
                    </li>
                    <li>
                        <p>
                            Add the submission to the model.
                        </p>
                    </li>
                    <li>
                        <p>
                            Reload the page.
                        </p>
                    </li>
                    <li>
                        <p>
                            Enter a book title and an author, then press the "Save" button. Your form data has been
                            silently saved to the database. It was that easy!
                        </p>
                    </li>
                    <li>
                        <p>
                             To check that the data is actually in the database, open up a new browser tab or window,
                             and enter the following URL:
                        </p>
                        <xml-source>
                            http://localhost:8080/ops/exist/rest/db/orbeon/my-bookcast/books.xml
                        </xml-source>
                        <p>
                            This is the exact same URL to which your submission has done an HTTP PUT. By entering it in
                            your browser, you tell it to do an HTTP GET instead, and the eXist database simply sends
                            the XML document to your browser. You should see this:
                        </p>
                        <figure src="../apps/doc/images/tutorial/13.png"/>
                    </li>
                </ul>
                <p>
                    Try changing the book author and pressing "Save" again. Then in your other browser tab or window,
                    reload the eXist URL, and notice that the data has actually changed in the database.
                </p>
                <p>
                    Do you see how persistence is easily implemented with Orbeon Forms? No need for object-relational
                    mapping or for manually marshalling data to and from a database: just send and retrieve XML
                    documents representing your form data!
                </p>
                <note>
                    <p>
                        Or course, you don't have to use eXist or even an XML database with Orbeon Forms: you can in
                        fact interface with any system you can think of with submissions. For systems that don't already
                        have a REST API, you will need to write REST interfaces - and you can do this with your
                        favorite language and platform, including Java, PHP, Ruby, or .NET. You can even write such
                        services with Orbeon Forms XPL (the Orbeon Forms XML pipelines language), which feature
                        built-in components for access to relational databases, web services, and more.
                    </p>
                </note>
            </section>
            <a name="bookcast-loading-initial-data"/>
            <section>
                <title>Loading the Initial Data</title>
                <p>
                    You can now save your data to the database, and read it back using your web browser. The missing
                    part of course consists in allowing the application to automatically load up the data when the page
                    is first displayed.
                </p>
                <p>
                    You guessed it, one way of doing this is to use a submission:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:submission id="list-submission" serialize="false"
                       method="get" action="/exist/rest/db/orbeon/my-bookcast/books.xml"
                       replace="instance" instance="books-instance" xmlns:xforms="http://www.w3.org/2002/xforms"/>
                </xml-source>
                <p>
                    There are a few differences with <code>save-submission</code>:
                </p>
                <ul>
                    <li>
                        <p>
                            The <code>id</code> attribute is different: <code>list-submission</code>. (All the
                            <code>id</code> attributes in a given XForms document must be different.)
                        </p>
                    </li>
                    <li>
                        <p>
                            The <code>serialize="false"</code> attribute specifies that you don't want to send XML data
                            with this submission.
                        </p>
                    </li>
                    <li>
                        <p>
                            The <code>get</code> method specifies that you want to do an HTTP GET, like when you
                            pointed your web browser at the URL to read the document from eXist.
                        </p>
                    </li>
                    <li>
                        <p>
                            The <code>replace="instance"</code> attribute specifies that the result of the submission
                            has to be stored into an instance. The <code>instance="books-instance"</code> attribute
                            specifies the identifier of the instance into which the result must be stored.
                        </p>
                    </li>
                </ul>
                <p>
                    Like with <code>save-submission</code>, the submission needs to be sent to achieve something. You do
                    this by adding the following <i>event handler</i> to the model:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:send ev:event="xforms-ready" submission="list-submission" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:ev="http://www.w3.org/2001/xml-events"/>
                </xml-source>
                <p>
                    This tells the XForms engine to execute an <i>action</i> called <code>&lt;xforms:send></code> when the
                    XForms engine is ready. This action takes an attribute called <code>submission</code>, which specifies
                    which submission to send, here <code>list-submission</code>.
                </p>
                <p>
                    Note the special attribute called <code>ev:event</code>: this attributes marks the
                    <code>&lt;xforms:send></code> element as an <i>event handler</i>, that is an action that must respond
                    to an event dispatched by the XForms engine. In this case, the name of the event is
                    <code>xforms-ready</code>, which is a standard XForms event with the meaning that well, the XForms
                    engine is ready.
                </p>
                <p>
                    After adding the event handler, reload the page, and notice how the page now loads and immediately shows
                    the data that you saved into the database.
                </p>
                <p>
                    The following is an overview of what has just happened:
                </p>
                <ul>
                    <li>
                        <p>
                            You request the page of the Bookcast application with your browser.
                        </p>
                    </li>
                    <li>
                        <p>
                            Orbeon Forms receives the request, looks up the page flow file, and finds out that
                            <code>view.xhtml</code> must be served.
                        </p>
                    </li>
                    <li>
                        <p>
                            <code>view.xhtml</code> goes through the XForms engine, which does a few bits of magic: it goes
                            through an initialization phase, where it creates the objects you have defined such as as model,
                            instance, and controls.
                        </p>
                    </li>
                    <li>
                        <p>
                            Once this is done, the XForms engine sends the <code>xforms-ready</code> event to the model.
                        </p>
                    </li>
                    <li>
                        <p>
                            Because you have defined an event handler for <code>xforms-ready</code>, that handler is called.
                            This caused the <code>&lt;xforms:send></code> action to be run and, therefore, the
                            <code>list-submission</code> submission to be sent.
                        </p>
                    </li>
                    <li>
                        <p>
                            The submission performs an HTTP GET to the URL you have specified. The connection reaches the
                            built-in eXist database, which returns the document called <code>books.xml</code>. The content
                            of that document reaches back the XForms engine, which stores it into the
                            <code>books-instance</code> instance.
                        </p>
                    </li>
                    <li>
                        <p>
                            The XForms engine updates the XForms controls bound to the instance with the values now
                            contained in the instance. For example, the "title" and "author" input fields are now updated
                            with the values that came from the database.
                        </p>
                    </li>
                    <li>
                        <p>
                            The XForms engine sends an HTML page to your web browser. You see the page with all the correct
                            data as saved earlier into the database.
                        </p>
                    </li>
                </ul>
                <p>
                    <i>Actions</i> and <i>events</i> are very important in XForms: they are the glue that allows you to
                    react to different "things" that happen in an XForms page, whether controlled by the XForms engine or
                    directly by the user. This is very similar to using JavaScript in a regular HTML page. In XForms, they
                    allow you to react to the user pressing a button, entering data, etc. XForms comes with a number of
                    standard events and configurable action that you can combine in many ways, so that in most cases you
                    don't need to use something like JavaScript.
                </p>
                <p>
                    (You may wonder what would happen the first time the <code>list-submission</code> is called if no
                    <code>books.xml</code> document is available in the database. The answer is that the database would
                    return an error, and the submission would throw an event called <code>xforms-submit-error</code>.
                    But because you don't have an event handler for this event, nothing happens: the initial
                    content of the <code>books-submission</code> instance is not changed and so you see an empty form.)
                </p>
            </section>
            <a name="bookcast-adding-books"/>
            <section>
                <title>Adding More Books</title>
                <p>
                    Now let's see how we can enter information about more than a single book!
                </p>
                <p>
                    XForms comes with a really handy construct called <code>&lt;xforms:repeat></code>. This allows you
                    to <i>repeat</i> sections of user interface controls, based on instance data. To see how this works,
                    first replace the group you have defined:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:group ref="book" xmlns:xforms="http://www.w3.org/2002/xforms">
                        ...
                    </xforms:group>
                </xml-source>
                <p>
                    with, instead, this:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:repeat nodeset="book" id="book-repeat" xmlns:xforms="http://www.w3.org/2002/xforms">
                        ...
                    </xforms:repeat>
                </xml-source>
                <p>
                    Reload the page, and notice that, well, nothing changes so far!
                </p>
                <p>
                    This tells the XForms engine that the content of the <code>&lt;xforms:repeat></code> element must be
                    <i>repeated</i> as many times as <code>&lt;book></code> elements are found in the instance. If you
                    have a single <code>&lt;book></code> element, then the controls are not repeated (which is
                    equivalent to having <code>&lt;xforms:group></code>); if you have two <code>&lt;book></code>
                    elements, they are repeated two times, etc.
                </p>
                <p>
                    The trick now is to manage to <i>add</i> a new <code>&lt;book></code> element to the
                    <code>books-instance</code> instance. First, create a <i>template</i> for the new
                    <code>&lt;book></code> element to insert by declaring a new instance:
                </p>
                <xml-source show-namespaces="true" ignore-root-element="true">
                    <html xmlns="http://www.w3.org/1999/xhtml" xmlns:xforms="http://www.w3.org/2002/xforms">
                        <xforms:instance id="book-template">
                            <book xmlns="">
                                <title/>
                                <author/>
                                <language/>
                                <link/>
                                <rating/>
                                <notes/>
                            </book>
                        </xforms:instance>
                    </html>
                </xml-source>
                <p>
                    Then you want to copy that template to the right place in <code>books-instance</code> when the user
                    presses a button. You do this with a new control called <code>&lt;xforms:trigger></code> and a new
                    action called <code>&lt;xforms:insert></code>. Add the following to your controls:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:trigger xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:ev="http://www.w3.org/2001/xml-events">
                        <xforms:label>Add One</xforms:label>
                        <xforms:insert ev:event="DOMActivate" context="instance('books-instance')" nodeset="book" at="1"
                                       position="before" origin="instance('book-template')"/>
                    </xforms:trigger>
                </xml-source>
                <p>
                    Let's explain what the above does:
                </p>
                <ul>
                    <li>
                        <p>
                            The <code>&lt;xforms:trigger></code> element declares a button (remember, XForms likes more
                            abstract names, but this control could have as well been called
                            <code>&lt;xforms:button></code>). Like all XForms controls, <code>&lt;xforms:trigger></code>
                            takes a label, which is here displayed within the button.
                        </p>
                    </li>
                    <li>
                        <p>
                            Once the user presses it, the button sends an event called <code>DOMActivate</code>. Don't
                            be scared by this funny name, you will use it all the time. It just means that the user has
                            <i>activated</i> the button, which in most cases means that the user pressed (clicked) on
                            it.
                        </p>
                    </li>
                    <li>
                        <p>
                            <code>&lt;xforms:insert></code> is declared as an event handler with the
                            <code>ev:event="DOMActivate"</code> attribute, so this action runs when the user presses
                            the button.
                        </p>
                    </li>
                    <li>
                        <p>
                            Here we have decided that we want to insert a new book always in first position in the page.
                            The trick is to configure the insert action with the appropriate attributes.
                        </p>
                        <p>
                            With the configuration provided, the action <i>inserts</i>
                            (<code>&lt;xforms:insert></code>) the contents of the <code>book-template</code> instance
                            (origin="instance('book-template')") <i>before</i> (<code>position="before"</code>) the
                            <i>first</i> (<code>at="1"</code>) element called <code>&lt;book></code>
                            (<code>nodeset="book"</code>) under the <code>books-instance</code> instance's root element
                            (<code>context="instance('books-instance')"</code>).
                        </p>
                        <p>
                            This may sound a little confusing at first, but that's because
                            <code>&lt;xforms:insert></code> is in fact very powerful and you can combine its attributes
                            in many different ways. 
                        </p>
                    </li>
                </ul>
                <p>
                    Make the changes above, press on the "Add One" button, and you see a new row of controls created.
                </p>
                <figure src="../apps/doc/images/tutorial/14.png"/>
                <p>
                    Again the XForms engine does its magic and takes care of updating the web page automatically. You
                    also notice that the web page does not reload as it updates. This is because Orbeon Forms uses Ajax
                    technology to perform updates to the page. With Ajax, client-side JavaScript code silently talks to
                    the Orbeon Forms server, which then communicates to the client-side code the updates to perform to
                    the page. These update are directly done to the HTML Document Object Model (DOM) without reload.
                </p>
            </section>
            <a name="bookcast-deleting-book"/>
            <section>
                <title>Deleting a Book</title>
                <p>
                    If you can add books, you probably also want to be able to remove them. This can be done with the
                    <code>&lt;xforms:delete></code> action. It doesn't seem to make much sense to always remove the
                    first book, but rather, you probably want to delete a specific book. This can be done in several
                    ways, but what about adding a delete button next to each series of repeated controls:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:trigger xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:ev="http://www.w3.org/2001/xml-events">
                        <xforms:label>Remove</xforms:label>
                        <xforms:delete ev:event="DOMActivate" context="instance('books-instance')" nodeset="book" at="index('book-repeat')"/>
                    </xforms:trigger>
                </xml-source>
                <p>
                    This works in a way very similar to the "Add One" button:
                </p>
                <ul>
                    <li>
                        <p>
                            The <code>&lt;xforms:trigger></code> element declares a button, but here with a different
                            label ("Remove"). Once the user presses it, the button sends a <code>DOMActivate</code>.
                        </p>
                    </li>
                    <li>
                        <p>
                            <code>&lt;xforms:delete></code> is declared as an event handler with the
                            <code>ev:event="DOMActivate"</code> attribute.
                        </p>
                    </li>
                    <li>
                        <p>
                            The difference is in the configuration of <code>&lt;xforms:delete></code>.
                        </p>
                        <p>
                            Here you don't use the <code>position</code> and <code>origin</code> attributes. What you
                            are telling the action here is to delete (<code>&lt;xforms:delete></code>) the element
                            called <code>&lt;book></code> (<code>nodeset="book"</code>) under the
                            <code>books-instance</code> instance's root element
                            (<code>context="instance('books-instance')"</code>) which is at the current index position
                            of the <code>book-repeat</code> repetition (<code>at="index('book-repeat')"</code>).
                        </p>
                        <p>
                            To understand the <code>index()</code> function, you should know that each repetition in
                            XForms has an associated <i>current index</i>, which tells you which current iteration of a
                            repetition is currently active. The current index changes as you navigate through controls.
                            If you type in the title input field of the first book, the index is <code>1</code>; if you
                            type in the author input field of the third book, the index is <code>3</code>; and so on.
                            The index changes also if you click buttons. Usually, the current index is also visually
                            highlighted.
                        </p>
                        <p>
                            So here, when you click on the "Remove" button of, say, the second book, the index for the
                            <code>books-repeat</code> repetition changes to <code>2</code>, and therefore
                            <code>index('books-repeat')</code> also returns <code>2</code>. This way, you can tell
                            <code>&lt;xforms:delete></code> to remove the second <code>&lt;book></code> element.
                        </p>
                    </li>
                </ul>
                <p>
                    Now add the new trigger within <code>&lt;xforms:repeat></code> and reload the page. Try adding
                    books, then removing them by pressing the "Remove" button.
                </p>
                <figure src="../apps/doc/images/tutorial/15.png"/>
            </section>
            <a name="bookcast-revert-button"/>
            <section>
                <title>Adding a "Revert" Button</title>
                <p>
                    For fun, let's also add a new button to cancel your unsaved edits and reload the original data from
                    the database. It's as easy as this:
                </p>
                <xml-source show-namespaces="false" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:ev="http://www.w3.org/2001/xml-events">
                    <xforms:submit submission="list-submission">
                        <xforms:label>Revert</xforms:label>
                    </xforms:submit>
                </xml-source>
                <p>
                    When you press the "Revert" button, the <code>list-submission</code> submission is called, which
                    causes the latest saved <code>books.xml</code> document to be reloaded. The XForms engine makes sure
                    that all the controls on the page, including repeats, automatically update to reflect the changes to
                    the <code>books-instance</code> instance.
                </p>
            </section>
            <a name="making-things-look-nicer"/>
            <section>
                <title>Making Things Look Nicer</title>
                <p>
                    You are probably not very happy with the look of your application. But let's see how you can
                    improve this with CSS.
                </p>
                <p>
                    First, start with a nicer "action bar" at the top of the page:
                </p>
                <xml-source show-namespaces="false" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:ev="http://www.w3.org/2001/xml-events">
                    <table class="books-action-table">
                        <tr>
                            <td>
                                <xforms:submit submission="save-submission" appearance="minimal">
                                    <xforms:label><img src="../apps/xforms-bookcast/images/save.gif" alt="Save"/> Save</xforms:label>
                                </xforms:submit>
                            </td>
                            <td>
                                <xforms:submit submission="list-submission" appearance="minimal">
                                    <xforms:label><img src="../apps/xforms-bookcast/images/recycle-green.png" alt="Revert"/> Revert</xforms:label>
                                </xforms:submit>
                            </td>
                        </tr>
                    </table>
                </xml-source>
                <p>
                    You notice that:
                </p>
                <ul>
                    <li>
                        <p>
                            The triggers are also improved with the <code>minimal</code> appearance, which renders the
                            trigger as a hyperlink instead of a button.
                        </p>
                    </li>
                    <li>
                        <p>
                            You put an HTML image (<code>&lt;img></code>) element within the trigger's label. Yes, this
                            is allowed and allows you to make a clickable icon!
                        </p>
                    </li>
                </ul>
                <p>
                    Then encapsulate the main XForms controls within a table:
                </p>
                <xml-source show-namespaces="false" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:ev="http://www.w3.org/2001/xml-events">
                    <table class="books-table">
                        <tr>
                            <td>
                                <xforms:trigger appearance="minimal">
                                    <xforms:label><img src="../apps/xforms-bookcast/images/add.gif"/></xforms:label>
                                    <xforms:insert ev:event="DOMActivate" context="instance('books-instance')" nodeset="book" at="1" position="before" origin="instance('book-template')"/>
                                </xforms:trigger>
                            </td>
                            <td class="add-td">
                                <xforms:trigger appearance="minimal">
                                    <xforms:label>Add One</xforms:label>
                                    <xforms:insert ev:event="DOMActivate" context="instance('books-instance')" nodeset="book" at="1" position="before" origin="instance('book-template')"/>
                                </xforms:trigger>
                            </td>
                        </tr>
                        <xforms:repeat nodeset="book" id="book-repeat">
                            <tr>
                                <td>
                                    <xforms:trigger appearance="minimal">
                                        <xforms:label><img src="../apps/xforms-bookcast/images/remove.gif"/></xforms:label>
                                        <xforms:delete ev:event="DOMActivate" context="instance('books-instance')" nodeset="book" at="index('book-repeat')"/>
                                    </xforms:trigger>
                                </td>
                                <td class="form-td">
                                    <comment>Put the remaining form controls here!</comment>
                                    ...
                                </td>
                            </tr>
                        </xforms:repeat>
                    </table>
                </xml-source>
                <p>
                    You notice a few more things:
                </p>
                <ul>
                    <li>
                        <p>
                            <code>&lt;xforms:repeat></code> is put around an XHTML <code>&lt;tr></code> element, which
                            means that the repetition repeats table rows.
                        </p>
                    </li>
                    <li>
                        <p>
                            You add class names on the table and on a table cell, in order to facilitate CSS styling.
                        </p>
                    </li>
                </ul>
                <p>
                    Finally, add a <code>books-label</code> class to the controls related to book data, for example:
                </p>
                <xml-source show-namespaces="false" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:ev="http://www.w3.org/2001/xml-events">
                    <xforms:label class="books-label">Title</xforms:label>
                </xml-source>
                <p>
                    Now remember that Orbeon Forms does not send the XForms code directly to the web browser, but
                    instead it transforms it into HTML. You realize that this is done because Orbeon Forms cannot assume
                    that your web browser to support XForms at all. Consider the following examples:
                </p>
                <table>
                    <tr>
                        <th>XForms Source</th>
                        <th>HTML Result in Web Browser</th>
                    </tr>
                    <tr>
                        <td>
                            <xml-source border="false" show-namespaces="false">
                                <xforms:submit id="my-submit" submission="save-submission" xmlns:xforms="http://www.w3.org/2002/xforms">
                                    <xforms:label>Save</xforms:label>
                                </xforms:submit>
                            </xml-source>
                        </td>
                        <td>
                            <xml-source border="false" show-namespaces="false">
                                <button id="my-submit" class="xforms-control xforms-submit" type="button">Save</button>
                            </xml-source>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <xml-source border="false" show-namespaces="false">
                                <xforms:input id="my-input" ref="title" xmlns:xforms="http://www.w3.org/2002/xforms">
                                    <xforms:label>Title</xforms:label>
                                </xforms:input>
                            </xml-source>
                        </td>
                        <td>
                            <xml-source border="false" show-namespaces="false" xmlns:xforms="http://www.w3.org/2002/xforms">
                                <label class="xforms-label" for="my-input">Title</label>
                                <span id="my-input" class="xforms-control xforms-input">
                                    <span class="xforms-date-display"/>
                                    <input id="input-my-input" type="text" name="my-input" value="" class="xforms-input-input xforms-type-string"/>
                                    <span class="xforms-showcalendar xforms-type-string" id="showcalendar-my-input"/>
                                </span>
                                <label class="xforms-alert xforms-alert-inactive" for="my-input"/>
                            </xml-source>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <xml-source border="false" show-namespaces="false" xmlns:xforms="http://www.w3.org/2002/xforms">
                                <xforms:textarea ref="notes">
                                    <xforms:label class="books-label">Notes</xforms:label>
                                </xforms:textarea>
                            </xml-source>
                        </td>
                        <td>
                            <xml-source border="false" show-namespaces="false" xmlns:xforms="http://www.w3.org/2002/xforms">
                                <label class="books-label xforms-label" for="my-textarea">Notes</label>
                                <textarea id="my-textarea" class="xforms-control xforms-textarea" name="my-textarea"/>
                                <label class="xforms-alert xforms-alert-inactive" for="my-textarea"/>
                            </xml-source>
                        </td>
                    </tr>
                </table>
                <p>
                    And so on for each XForms construct. You notice that Orbeon Forms produces HTML code, including HTML
                    form elements. Ideally, you wouldn't have to know this, and often you don't, but when it comes to
                    styling with CSS having an idea of what the resulting HTML looks like will help you a lot.
                </p>
                <p>
                    So now look at the following CSS declaration for the Bookcast application:
                </p>
                <table>
                    <tr>
                        <th>CSS</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td>
                            <code>
                                .xforms-label { font-weight: bold }
                            </code>
                        </td>
                        <td>
                            Display all labels in bold.
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <code>
                                .books-label { display: -moz-inline-box; display: inline-block; width: expression('9em'); min-width: 9em; }
                            </code>
                        </td>
                        <td>
                            Display all labels with the <code>books-label</code> class to have a minimum width. This
                            allows aligning all the labels on the left. Note the mozilla- and IE-specific CSS.
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <code>
                                .xforms-textarea-appearance-xxforms-autosize { width: 20em; margin-bottom: 2px  }
                            </code>
                        </td>
                        <td>
                            Set width and margin to all text area controls with appearance <code>xxforms:autosize</code>.
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <code>
                                .xforms-input input { width: 20em; margin-bottom: 2px }
                            </code>
                        </td>
                        <td>
                            Set width and margin to all input controls.
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <code>
                                .xforms-select1 { margin-bottom: 2px }
                                <br/>
                                .xforms-select1 input { margin-bottom: 2px }
                            </code>
                        </td>
                        <td>
                            Set margin to all single selection controls.
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <code>
                                .books-table { background-color: #fce5b6 }
                                <br/>
                                .books-table .add-td { width: 33em }
                                <br/>
                                .books-table .form-td { width: 33em; background: white; padding: .5em }
                            </code>
                        </td>
                        <td>
                            Format the main table.
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <code>
                                .xforms-repeat-selected-item-1 .form-td { background: #ffc }
                            </code>
                        </td>
                        <td>
                            Change the background color of the currently selected repeat index.
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <code>
                                .books-action-table { margin-bottom: 1em }
                                <br/>
                                .books-action-table td { white-space: nowrap; vertical-align: middle; padding-right: 1em }
                                <br/>
                                .books-action-table .xforms-submit img { vertical-align: middle }
                                <br/>
                                .books-action-table .xforms-trigger-appearance-minimal img { margin-right: 1em; vertical-align: middle }
                            </code>
                        </td>
                        <td>
                            Set margins and alignment for the action table at the top of the page.
                        </td>
                    </tr>
                </table>
                <p>
                    Now just add all the CSS declaration under the page's <code>&lt;head></code> element, encapsulated
                    within an HTML <code>&lt;style></code> element:
                </p>
                <xml-source>
                    <style type="text/css">
                        <comment>Your CSS declaration here!</comment>
                        ...
                    </style>
                </xml-source>
                <p>
                    Reload the page, and you should see something like this:
                </p>
                <figure src="../apps/doc/images/tutorial/16.png"/>
                <p>
                    A little bit of CSS does make things look a little better, doesn't it?
                </p>
            </section>
            <a name="bookcast-validation"/>
            <section>
                <title>Adding Validation</title>
                <p>
                    You already made the title and author mandatory fields, but you may want to validate the data more
                    thoroughly. With XForms, validation has two sides:
                </p>
                <ul>
                    <li>
                        <p>
                            A user-facing side, which tells the user which form fields are invalid. With Orbeon Forms,
                            invalid fields are marked by default with an exclamation point icon. In the Bookcast
                            application, you may want to make sure that the link field contains an HTTP URI with a
                            correct syntax.
                        </p>
                    </li>
                    <li>
                        <p>
                            A hidden side, which prevents submission from happening if the data to submit is invalid.
                            With the Bookcast application, for example, it is important to make sure that the data you
                            store into the database follows a certain set of rules. This protects you against invalid
                            data entered by the user, or against programming mistakes.
                        </p>
                    </li>
                </ul>
                <p>
                    XForms supports two ways of performing validation:
                </p>
                <ul>
                    <li>
                        <p>
                            With Model Item Properties (MIPs) in the model, called <code>constraint</code> and
                            <code>type</code>.
                        </p>
                    </li>
                    <li>
                        <p>
                            With an <i>XML Schema</i>. XML Schema is a W3C standard to specify constraints on XML
                            documents, including constraints on the structure of the document or on the data types
                            contained.
                        </p>
                    </li>
                </ul>
                <p>
                    Look at the following XML Schema for the Bookcast application:
                </p>
                <xml-source>
                    <xs:schema
                        xmlns:xs="http://www.w3.org/2001/XMLSchema"
                        elementFormDefault="qualified"
                        attributeFormDefault="unqualified">

                        <comment> Top-level element </comment>
                        <xs:element name="books">
                            <xs:complexType>
                                <comment> Allow 0 to n books </comment>
                                <xs:sequence minOccurs="0" maxOccurs="unbounded">
                                    <xs:element name="book" type="book"/>
                                </xs:sequence>
                            </xs:complexType>
                        </xs:element>

                        <comment> Individual book element </comment>
                        <xs:complexType name="book">
                            <xs:sequence>
                                <xs:element name="title" type="xs:string"/>
                                <xs:element name="author" type="xs:string"/>
                                <xs:element name="language" type="language"/>
                                <xs:element name="link" type="link"/>
                                <xs:element name="rating" type="rating"/>
                                <xs:element name="notes" type="xs:string"/>
                            </xs:sequence>
                        </xs:complexType>

                        <comment> Type for rating </comment>
                        <xs:simpleType name="rating">
                            <xs:restriction base="xs:string">
                                <xs:enumeration value=""/>
                                <xs:enumeration value="1"/>
                                <xs:enumeration value="2"/>
                                <xs:enumeration value="3"/>
                                <xs:enumeration value="4"/>
                                <xs:enumeration value="5"/>
                            </xs:restriction>
                        </xs:simpleType>

                        <comment> Type for language </comment>
                        <xs:simpleType name="language">
                            <xs:restriction base="xs:string">
                                <xs:enumeration value=""/>
                                <xs:enumeration value="en"/>
                                <xs:enumeration value="fr"/>
                                <xs:enumeration value="es"/>
                            </xs:restriction>
                        </xs:simpleType>

                        <comment> Type for link </comment>
                        <xs:simpleType name="link">
                            <xs:restriction base="xs:string">
                                <comment> Aproximative regexp for HTTP URLs </comment>
                                <xs:pattern value="(https?\://([^/?#]+)/([^?#]*)(\?([^?#]+))?(#(.*))?)?"/>
                            </xs:restriction>
                        </xs:simpleType>

                    </xs:schema>
                </xml-source>
                <p>
                    XML Schema requires some learning, but for now just consider the following:
                </p>
                <ul>
                    <li>
                        <p>
                            This schema constrains the structure of the <code>books-instance</code> document, i.e. it
                            makes sure that the correct elements are encapsulated. If by mistake you create a
                            <code>&lt;bRook></code> element under <code>&lt;books></code>, this error will be caught.
                        </p>
                    </li>
                    <li>
                        <p>
                            This schema also checks the data types for the rating, language and link. If by mistake you
                            allow a rating with value <code>6</code>, the schema will catch this.
                        </p>
                    </li>
                    <li>
                        <p>
                            A schema is rarely perfect! You can often work more on it and constrain your data in a
                            better way.
                        </p>
                    </li>
                </ul>
                <p>
                    Now create the schema as <code>schema.xsd</code> in the same directory as <code>view.xhtml</code>
                    and <code>page-flow.xml</code>. Then link it to the XForms page as follows:
                </p>
                <xml-source show-namespaces="false" xmlns:xforms="http://www.w3.org/2002/xforms">
                    <xforms:model schema="/apps/xforms-bookcast/schema.xsd">
                        <comment> Rest of the XForms model </comment>
                        ...
                    </xforms:model>
                </xml-source>
                <p>
                    Reload the page, and try to enter an invalid link, for example "ftp://ftp.example.com/". An alert
                    icon will show up as you leave the link field with your cursor.
                </p>
                <note>
                    <p>
                        The URL of the schema, "/apps/xforms-bookcast/schema.xsd", is resolved relatively to the
                        external URL of the Bookcast page, so the schema is actually loaded though:
                    </p>
                    <xml-source>
                        http://localhost:8080/ops/apps/xforms-bookcast/schema.xsd
                    </xml-source>
                    <p>
                        Because retrieving documents through HTTP takes some time, you can also use the Orbeon Forms
                        protocol, <code>oxf:</code>, to load the schema:
                    </p>
                    <xml-source show-namespaces="false" xmlns:xforms="http://www.w3.org/2002/xforms">
                        <xforms:model schema="oxf:/apps/xforms-bookcast/schema.xsd">
                            <comment> Rest of the XForms model </comment>
                            ...
                        </xforms:model>
                    </xml-source>
                    <p>
                        This protocol allows loading files stored as Orbeon Forms resources.
                    </p>
                </note>
                <p>
                    Still with an invalid link, press the "Save" link and check the data in the database. Notice that
                    the invalid data didn't save! This happens because the XForms engine automatically ensures that the
                    data sent by a submission is valid before going on with the actual submission.
                </p>
                <p>
                    It would be nice to tell the user that saving didn't work. You can do this very easily: if a
                    submission error occurs, the <code>&lt;xforms:submission></code> element dispaches the
                    <code>xforms-submit-error</code> event. So let's see how you catch that event and display a message
                    to the user:
                </p>
                <xml-source show-namespaces="false" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:ev="http://www.w3.org/2001/xml-events">
                    <xforms:submission id="save-submission" ref="instance('books-instance')"
                            action="/exist/rest/db/orbeon/xforms-bookcast/books.xml"
                            method="put" replace="none">
                        <xforms:message ev:event="xforms-submit-error" level="modal">An error occurred while saving!</xforms:message>
                    </xforms:submission>
                </xml-source>
                <p>
                    The <code>&lt;xforms:submission></code> element hasn't changed, except we added a nested
                    <code>&lt;xforms:message></code> element. Besides the <code>ev:event</code> attribute, which you
                    start to be familiar with, this element takes a <code>level</code> attribute (use "modal" in general
                    for alerts) and message for the user.
                </p>
                <p>
                    Try now making this change, enter an invalid link, and press the "Save" link: an alert message
                    should show up!
                </p>
                <figure src="../apps/doc/images/tutorial/17.png"/>
            </section>
            <a name="bookcast-atom-feed"/>
            <section>
                <title>The Atom Feed</title>
                <p>
                    Remember, the name of this application is Book<i>cast</i>, which lets suggest that we can expose the
                    list of books as a feed of some sort. Here, you will use the Atom Syndication Format (or Atom in
                    short). Atom is a format very much like RSS but it has been standardized by IETF and is much
                    cleaner than RSS (note that there are at least 6 different versions of RSS). Atom is now supported
                    by most feed readers.
                </p>
                <p>
                    An atom feed looks like this (example from the Atom specification):
                </p>
                <xml-source>
                    <feed xmlns="http://www.w3.org/2005/Atom">

                        <title>Example Feed</title>
                        <link href="http://example.org/"/>
                        <updated>2003-12-13T18:30:02Z</updated>
                        <author>
                            <name>John Doe</name>
                        </author>
                        <id>urn:uuid:60a76c80-d399-11d9-b93C-0003939e0af6</id>

                        <entry>
                            <title>Atom-Powered Robots Run Amok</title>
                            <link href="http://example.org/2003/12/13/atom03"/>
                            <id>urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a</id>
                            <updated>2003-12-13T18:30:02Z</updated>
                            <summary>Some text.</summary>
                        </entry>

                    </feed>
                </xml-source>
                <p>
                    It would be nice if you could use XForms to produce such a format, and in fact in theory this is
                    possible, but Orbeon Forms currently only supports XForms embedded within XHTML. So here you will
                    use XSLT instead. XSLT is an XML transformation language, which can also be used as an XML template
                    language.
                </p>
                <p>
                    But first, it's time to introduce the Model-View-Controller (MVC) support in the page flow.
                    Consider the following page flow declaration:
                </p>
                <xml-source>
                    <page path-info="/my-bookcast/atom" model="atom.xpl" view="atom.xsl"/>
                </xml-source>
                <p>
                    Notice how, instead of an XHTML page view (<code>view.xhtml</code>), you now use:
                </p>
                <ul>
                    <li>
                        <p>
                            A page <i>model</i>, called <code>atom.xpl</code>. This page model has an <code>*.xpl</code>
                            extension, which tells you that it contains an <i>XML pipeline</i>.
                        </p>
                    </li>
                    <li>
                        <p>
                            A page <i>view</i>, called <code>view.xsl</code>. This page view has an <code>*.xsl</code>
                            extension, which tells you that it contains an <i>XSLT stylesheet</i>.
                        </p>
                    </li>
                </ul>
            </section>
            <p>
                So what's the idea page models and page view? The idea is to separate the <i>production</i> of the data
                to display, from the <i>visual formatting</i> of that data. The page model is in charge of the former,
                and the page view of the latter. In the case of the production of the Atom feed:
            </p>
            <ul>
                <li>
                    <p>
                        The page model is in charge of fetching the data (the <code>books.xml</code> document) from
                        the database.
                    </p>
                </li>
                <li>
                    <p>
                        The page view formats that data to produce a valid Atom document.
                    </p>
                </li>
            </ul>
            <p>
                This separation means that you can change how the data is retrieved without changing the formatting
                part, and the other way around. The Orbeon Forms Page Flow Controller (PFC) automatically connects
                page model and page view.
            </p>
            <p>
                Consider the page model:
            </p>
            <xml-source>
                <p:config xmlns:p="http://www.orbeon.com/oxf/pipeline"
                    xmlns:oxf="http://www.orbeon.com/oxf/processors">

                    <p:param name="data" type="output"/>

                    <comment> Execute REST submission </comment>
                    <p:processor name="oxf:xforms-submission">
                        <p:input name="submission">
                            <xforms:submission xmlns:xforms="http://www.w3.org/2002/xforms" serialize="false"
                                               method="get" action="/exist/rest/db/orbeon/xforms-bookcast/books.xml"/>
                        </p:input>
                        <p:input name="request"><dummy/></p:input>
                        <p:output name="response" ref="data"/>
                    </p:processor>

                </p:config>                
            </xml-source>
            <p>
                This document contains an XML pipeline described in a language called XPL (XML Pipeline Language). An
                XML pipeline language is simply a language for describing operations to be performed on XML documents.
                Orbeon Forms comes with an implementation of <a href="http://www.w3.org/Submission/xpl/">XPL</a>.
                (Orbeon is currently working at W3C on the standardization of a pipeline language called <a
                href="http://www.w3.org/TR/xproc/">XProc</a>.)
            </p>
            <p>
                So what does this pipeline do? It runs a <i>processor</i> called <code>oxf:xforms-submission</code>,
                which is handy component that allows you to perform XForms submissions from XPL. That submission
                retrieves <code>books.xml</code> and returns it on the processor's <code>response</code> output. That
                output in turn is sent to the <code>data</code> output of the page model pipeline.
            </p>
            <p>
                Now look at the page view:
            </p>
            <xml-source>
                <feed xmlns="http://www.w3.org/2005/Atom" xmlns:xs="http://www.w3.org/2001/XMLSchema"
                      xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xsl:version="2.0">

                    <title>Orbeon Forms Bookcast</title>
                    <subtitle>An Orbeon Forms tutorial example</subtitle>
                    <updated><xsl:value-of select="current-dateTime()"/></updated>
                    <id>http://www.orbeon.com/ops/xforms-bookcast/</id>
                    <link href="http://www.orbeon.com/"/>
                    <generator uri="http://www.orbeon.com/ops/xforms-bookcast/" version="1.0">Orbeon Forms Bookcast</generator>

                    <xsl:for-each select="/books/book">
                        <entry>
                            <title><xsl:value-of select="concat(author, ' - ', title)"/></title>
                            <id>http://www.orbeon.com/ops/xforms-bookcast/<xsl:value-of select="concat(author, ' - ', title)"/>"/></id>
                            <updated><xsl:value-of select="current-dateTime()"/></updated>
                            <content type="xhtml" xml:lang="en">
                                <div xmlns="http://www.w3.org/1999/xhtml">
                                    <p>
                                        Book information:
                                    </p>
                                    <table>
                                        <tr>
                                            <th>Title</th>
                                            <td><xsl:value-of select="title"/></td>
                                        </tr>
                                        <tr>
                                            <th>Author</th>
                                            <td><xsl:value-of select="author"/></td>
                                        </tr>
                                        <tr>
                                            <th>Language</th>
                                            <td><xsl:value-of select="language"/></td>
                                        </tr>
                                        <tr>
                                            <th>Link</th>
                                            <td><a href="{link}"><xsl:value-of select="link"/></a></td>
                                        </tr>
                                        <tr>
                                            <th>Rating</th>
                                            <xsl:variable name="rating" select="if (rating castable as xs:integer) then xs:integer(rating) else 0" as="xs:integer"/>
                                            <td><xsl:value-of select="string-join(for $i in (1 to $rating) return '*', '')"/></td>
                                        </tr>
                                        <tr>
                                            <th>Notes</th>
                                            <td>
                                                <xsl:for-each select="tokenize(notes, '&amp;#x0a;')">
                                                    <xsl:value-of select="."/>
                                                    <xsl:if test="position() lt last()">
                                                        <br/>
                                                    </xsl:if>
                                                </xsl:for-each>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </content>
                        </entry>
                    </xsl:for-each>
                </feed>
            </xml-source>
            <p>
                This page view is an XSLT document (notice the <code>xsl:version="2.0"</code> attribute on the root
                element). It automatically receives on its main input the document produced by the page model. So if you
                were to write:
            </p>
            <xml-source xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
                <xsl:value-of select="/books/book[1]/title"/>
            </xml-source>
            <p>
                You would get the title of the first book from <code>books.xsl</code>.
            </p>
            <p>
                Now this XSLT document does not use many XSLT constructs:
            </p>
            <ul>
                <li>
                    <p>
                        XSLT relies on XPath, like XForms. So you can reuse your knowledge of XPath when writing XSLT.
                    </p>
                </li>
                <li>
                    <p>
                        <code>&lt;xsl:value-of></code> outputs the text value returned by the XPath expression on the
                        <code>select</code> attribute. It is very similar to <code>&lt;xforms:output></code>.
                    </p>
                </li>
                <li>
                    <p>
                        <code>&lt;xsl:for-each></code> iterates over the nodes returned by the XPath expression on the
                        <code>select</code> attribute. It is very similar to <code>&lt;xforms:repeat></code>.
                    </p>
                </li>
                <li>
                    <p>
                        The brackets in <code>&lt;a href="{link}"></code> mean that the XPath expression
                        <code>link</code> has to be evaluated to produce the <code>href</code> attribute.
                    </p>
                </li>
            </ul>
            <p>
                And that's it! You can now add the entry in <code>page-flow.xml</code>, add the two files
                <code>atom.xpl</code> and <code>atom.xsl</code>, and point your browser to:
            </p>
            <xml-source>
                http://localhost:8080/ops/my-bookcast/atom
            </xml-source>
            <p>
                You should see something similar to this, depending on your browser:
            </p>
            <figure src="../apps/doc/images/tutorial/19.png"/>
            <p>
                To make things even better, add the following to <code>view.xhtml</code> under the
                <code>&lt;head></code> element:
            </p>
            <xml-source>
                <link rel="alternate" type="application/atom+xml" title="Orbeon XForms Bookcast Tutorial Feed" href="atom"/>
            </xml-source>
            <p>
                With this addition, most modern browsers will display a feed icon <icon
                src="../apps/doc/images/tutorial/feed-icon-14x14.png" alt="Feed Icon" width="14" height="14"/> or an RSS
                icon, making the feed directly accessible from the main Bookcast page.
            </p>
            <p>
                You can now try to load the feed into your favorite feed reader! Here is how the Bookcast feed looks in
                the Mozilla Thunderbird feed reader:
            </p>
            <figure src="../apps/doc/images/tutorial/20.png"/>
        </section>
        <a name="bookcast-next"/>
        <section>
            <title>What's Next</title>
            <p>
                So far you have seen:
            </p>
            <ul>
                <li>
                    <p>
                        How to setup Orbeon Forms.
                    </p>
                </li>
                <li>
                    <p>
                        How the basic Hello application is organized.
                    </p>
                </li>
                <li>
                    <p>
                        How to build your own application that allows editing and persisting a form.
                    </p>
                </li>
                <li>
                    <p>
                        How to create an Atom feed from form data.
                    </p>
                </li>
            </ul>
            <p>
                You have now covered a good part of the basics of Orbeon Forms. You can now look at the <a
                href="/">Orbeon Forms example applications</a> and the <a href="/doc/">rest of the Orbeon Forms
                documentation</a>!
            </p>

        <!--

        TODO:

            o more background on XForms?
            o mention XForms 1.1?
            o more on Defining an XML document format
            o more on eXist?
            o explain better XML "nodes"?
            o show example of OF error

            o app: add link to document in eXist (xforms:load)
            o description of "Load Sample Data" button

        <section>
            <title></title>
            <p>

            </p>
            <ul>
                <li>
                    <p>

                    </p>
                </li>
                <li>
                    <p>

                    </p>
                </li>
                <li>
                    <p>

                    </p>
                </li>
                <li>
                    <p>

                    </p>
                </li>
            </ul>
        </section>
        -->
        </section>
    </body>
</document>