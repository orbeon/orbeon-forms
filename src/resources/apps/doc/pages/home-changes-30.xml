<?xml version="1.0" encoding="windows-1252"?>
<!--
    Copyright (C) 2004 Orbeon, Inc.

    The Orbeon documentation is not distributed under the LGPL license. Use of the documentation is
    subject to the following terms:

    * Conversion to other formats is allowed, but the actual content may not be altered or edited
      in any way.

    * You may create printed copies for your own personal use.

    * For all other uses, such as selling printed copies or using (parts of) the manual in another
      publication, prior written agreement from Orbeon, Inc. is required.

    Please contact Orbeon at info@orbeon.com for more information.
-->
<document xmlns:p="http://www.orbeon.com/oxf/pipeline" xmlns:xforms="http://www.w3.org/2002/xforms"
        xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:xxforms="http://orbeon.org/oxf/xml/xforms"
        xmlns:oxf="http://www.orbeon.com/oxf/processors" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:sql="http://orbeon.org/oxf/xml/sql" xmlns:xs="http://www.w3.org/2001/XMLSchema"
        xmlns:xi="http://www.w3.org/2003/XInclude" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <header>
        <title>Changes in Version 3.0</title>
    </header>
    <body>
        <a name="introduction"/>
        <section>
            <title>Introduction</title>
            <p>
                Welcome to Orbeon PresentationServer (OPS) 3.0!
            </p>
            <p>
                OPS 3.0 features an Ajax-based XForms engine much improved over OPS 2.8's, significant improvements in
                the Page Flow Controller, and much more!
            </p>
            <p>
                This document describes changes made between OPS 2.8 and OPS 3.0.1.
            </p>
        </section>
        <section>
            <title>Changes in Version 3.0.1</title>
            <p>
                OPS 3.0.1 is a minor update containing the following changes:
            </p>
            <ul>
                <li>
                    <p>
                        The new <a href="/forms/">DMV Forms</a> example (see also the <a href="/forms">standalone
                        version</a>) shows how to implement web forms the right way with XForms, services and OPS. This
                        example is based on a real-life form (a California Department of Motor Vehicles form) and
                        illustrates data capture, validation, calling up services, repeating sections, generating PDF,
                        page navigation, and localization.
                    </p>
                </li>
                <li>
                    <p>
                        Bug-fixes in the XForms engine, including:
                    </p>
                    <ul>
                        <li>
                            <a
                            href="http://forge.objectweb.org/tracker/index.php?func=detail&amp;aid=304533&amp;group_id=168&amp;atid=350207">Read-only
                            change does not change display of select1 element</a>
                        </li>
                        <li>
                            <a href="http://forge.objectweb.org/tracker/index.php?func=detail&amp;aid=304540&amp;group_id=168&amp;atid=350207">Trigger as
                            link doesn't appear read-only and still reacts to clicks</a>
                        </li>
                        <li>
                            <a
                            href="http://forge.objectweb.org/tracker/index.php?func=detail&amp;aid=304584&amp;group_id=168&amp;atid=350207">DMV
                            Forms example: clicking many times quickly on "Add Vehicle"... adds
                            them</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <p>
                        Fixed XPL performance regression introduced with OPS 3.0.
                    </p>
                </li>
                <li>
                    <p>
                        Minor documentation and CSS improvements.
                    </p>
                </li>
            </ul>
        </section>
        <section>
            <title>Changes in Version 3.0.0</title>
            <a name="limitations"/>
            <section>
                <title>Known Limitations of OPS 3.0</title>
                <p>
                    The following limitations are known:
                </p>
                <ul>
                    <li>
                        <p>
                            XForms upload controls only work within forms that are submitted with a
                            reference to a submission element with <code>replace="all"</code>. The value
                            of XForms upload controls is ignored when forms are submitted with
                            <code>replace="instance"</code> or <code>replace="none"</code>.
                        </p>
                    </li>
                    <li>
                        <p>
                            At most one XML schema is allowed on a particular XForms model.
                        </p>
                    </li>
                    <li>
                        <p>
                            Calculation dependencies are not computed as per the XForms 1.0
                            specification. With OPS 3.0, first the calculations are evaluated in the
                            order they appear in your XForms model. Then the required, relevant, and
                            readonly model item properties are evaluated, also in the order they appear
                            in your XForms model. This means that you have to be careful with the order
                            in which you declare your <code>&lt;xforms:bind></code> elements.
                        </p>
                    </li>
                    <li>
                        <p>
                            <code>xforms:message</code> only supports <code>level="modal"</code>.
                        </p>
                    </li>
                    <li>
                        <p>
                            The Ajax-based XForms engine currently works with Mozilla Firefox and
                            Microsoft Internet Explorer 6. Support for Safari and Opera is planned.
                        </p>
                    </li>
                    <li>
                        <p>
                            The Orbeon PresentationServer Tutorial has not been updated to reflect the
                            new features and best practices of OPS 3.0.
                        </p>
                    </li>
                    <li>
                        <p>
                            Initial generation of an XForms page may still have poor performance in some
                            circumstances.
                        </p>
                    </li>
                    <li>
                        <p>
                            Not all the OPS examples have been updated to reflect the new XForms engine
                            capabilities.
                        </p>
                    </li>
                    <li>
                        <p>
                            The OPS reference XForms documentation is a work in progress. Please refer
                            to the "XForms NG" examples for details.
                        </p>
                    </li>
                    <li>
                        <p>
                            The OPS reference XForms compliance matrix has not yet been updated to
                            reflect all the changes in OPS 3.0.
                        </p>
                    </li>
                    <li>
                        <p>
                            Migration documentation from 2.8 to 3.0 is not complete yet.
                        </p>
                    </li>
                    <li>
                        <p>
                            The OPS Blog example is not complete.
                        </p>
                    </li>
                    <li>
                        <p>
                            The PDF version of the User Guide does not have page numbers.
                        </p>
                    </li>
                </ul>
                <p>
                    Please also visit the <a href="http://forge.objectweb.org/tracker/?group_id=168">OPS
                    bug tracker</a> on the ObjectWeb Forge, and report and discuss issues in the <a
                    href="http://forge.objectweb.org/mail/?group_id=168">ops-users mailing-list</a>.
                </p>
            </section>
            <a name="xforms"/>
            <section>
                <title>XForms</title>
                <section>
                    <title>New Features</title>
                    <p>
                        The OPS XForms engine introduces a big step towards supporting all of the XForms 1.0
                        specification. The main changes are described below. Please also visit the new XForms examples,
                        in particular the <a href="/xforms-controls/">XForms Controls</a>, the <a
                        href="/goto-example/bizdoc2">BizDoc NG</a> example, and the <a href="/xforms-sandbox/">XForms
                        Sandbox</a> example. XForms improvements in OPS 3.0 include but are not limited to:
                    </p>
                    <ul>
                        <li>
                            <p>
                                <b>Ajax-based engine.</b> The XForms engine is now based on Ajax
                                technologies. This makes the XForms engine much more responsive to user
                                interaction than with OPS 2.8.
                            </p>
                            <note>
                                We sometimes informally refer to the XForms engine present in OPS 2.8
                                and earlier (but also present in OPS 3.0 for backward compatibility) as
                                the <i>Classic XForms engine</i> or, in short, as <i>XForms
                                Classic</i>. We refer to the new Ajax-based XForms engine, present in
                                OPS 3.0 and forward, as the <i>Next Generation XForms engine</i> or, in
                                short, as <i>XForms NG</i>.
                            </note>
                        </li>
                        <li>
                            <p>
                                <b>Standard XHTML integration.</b> The XForms engine works on standard XHTML
                                + XForms documents, without the need for a separately described XForms model
                                as was the case with OPS 2.8. XForms models are simply included in the
                                XHTML page view under the <code>&lt;xhtml:head&gt;</code> element, as
                                recommended by XForms 1.0. In this mode, you don't use the
                                <code>xforms</code> attribute on the PFC <code>&lt;page&gt;</code>
                                elements. The <code>xforms</code> attribute is still supported for backward
                                compatibility, but its use triggers the use of the legacy OPS 2.8 XForms
                                engine.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>XForms event model.</b> The XForms engine supports the XForms event
                                model, including most XForms events and XForms actions.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>Multiple XForms models and instances.</b> The XForms engine supports
                                multiple models and multiple instances within models. The
                                <code>instance()</code> function is supported.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>XForms switch module.</b> The XForms engine supports the XForms
                                switch module.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>XForms repeat module.</b> The XForms engine supports correctly the
                                current index in repeated sections, including the <code>index()</code>
                                function.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>XForms submission.</b> The XForms engine supports submitting forms as
                                <code>application/xml</code> with HTTP POST and
                                <code>application/x-www-form-urlencoded</code> with HTTP GET (including
                                to external applications). Support for <code>replace="instance"</code>,
                                <code>replace="all"</code>, and <code>replace="none"</code> is included.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>XForms Range control.</b> The XForms engine supports a subset of the
                                functionality of the XForms Range (or slider) control.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>Extension functions.</b> The XForms engine supports the
                                <code>xxforms:call-xpl()</code> <a
                                href="reference-xforms-ng#ops-extensions">extension function</a> to call
                                arbitrary XPL programs from XForms, as well as some eXforms functions.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>Dynamic XForms models.</b> The new XForms engine and PFC improvements
                                now allow to easily generate XForms models based on XML submissions. With
                                OPS 2.8, this was much more difficult as this had to be done in a dynamic
                                XForms model pipeline, which did not have access to an XML submission.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>Simplified theme.</b> The default theme and XForms make more use of CSS
                                so that configuration of your own theme is easier.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>XForms sandbox.</b> The new <a href="/xforms-sandbox/">XForms Sandbox</a> example
                                allows you to easily try your own XForms examples. Just write and XHTML + XForms
                                example, upload it, and watch the results!
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>Other changes.</b> The XForms engine supports the <code>value</code>
                                attribute on <code>xforms:output</code>, handles inheritance of model item
                                properties, and includes numerous improvements and bug fixes.
                            </p>
                        </li>
                    </ul>
                    <!--
                    <p>
                        TODO: link to updated XForms conformance map.
                    </p>
                    -->
                </section>
                <section>
                    <title>Incompatible changes</title>
                    <ul>
                        <li>
                            <p>
                                XSLT views now must always use <code>doc('input:instance')</code> to access
                                a submitted XML instance instead of expecting the instance on their main
                                input.
                            </p>
                        </li>
                        <li>
                            <p>
                                With OPS 2.8 if your XForms instance was:
                            </p>
                            <xml-source>
                                <credit-card>
                                    <type>visa</type>
                                    ...
                                </credit-card>
                            </xml-source>
                            <p>
                                and your first XForms element under the <code>&lt;xhtml:body&gt;</code>
                                element was:
                            </p>
                            <xml-source>
                                <xforms:group ref="credit-card"/>
                            </xml-source>
                            <p>
                                then <code>credit-card</code> would evaluate against the <i>document
                                node</i> of the unique XForms instance. The above code worked, but this
                                behavior was incorrect. The XPath evaluation context for top-level XForms
                                controls has to be the root <i>element</i> of the default XForms instance
                                instead. This means that the code above must be changed in one of two ways:
                            </p>
                            <xml-source>
                                <xforms:group ref="/credit-card"/>
                            </xml-source>
                            <p>
                                or:
                            </p>
                            <xml-source>
                                <xforms:group ref="."/>
                            </xml-source>
                            <p>
                                If you use absolute XPath expressions for your top-level XForms
                                controls, no change is necessary.
                            </p>
                        </li>
                        <li>
                            <p>
                                With OPS 2.8, the "required" model item property did not apply at all to
                                elements validated with XML schemas. If for example a value was of type
                                <code>xs:string</code> but missing and required, it was marked as valid
                                (which was correct) but submission would pass. With OPS 3.0, nodes
                                which are "valid", "required" and empty will cause submission to fail.
                                Be sure to check your types and "required" model item properties.
                            </p>
                        </li>
                        <li>
                            <p>
                                The <code>xxforms:choose</code>, <code>xxforms:when</code> and
                                <code>xxforms:otherwise</code> constructs are no longer supported with
                                the new XForms engine. Instead, use relevance and
                                <code>xforms:group</code> or <code>xforms:switch</code> /
                                <code>xforms:case</code>.
                            </p>
                        </li>
                    </ul>
                </section>
                <a name="xforms-migration"/>
                <section>
                    <title>Migrating to the OPS 3.0 XForms Engine</title>
                    <warning>
                        <p>
                            Your applications written against OPS 2.8 and run within OPS 3.0 without
                            modifications uses the Classic XForms engine of OPS 3.0. In order to
                            trigger the use of XForms NG and benefit from all the new XForms features of
                            OPS 3.0, some code migration work is required. Note that it is possible to
                            determine on a page by page basis whether XForms Classic or XForms NG is
                            used, and therefore to progressively upgrade your application to XForms NG.
                        </p>
                    </warning>
                    <p>
                        When migrating an application from XForms Classic to XForms NG, a series of
                        tasks need to be performed, as the OPS XForms engine is now much closer from
                        the XForms 1.0 specification. The following list attemps to describe the most
                        common aspects of the migration. It does not intend to be inclusive:
                    </p>
                    <ul>
                        <li>
                            <p>
                                <b>XForms model migration.</b> For a given <code>&lt;page&gt;</code>
                                element: if your OPS 2.8 XForms model is static (which is usually the
                                case), copy it under your XHTML page view's <code>xhtml:head</code>
                                element. Then remove the <code>xforms</code> attribute from the
                                <code>&lt;page&gt;</code> element. You can then remove the file
                                containing your XForms model.
                            </p>
                            <xml-source show-namespaces="false">
                                <xhtml:head>
                                    <xhtml:title>My Title</xhtml:title>
                                    <xforms:model id="my-model">
                                        <xforms:instance id="main">
                                            ...
                                        </xforms:instance>
                                        ...
                                    </xforms:model>
                                </xhtml:head>
                            </xml-source>
                            <p>
                                Another possibility is to keep your XForms model file, and to XInclude
                                that file in your XHTML page view under the <code>xhtml:head</code>
                                element.
                            </p>
                            <xml-source show-namespaces="false">
                                <xhtml:head>
                                    <xhtml:title>My Title</xhtml:title>
                                    <xi:include href="my-model.xml"/>
                                </xhtml:head>
                            </xml-source>
                            <p>
                                Here again, you must remove the <code>xforms</code> attribute
                                from the <code>&lt;page&gt;</code> element.
                            </p>
                            <p>
                                If your XForms model is dynamic, then you can use XSLT in your page
                                view to dynamically produce the model:
                            </p>
                            <xml-source show-namespaces="false">
                                <xhtml:head>
                                    <xhtml:title>My Title</xhtml:title>
                                    <xforms:model id="my-model">
                                        <xforms:instance id="main">
                                            <form>
                                                <name>
                                                    <xsl:value-of select="doc('input:data')/*/my-name"/>
                                                </name>
                                                ...
                                            </form>
                                        </xforms:instance>
                                        ...
                                    </xforms:model>
                                </xhtml:head>
                            </xml-source>
                            <p>
                                The PFC now provides XML submissions on the page models, views and
                                actions' <code>instance</code> inputs. This allows for easily building
                                dynamic XForms models from an XML submission, including an XForms
                                submission, which was difficult to do before. In the example above, the
                                current XML submission can be accessed from XSLT in the page view with
                                <code>doc('input:instance')</code>.
                            </p>
                            <p>
                                For more information, visit the XForms Reference's <a
                                href="reference-xforms-ng#xforms-instance-initialization">XForms
                                Instance Initialization</a> section and the Page Flow Controller's <a
                                href="reference-page-flow#xml-submission">XML Submission</a> section.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>Required attributes.</b> Some controls now require certain
                                attributes, as per the XForms 1.0 specification. In particular:
                            </p>
                            <ul>
                                <li>
                                    <code>xforms:submit</code> now requires a <code>submission</code>
                                    attribute.
                                </li>
                                <li>
                                    XForms actions, including <code>xforms:setvalue</code>, need an
                                    <code>ev:event</code> attribute, or need to be enclosed within and
                                    <code>xforms:action</code> element with an <code>ev:event</code>
                                    attribute.
                                </li>
                                <li>
                                    The <code>xforms:submission</code> element now requires an
                                    <code>id</code> attribute to be useful (by being referred from the
                                    <code>submission</code> attribute of <code>xforms:submit</code> or
                                    <code>xforms:send</code>). Attributes <code>action</code> and
                                    <code>method</code> are also mandatory.
                                </li>
                            </ul>
                        </li>
                        <li>
                            <p>
                                <b>Validation processing model.</b> As per the XForms specification,
                                invalid XForms instances, or XForms instances with missing required
                                elements cannot be submitted and instead throw
                                <code>xforms-submit-error</code> events. This means that there is no
                                longer a need to check on <code>xxforms:valid</code> attributes in the
                                page flow to determine whether a submitted XForms instance is valid or
                                not.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>Page flow roundtrips.</b> <code>xforms:repeat</code> updates (threw
                                actions such as <code>xforms:insert</code> and
                                <code>xforms:delete</code>) are no longer visible in the page flow. With
                                XForms Classic, upon inserting or deleting a row with those actions,
                                the entire form would be submitted, giving an opportunity to the page
                                flow to intercept and regenerate the page. With XForms NG, these
                                actions operate within the XForms engine.
                            </p>
                            <p>
                                Use XForms submissions with <code>replace="none"</code> or
                                <code>replace="instance"</code> if you need to submit an XForms instance
                                to the page flow before or after performing such actions.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>XForms events and actions.</b> Many operations can now be performed
                                with XForms events an actions, rather than using
                                <code>xforms:setvalue</code> in an <code>xforms:submit</code> and then
                                performing a complete submission.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>XML services and page flow.</b> Because the XForms engine now
                                operates completely separately from the page flow, XForms pages must now
                                explicitly perform XForms submissions to interact with pages defined in
                                your page flow.
                            </p>
                            <p>
                                In particular, when using an XForms submission with
                                <code>replace="none"</code> or <code>replace="instance"</code>, the page
                                flow can now be used to implement <i>XML services</i>, that is services
                                that receive XML (through the XForms submission) and produce XML as a
                                result. Such services are implemented in your page flow as usual with
                                <code>&lt;page></code> elements, and differ with regular pages only in
                                that they either do not return any result, or return an XML document as
                                result as opposed to return a complete HTML page.
                            </p>
                        </li>
                    </ul>
                </section>
            </section>
            <a name="page-flow"/>
            <section>
                <title>Page Flow</title>
                <section>
                    <title>New Features</title>
                    <p>
                        Several improvements have been added to the Page Flow Controller, some of them
                        motivated by the new XForms engine. The PFC is now more generic and less tied to
                        the built-in OPS XForms implementation. At the same time it plays better than before
                        with XForms, including client-side XForms engines. The major PFC concepts found
                        with OPS 2.8 have not changed and backward compatibility is kept. The main changes
                        are the following:
                    </p>
                    <ul>
                        <li>
                            <p>
                                <b>Documentation.</b> The <a href="reference-page-flow">PFC
                                documentation</a> has been reworked and greatly improved.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>Standard Epilogue.</b> The standard epilogue has been restructured into
                                three separate files so as to be easier to understand, modify, and extend.
                                It is <a href="reference-epilogue">fully documented</a>.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>Deprecation of the <code>xforms</code> attribute.</b> Using XForms with OPS
                                no longer implies using an <code>xforms</code> attribute on the
                                <code>&lt;page&gt;</code> element. Instead, XForms models are included in
                                the XHTML page view under the <code>&lt;xhtml:head&gt;</code> element, as
                                recommended by XForms 1.0. The <code>xforms</code> attribute is still
                                supported for backward compatibility, and triggers the use of the legacy OPS
                                2.8 XForms engine.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>New XML submission mechanism.</b> The PFC features a new generic XML
                                submission mechanism. Each page in the PFC, instead of supporting native
                                OPS XForms engine submissions, now supports generic XML submissions. You
                                submit XML by POST-ing content with an XML content-type (other types of XML
                                submissions can be added). XML submissions can be performed from external
                                applications (through Web Services, XML-RPC, etc.), client-side XForms
                                engines, the built-in OPS XForms engine, or by the PFC itself when
                                navigating between pages.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>Deprecation of the <code>&lt;param&gt;</code> element.</b> The PFC's
                                <code>&lt;param&gt;</code> element was used to set values into a submitted
                                XForms instance. A new, more flexible element,
                                <code>&lt;setvalue&gt;</code>, now performs the same task. The
                                <code>&lt;setvalue&gt;</code> element supports extracting information from
                                regular expressions applied to the request path, as well as extracting
                                request parameters. This allows for creating "clean", REST-like URLs in
                                your appliation. <code>param</code> is still supported for backward
                                compatibility.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>Generic XML submission transformations.</b> The PFC features a new
                                generic and extensible XML submission transformation mechanism. With OPS
                                2.8, XUpdate code had to be used to transform XML instances between pages.
                                XUpdate support in the PFC is now deprecated. Instead, XSLT or XQuery
                                should be used for that purpose. For more information, please refer to the
                                <a href="reference-page-flow#result-element"><code>&lt;result&gt;</code>
                                element section</a> of the PFC documentation.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>Accessing XML submissions.</b> XML submissions can be accessed from
                                actions, page models, and page views, through the <code>instance</code>
                                input. Users should not assume that XML submission are available from
                                the <code>data</code> inputs.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>Shorter page flows.</b> Because of the enhanced XForms support, in particular, the
                                XForms switch module and support for <code>application/xml</code> submissions, page
                                flows are typically shorter to write. Compare for example the <a
                                href="/goto-example/bizdoc">BizDoc Classic</a> example with the <a
                                href="/goto-example/bizdoc2">BizDoc NG</a> example.
                            </p>
                        </li>
                        <!--
                        <li>
                            <p>
                                Tracing: TODO
                            </p>
                        </li>
                        -->
                    </ul>
                </section>
                <section>
                    <title>Incompatible Changes</title>
                    <p>
                        The following incompatible changes have been made:
                    </p>
                    <ul>
                        <li>
                            <p>
                                <b>Optional Epilogue Output.</b> Support for the legacy
                                <code>data</code> output of the epilogue has been dropped. With OPS 2.8
                                and earlier, the epilogue could have a <code>data</code> output. The
                                PFC was then in charge of HTML serialization. This is no longer
                                possible: serialization must occur in the epilogue itself. If you have
                                code relying on this feature, simply remove the epilogue's
                                <code>data</code> output and add an HTML serializer to your epilogue.
                            </p>
                        </li>
                    </ul>
                </section>
            </section>
            <a name="xslt"/>
            <section>
                <title>XSLT processor</title>
                <p>
                    The following improvements have been made to the XSLT processor:
                </p>
                <ul>
                    <li>
                        <p>
                            <b>Attributes input.</b> The <a href="/doc/processors-xslt">XSLT
                            processor</a> supports a new <code>attributes</code> input, which allows
                            setting JAXP TransformerFactory attributes.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>Safer defaults.</b> The default <a href="/doc/processors-xslt">XSLT
                            processor</a> (accessed with <code>oxf:xslt</code>, and configured in
                            <code>processors.xml</code>) no longer allows executing external functions.
                            To enable external functions, use <code>oxf:unsafe-xslt</code>, or configure
                            the XSLT processor's <code>attributes</code> input. This makes the XSLT
                            processor safer by default.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>Default implementation.</b> The default XSLT 1.0 processor
                            implementation, configured in <code>processors.xml</code>, is now Saxon 8
                            instead of Xalan. The default XSLT 2.0 implementation remains Saxon 8, as
                            was the case before.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>Deprecated behavior.</b> The <a href="/doc/processors-xslt">XSLT
                            processor</a> used to support a value of <code>DEFAULT</code> or
                            <code>interpreter</code> for the <code>transformer</code> input, for
                            backward compatibility. This is no longer supported. The
                            <code>transformer</code> must provide only a valid JAXP TransformerFactory
                            class name. Most users should not be affected by this change.
                        </p>
                    </li>
                </ul>
                <note>
                    <p>
                        These changes should not affect applications that used <code>oxf:xslt</code>
                        unless stylesheets use external functions. In this case, you have to use
                        <code>oxf:unsafe-xslt</code> instead.
                    </p>
                    <p>
                        If you were using <code>oxf:xslt-1.0</code> or were using XSLT 1.0 stylesheets
                        directly referenced from a page flow, and used Xalan-specific features, you
                        have to either convert your stylesheet to use Saxon features instead, or use
                        <code>oxf:xalan</code>.
                    </p>
                </note>
            </section>
            <a name="xquery"/>
            <section>
                <title>XQuery processor</title>
                <p>
                    The XQuery processor has been updated:
                </p>
                <ul>
                    <li>
                        <p>
                            <b>Default implementation.</b> The default implementation of the XQuery
                            processor is now Saxon 8.
                       </p>
                    </li>
                    <li>
                        <p>
                            <b>Safer defaults.</b> This processor is available with
                            <code>oxf:xquery</code> or <code>oxf:unsafe-xquery</code>. The former does
                            not allow calling external functions by default, while the latter does,
                            similar to the new behavior of the XSLT processor.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>Query format.</b> In addition to XQuery code embedded into XML, the
                            XQuery processor now supports in its <code>config</code> input a <a
                            href="reference-formats#text-documents">text document</a> of the form:
                        </p>
                        <xml-source>
                            <document xsi:type="xs:string" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                                xquery version "1.0";
                                ...
                            </document>
                        </xml-source>
                    </li>
                    <li>
                        <p>
                            <b>PFC integration.</b> XQuery can be used in the PFC to perform XML
                            submission transformations.
                        </p>
                    </li>
                </ul>
            </section>
            <a name="xhtml"/>
            <section>
                <title>XHTML Support</title>
                <p>
                    XHTML is now much better supported:
                </p>
                <ul>
                    <li>
                        <p>
                            <b>Simplified theme.</b> There is no need to remove the XHTML namespace
                            from XSLT, as was done before in <code>theme.xsl</code>. Your theme should
                            simply use the XHTML namespace.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>Switching between XHTML and HTML.</b> The standard epilogue illustrates
                            how to generate XHTML and HTML to different browsers.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>Using XHTML serialization.</b> The standard epilogue illustrates how to
                            to connect the XHTML serializer.
                        </p>
                    </li>
                </ul>
                <note>
                    <p>
                        In order to benefit from features such as XForms, you should make sure that
                        your page views generate XHTML. In particular, your XHTML elements must in the
                        XHTML namespace (<code>http://www.w3.org/1999/xhtml</code>).
                    </p>
                </note>
            </section>
            <a name="sql"/>
            <section>
                <title>SQL Processor</title>
                <section>
                    <title>New Features</title>
                    <p>
                        The following changes have been made to the SQL processor.
                    </p>
                    <ul>
                        <li>
                            <p>
                                <b>Stored Procedures.</b> The SQL processor now uses the JDBC
                                <code>CallableStatement</code> interface when <code>sql:call</code> is
                                used instead of <code>sql:query</code>. This allows for calling stored
                                procedures using the JDBC escape syntax, for example:
                            </p>
                            <xml-source>
                                <sql:call>
                                    { call SalesByCategory(<sql:param type="xs:string" select="/*/category"/>,
                                                           <sql:param type="xs:int" select="/*/year"/>) }
                                </sql:call>
                            </xml-source>
                            <note>
                                <code>OUT</code> and <code>INOUT</code> parameters are not yet supported.
                            </note>
                        </li>
                        <li>
                            <p>
                                <b>Multiple Result-Sets.</b> The SQL processor now supports multiple
                                result-sets. It is possible to handle the result-sets returned by a query or
                                call individually for each result-set, or globally for all result-sets,
                                using the <code>sql:result-set</code> element. The optional
                                <code>result-sets</code> attribute specifies how many result-sets are
                                handled by a given <code>sql:result-set</code> element. If not specified,
                                the default is one result-set. If the value is <code>unbounded</code>, the
                                <code>sql:result-set</code> element handles all the remaining result-sets
                                returned by the statement execution. Otherwise, a positive number of
                                result-sets must be specified.
                            </p>
                            <xml-source>
                                <comment>Handle the first two result-sets</comment>
                                <sql:result-set result-sets="2">
                                    <my-first-result-sets>
                                        <sql:row-iterator>
                                            <row>
                                                <sql:get-columns format="xml"/>
                                            </row>
                                        </sql:row-iterator>
                                    </my-first-result-sets>
                                </sql:result-set>
                                <comment>Handle All the remaining result-sets</comment>
                                <sql:result-set result-sets="unbounded">
                                    <my-other-result-sets>
                                        <sql:row-iterator>
                                            <row>
                                                <sql:get-columns format="xml"/>
                                            </row>
                                        </sql:row-iterator>
                                    </my-other-result-sets>
                                </sql:result-set>
                                <comment>This will be executed if no row was returned by any result-set</comment>
                                <sql:no-results>
                                    <there-are-no-results/>
                                </sql:no-results>
                            </xml-source>
                            <p>
                                <code>sql:no-results</code> has been updated to execute when none of the
                                previous <code>sql:result-set</code> elements returned rows.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>Column Iterator.</b> The SQL processor is now able to explicitly
                                iterate over all the columns returned by a result-set with the
                                <code>sql:column-iterator</code> element. A column iterator can be used
                                under the <code>sql:result-set</code> element, or under the
                                <code>sql:row-iterator</code> element. This allows for example easily
                                extracting column metadata:
                            </p>
                            <xml-source>
                                <sql:result-set>
                                    <metadata>
                                        <sql:column-iterator>
                                            <column>
                                                <sql:attribute name="index">
                                                    <sql:get-column-index/>
                                                </sql:attribute>
                                                <sql:attribute name="name">
                                                    <sql:get-column-name/>
                                                </sql:attribute>
                                                <sql:attribute name="type">
                                                    <sql:get-column-type/>
                                                </sql:attribute>
                                                <index><sql:get-column-index/></index>
                                                <name><sql:get-column-name/></name>
                                                <type><sql:get-column-type/></type>
                                            </column>
                                        </sql:column-iterator>
                                    </metadata>
                                </sql:result-set>
                            </xml-source>
                        </li>
                        <li>
                            <p>
                                <b>Result-Set Metadata.</b> The SQL processor is now able to retrieve
                                result-set metadata, with the following new elements. The must be used
                                within a <code>sql:column-iterator</code> element, unless a
                                <code>column-name</code> or <code>column-index</code> attribute is
                                explicitly specified:
                            </p>
                            <ul>
                                <li>
                                    <code>sql:get-column-index</code>: retrieves the current column index.
                                </li>
                                <li>
                                    <code>sql:get-column-name</code>: retrieves the current column name.
                                </li>
                                <li>
                                    <code>sql:get-column-type</code>: retrieves the current column type name
                                    as returned by result-set metadata.
                                </li>
                            </ul>
                        </li>
                        <li>
                            <p>
                                <b>Outputting Attributes.</b> The SQL processor is now able to dynamically
                                generate new attributes with the <code>sql:attribute</code> element, for
                                example:
                            </p>
                            <xml-source>
                                <sql:attribute name="index">
                                    <sql:get-column-index/>
                                </sql:attribute>
                            </xml-source>
                        </li>
                        <li>
                            <p>
                                <b>Optional XML Type Information.</b> The XML type (specified with
                                <code>type="xs:int"</code>, for example) is now optional on column getters.
                                If not specified, a default type obtained from the result-set metadata is
                                used to determine how to best get the value from the result-set.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>New Element and Attribute Names.</b> Some element and attributes have
                                been renamed. The old names are still supported for backward compatibility:
                            </p>
                            <ul>
                                <li>
                                    <code>sql:results</code> has been renamed to
                                    <code>sql:result-set</code>.
                                </li>
                                <li>
                                    <code>sql:row-results</code> has been renamed to
                                    <code>sql:row-iterator</code>.
                                </li>
                                <li>
                                    <code>sql:get-column</code> has been renamed to
                                    <code>sql:get-column-value</code>, for consistency with the new
                                    <code>sql:get-column-*</code> elements.
                                </li>
                                <li>
                                    <code>column-name</code> is now the standard attribute name for
                                    identifying a column name on the <code>sql:get-column-*</code>,
                                    <code>sql:get-column</code>, and <code>sql:group</code> elements.
                                </li>
                            </ul>
                        </li>
                    </ul>
                </section>
                <section>
                    <title>Incompatible Changes</title>
                    <p>
                        The following incompatible changes have been made:
                    </p>
                    <ul>
                        <li>
                            <p>
                                <b>Legacy Types.</b> Backward compatibility with pre-OPS 2.0
                                <code>int</code> and <code>string</code> types has been removed. Use
                                <code>xs:int</code> and <code>xs:string</code> instead, while declaring the
                                <code>xs</code> prefix as explained below.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>Implicit Type Prefixes.</b> Legacy support for implicit type prefixes
                                (<code>xs</code> and <code>oxf</code>) is deprecated. Backward compability
                                is enabled with the <code>legacy-implicit-prefixes</code> property as
                                follows:
                            </p>
                            <xml-source>
                                <property as="xs:boolean" processor-name="oxf:sql" name="legacy-implicit-prefixes" value="true"/>
                            </xml-source>
                            <p>
                                When this property is missing or set to <code>false</code>, type prefixes
                                must be mapped as is customary for XML vocabularies. Add the following
                                namespace declarations:
                                <code>xmlns:xs="http://www.w3.org/2001/XMLSchema"</code> and
                                <code>xmlns:odt="http://orbeon.org/oxf/xml/datatypes"</code>. Doing so then
                                allows using data types as before, for example <code>xs:string</code> or
                                <code>odt:xmlFragment</code>.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>Stricter Type Checking</b>. Column getters are now checked against
                                result-set column metadata. In the past, using <code>xs:string</code> for a
                                column of type <code>INTEGER</code> was allowed. Now if an XML type is
                                specified, the XML type must match the SQL type. Alternatively, as mentioned
                                above, it is possible to not specify an XML type at all.
                            </p>
                        </li>
                    </ul>
                </section>
            </section>
            <a name="file-serializer"/>
            <section>
                <title>File Serializer</title>
                <section>
                    <title>Incompatible changes</title>
                    <p>
                        The File serializer now works like the HTTP serializer: it only accepts <a
                        href="reference-formats">text and binary</a> documents as input, and no longer
                        handles conversions to XML, HTML, XHTML or text. To serialize to a file XML, HTML,
                        XHTML or plain text, connect the <a href="processors-converters"> XML, HTML or Text
                        converters</a> to the File serializer.
                    </p>
                    <p>
                        The legacy, deprecated File serializer is still available as
                        <code>oxf:legacy-file-serializer</code>.
                    </p>
                </section>
            </section>
            <a name="error-reporting"/>
            <section>
                <title>Enhanced Error Reporting</title>
                <p>
                    The following enhancements have been made to the error reporting on OPS:
                </p>
                <ul>
                    <li>
                        <p>
                            <b>OPS Stack Trace.</b> When a Java exception occurs, OPS now reports the
                            OPS stack trace, which provides useful OPS-oriented information about the
                            events leading to an exception.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>Java Stack Traces.</b>
                        </p>
                        <ul>
                            <li>
                                <p>
                                    Java stack traces are split into their different request
                                    components. For example, an exception may have been produced by a
                                    request on the OPSServlet, forwarded again to OPSServlet, then going
                                    through the OPS example portals OPSPortlet. In this case, the stack
                                    trace is split into three parts for clarity.
                                </p>
                            </li>
                            <li>
                                <p>
                                    Some coloring is applied to the class names to easily distinguish
                                    OPS classes from third-party classes.
                                </p>
                            </li>
                            <li>
                                <p>
                                    As OPS users may have noticed, Java stack traces can be quite long
                                    due to the streamed nature of the execution of XPL pipelines.
                                    Exceptions are now initially folded, except for the first few
                                    lines, and expandable on click.
                                </p>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <p>
                            <b>Separate Stylesheet.</b> The XSLT stylesheet used to format stack traces
                            is not in a separate file: <code>oxf:/config/error.xsl</code>.
                        </p>
                    </li>
                </ul>
                <p>
                    Like with OPS 2.8 and earlier, the layout of the stack traces traces can be
                    customized: simply edit <code>oxf:/config/error.xpl</code> and
                    <code>oxf:/config/error.xsl</code>. More advanced configuration can be performed by
                    changing the <a href="reference-error-pipeline">error processor</a>.
                </p>
            </section>
            <a name="xpl-profiling"/>
            <section>
                <title>XPL Profiling Support</title>
                <ul>
                    <li>
                        <p>
                            A trace API has been added. The interface is
                            <code>org.orbeon.oxf.pipeline.api.PipelineContext.Trace</code>
                        </p>
                    </li>
                    <li>
                        <p>
                            OPS ships with two implementations of <code>Trace</code>,
                            <code>org.orbeon.oxf.processor.NetworkTrace</code> and
                            <code>org.orbeon.oxf.processor.StdOutTrace</code>.
                            <code>NetworkTrace</code> sends profiling information to Studio which the
                            displays the data in the trace views.  <code>StdOutTrace</code> simply
                            dumps profiling information to standard out.
                        </p>
                    </li>
                    <li>
                        <p>
                            <a href='reference-properties'>Properties</a> for configuring the tracing
                            have been added.
                        </p>
                    </li>
                    <li>
                        <p>
                            Views for viewing profiling data have been added to Orbeon Studio.
                        </p>
                    </li>
                </ul>
            </section>
            <a name="other"/>
            <section>
                <title>Other Changes</title>
                <p>
                    The following changes are new in OPS 3.0:
                </p>
                <ul>
                    <li>
                        <p>
                            <b>HTML Documentation.</b> The OPS User Guide in static HTML format, broken
                            in OPS 2.8, is now working correctly. This format allows you to consult the
                            documentation offline without running OPS or without accessing the online
                            documentation.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>PDF Documentation.</b> The OPS User Guide in PDF version is back! You can
                            print this book for reference.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>OPS Blog example.</b> This <a href="/xforms-blog/">new example</a> illustrates many of
                            the capabilities of OPS, including:
                        </p>
                        <ul>
                            <li>Implementing XML-RPC services</li>
                            <li>Connecting to a native XML database</li>
                            <li>Using XForms</li>
                            <li>Producing XHTML, RSS and other formats from a single data source</li>
                            <li>Implementing configurable themes with XSLT</li>
                            <li>Creating "clean" URLs in a REST perspective</li>
                        </ul>
                    </li>
                    <li>
                        <p>
                            <b>Resource Manager.</b> The Flat File and <a
                            href="reference-resource-managers#filesystem">Filesystem</a> resource
                            managers have been merged. The Flat File resource manager is now deprecated,
                            and the Filesystem resource manager should be used instead. The Flat File
                            resource manager can still be used for backward compatibility. The main
                            difference between the two resource managers is that the Filesystem resource
                            manager can be configured with or without a sandbox.
                        </p>
                    </li>
                    <!--
                    <li>
                        <p>
                            <b>PDF Processors.</b> TODO
                        </p>
                    </li>
                    -->
                    <li>
                        <p>
                            <b>Directory Scanner Processor.</b> The purpose of the <a
                            href="processors-directory-scanner">Directory Scanner</a> processor is to
                            analyse a directory structure in a filesystem and to produce an XML document
                            containing metadata about the files, such as name and size. It is possible
                            to specify which files and directories to include and exclude in the
                            scanning process. The Directory Scanner is also able to optionally retrieve
                            image metadata. Two new command-line examples illustrate the use of this
                            processor.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>Faster URL Rewriting.</b> In order to improve performance URL rewriting
                            has been re-implemented in Java. The new implemetation is accessed through
                            the new rewrite processors <code>oxf:xhtml-rewrite</code> and
                            <code>oxf:html-rewrite</code>.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>Disabled Validation</b>. Previously the data <code>input</code> of the
                            <code>oxf:xforms-output</code> processor and the <code>config</code> input
                            of the <code>oxf:portlet-include</code> processor were validated unless one
                            turned off all input parameter validation in OPS. However we found that
                            validation of these two inputs came with at significant price and
                            consequently these inputs are no longer validated by default. To enable the
                            validation one must specify the appropriate schema URI with the
                            <code>schema-uri</code> attribute. For the <code>data</code> input of
                            <code>oxf:xforms-output</code> the URI is
                            <code>http://www.w3.org/2002/xforms/controls</code> and for the
                            <code>config</code> input of <code>oxf:portlet-include</code> the URI is
                            <code>http://orbeon.org/oxf/xml/portlet-include</code>.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>URL Generator</b>. The <a href="processors-generators-url">URL
                            Generator</a> now has an option to specify whether XInclude processing must
                            occur at XML parsing time.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>JAR and WAR Names</b>. <code>orbeon.jar</code> has been renamed to
                            <code>ops.jar</code>, <code>cli-orbeon.jar</code> has been renamed to
                            <code>cli-ops.jar</code> and <code>orbeon.war</code> has been renamed to
                            <code>ops.war</code>.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>Delegation Processor</b>. The <code>select</code> attribute on the
                            <code>operation</code> element is now documented. The default behavior when
                            <code>select</code> is not present has changed when calling document-style
                            web services. In that case, now the content of the SOAP body element is returned,
                            instead of the content of the first element contained by the SOAP body.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>New To-XML Converter</b>. The new <a
                            href="processors-converters#to-xml-converter">To-XML Converter</a> allows
                            producing parsed XML documents from a binary document format.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>New XInclude Processor</b>. The new <a
                            href="processors-xinclude">XInclude processor</a> allows processing XInclude
                            instructions. XInclude was already supported at the parser level (Xerces
                            support) before OPS 3.0.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>Email processor</b>. The <a href="processors-messaging-email">Email
                            processor</a> now supports setting custom email headers with the new
                            <code>header</code> configuration element.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>Listeners</b>. The <a href="reference-listeners">Listeners</a>
                            documentation has been updated to reflect the correct configuration
                            parameters. Listeners now produce better logs.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>Servlet and Portlet Classes</b>. Servlet and Portlet classes have been
                            renamed as follows:
                        </p>
                        <ul>
                            <li><code>OPSServlet</code> replaces <code>OXFServlet</code></li>
                            <li><code>OPSPortlet</code> replaces <code>OXFPortlet</code></li>
                            <li><code>OPSServletFilter</code> replaces <code>OXFServletFilter</code></li>
                            <li><code>OPSServletContextListener</code> replaces <code>OXFServletContextListener</code></li>
                            <li><code>OPSSessionListener</code> replaces <code>OXFSessionListener</code></li>
                        </ul>
                        <p>
                            The old names still work for backward compatibility.
                        </p>
                    </li>
                </ul>
            </section>
            <section>
                <title>Other Incompatible changes</title>
                <p>
                    The following incompatible changes are new in OPS 3.0:
                </p>
                <ul>
                    <li>
                        <p>
                            <b>Request Generator</b>. The <a
                            href="processors-generators-request">Request Generator</a> used to return a
                            constructed path for the <code>path-info</code> parameter. It now correctly
                            returns the Servlet API's path info. To get a complete path, use
                            <code>request-path</code> instead.
                        </p>
                    </li>
                </ul>
            </section>
        </section>
    </body>
</document>
