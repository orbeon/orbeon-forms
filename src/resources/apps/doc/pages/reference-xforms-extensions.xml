<?xml version="1.0" encoding="windows-1252"?>
<!--
  Copyright (C) 2010 Orbeon, Inc.

  This program is free software; you can redistribute it and/or modify it under the terms of the
  GNU Lesser General Public License as published by the Free Software Foundation; either version
  2.1 of the License, or (at your option) any later version.

  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
  See the GNU Lesser General Public License for more details.

  The full text of the license is available at http://www.gnu.org/copyleft/lesser.html
  -->
<document xmlns:p="http://www.orbeon.com/oxf/pipeline"
          xmlns:xforms="http://www.w3.org/2002/xforms"
          xmlns:xxforms="http://orbeon.org/oxf/xml/xforms"
          xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xmlns:xhtml="http://www.w3.org/1999/xhtml"
          xmlns:ev="http://www.w3.org/2001/xml-events"
          xmlns:xi="http://www.w3.org/2001/XInclude" >
    <header>
        <title>XForms Reference: XForms Extensions</title>
    </header>
    <body>
        <section>
            <title>Introduction</title>
            <p>
                This part of the XForms reference documentation focuses on XForms extensions provided by Orbeon Forms.
            </p>
        </section>
        <a name="xforms-xpath-20"/>
        <section>
            <title>XPath 2.0 Expressions</title>
            <p>
                This section has <a
                href="http://wiki.orbeon.com/forms/doc/developer-guide/xpath-2-0-support">migrated
                to the wiki</a>.
            </p>
        </section>
        <a name="controls-models-placement"/>
        <section>
            <title>Placement of Controls and Models</title>
            <p>
                XForms does not specify normatively where XForms controls and models must be placed within an HTML
                document. The <a href="http://www.w3.org/TR/xforms11/#xforms-in-xhtml-00">convention</a> is to place
                <code>&lt;xforms:model></code> elements within <code>&lt;xhtml:head></code>, and controls within
                <code>&lt;xhtml:body></code>. Orbeon Forms is more flexible on this:
            </p>
            <ul>
                <li>
                    <p>
                        <code>&lt;xforms:model></code> can be placed within <code>&lt;xhtml:head></code> as is usual,
                        but also under <code>&lt;xhtml:body></code> and even nested within other XForms elements. For
                        example:
                    </p>
                    <xml-source>
                        <xxforms:dialog id="my-dialog" model="my-dialog-model">
                            <xforms:label>My Dialog</xforms:label>
                            <xforms:group>
                                ...
                            </xforms:group>
                            <xforms:model id="my-dialog-model">
                                <comment> Model used by the dialog </comment>
                                ...
                            </xforms:model>
                        </xxforms:dialog>
                    </xml-source>
                    <p>
                        In this particular case, this allows you to write your dialog as a module in a completely
                        separate file and to XInclude that file within your main form.
                    </p>
                    <p>
                        At the moment, nested models behave exactly as if they were placed under
                        <code>&lt;xhtml:head></code>. It is just a syntactic convenience to be able to place them within
                        elements such as <code>&lt;xxforms:dialog></code>.
                    </p>
                </li>
                <li>
                    <p>
                        Attribute Value Templates (AVTs) can be <a href="#avts-xhtml">placed on HTML elements outside
                        <code>&lt;xhtml:body></code></a>.
                    </p>
                    <xml-source>
                        <xhtml:body lang="{instance('language')}">
                            ...
                        </xhtml:body>
                    </xml-source>
                </li>
                <li>
                    <p>
                        A single <code>&lt;xforms:output></code> control may be placed within
                        <code>&lt;xhtml:title></code>. This allows dynamically changing the HTML document title using XForms.
                    </p>
                    <xml-source>
                        <xhtml:title>
                            <xforms:output value="instance('resources')/title"/>
                        </xhtml:title>
                    </xml-source>
                </li>
           </ul>
            <note>
                <p>
                    Even though AVTs and <code>&lt;xforms:output></code> elements may be placed before any XForms
                    model, they are still considered part of the XForms "view" of the XForms document and refer to data placed in
                    models.
                </p>
            </note>
        </section>
        <a name="xxforms-custom-mips"/>
        <section>
            <title>Custom Model Item Properties</title>
            <p>
                You can place user-defined Model Item Properties (MIP) on the <code>&lt;xforms:bind></code> element. Any
                attribute not in a standard Orbeon namespace is interpreted as a custom MIP:
            </p>
            <xml-source xmlns:foo="http://orbeon.org/oxf/xml/foo">
                <xforms:bind nodeset="*" foo:bar="if (starts-with(., 'g')) then 'is-g' else 'is-not-g'"/>
            </xml-source>
            <p>
                The value of the attribute must be a valid XPath expression. The expression result is converted to a
                string to set the MIP value.
            </p>
            <p>
                Custom MIPs have the side effect of placing CSS classes on controls bound to affected nodes. Class
                names are computed as the concatenation of:  
            </p>
            <ul>
                <li>MIP attribute prefix</li>
                <li>"-"</li>
                <li>MIP attribute local name</li>
                <li>"-"</li>
                <li>MIP value</li>
            </ul>
            <p>
                With the example above, the following class names can be set: <code>foo-bar-is-g</code> or
                <code>foo-bar-is-not-g</code>.
            </p>
        </section>
        <a name="xxforms-default-mip"/>
        <section>
            <title>Extension Model Item Property to Specify default instance values</title>
            <p>
                In XForms, default or initial values can be set by pre-populating an instance document's elements
                and attributes with initial data, for example:
            </p>
            <xml-source>
                <xforms:instance>
                    <form>
                        <username>jdoe</username>
                        ...
                    </form>
                </xforms:instance>
            </xml-source>
            <p>
                For dynamic values, for example coming from request parameters or session values, there is no
                declarative notation and you must use <code>xforms-submit-done</code> or
                <code>xforms-submit-ready</code>, which is sometimes cumbersome:
            </p>
            <xml-source>
                <xforms:setvalue ev:event="xforms-model-construct-done" ref="username" value="xxforms:get-request-header('MY_USER')"/>
            </xml-source>
            <p>
                For convenience, Orbeon Forms support an extension model item property:
                <code>xxforms:default</code>. It works like the standard <code>calculate</code>, except that it is
                evaluated only once, just before the first evaluation of the <code>calculate</code> expressions if
                any.
            </p>
            <xml-source>
                <xforms:bind nodeset="username" xxforms:default="xxforms:get-request-header('MY_USER')"/>
            </xml-source>
        </section>
        <a name="lhha-for"/>
        <section>
            <title>Standalone Label, Hint, Help and Alert Elements</title>
            <p>
                In XForms, <code>&lt;label></code>, <code>&lt;hint></code>, <code>&lt;help></code> and
                <code>&lt;alert></code> ("LHHA") elements must always be nested within a control. In HTML on the
                other hand, the <code>&lt;label></code> element supports a <code>for</code> attribute which relates
                the element to a control. Orbeon Forms follows HTML and support the <code>for</code> attribute on
                all the LHHA elements. This allows placing LHHA elements in other locations on the page:
            </p>
            <xml-source>
                <table>
                    <tr>
                        <td>
                            <xforms:label for="first-name-control">Please enter your first name:</xforms:label>
                        </td>
                        <td>
                            <xforms:input id="first-name-control" ref="first-name" />
                        </td>
                        <td>
                            <xforms:hint for="first-name-control">Just your first name...</xforms:hint>
                        </td>
                    </tr>
                </table>
                <p>
                    <xforms:alert for="first-name-control">Oops the first name is not valid</xforms:alert>
                </p>
            </xml-source>
            <note>
                <p>
                    Standalone LHHA elements must not cross <code>&lt;xforms:repeat></code> boundaries.
                </p>
            </note>
        </section>
        <a name="readonly-mode"/>
        <section>
            <title>Read-Only Mode</title>
            <section>
                <title>Making an Entire Instance Read-Only</title>
                <p>
                    You often want to present a form without allowing the user to enter data. An easy solution is to use
                    the <code>readonly</code> MIP in the model. By making for example the root element of an instance
                    read-only, all the controls bound to any node of that instance will appear read-only (because the
                    read-only property is inherited in an instance):
                </p>
                <xml-source>
                    <xforms:instance id="my-form">
                        <form>
                            ...
                        </form>
                    </xforms:instance>
                    <xforms:bind nodeset="instance('my-form')" readonly="true()"/>
                </xml-source>
            </section>
            <section>
                <title>Static Appearance for Read-Only Mode</title>
                <p>
                    Sometimes, read-only controls don't appear very nicely in web browsers. For example, a combo box
                    will appear grayed out. It maybe be hard to read, and there is not much point showing a combo box
                    since the user can't interact with it. Furthermore, with some browsers, like IE 6 and earlier, it
                    is not even possible to make disabled controls appear nicer with CSS. In order to make read-only
                    versions of forms look nicer, Orbeon Forms supports a special extention attribute that allows you
                    to produce a "static" appearance for read-only controls. You enable this on your first XForms model:
                </p>
                <xml-source>
                    <xforms:model xxforms:readonly-appearance="static">
                        ...
                    </xforms:model>
                </xml-source>
                <p>
                    The attribute takes one of two vales: <code>static</code> or <code>dynamic</code> (the default).
                    When using the value <code>static</code>, read-only controls do not produce disabled HTML form
                    controls. This has one major limitation: you can't switch a control back to being read-write once
                    it is displayed as read-only.
                </p>
                <p>
                    You can also set the <code>xxforms:readonly-appearance</code> attribute directly on individual
                    XForms controls.
                </p>
                <p>
                    See the <a href="/forms/">Government Forms</a> sample application's <i>View Read-Only</i> option for
                    an example of this feature in action.
                </p>
            </section>
        </section>
        <a name="xforms-formatting"/>
        <section>
            <title>Formatting</title>
            <section>
                <title>Rationale</title>
                <p>
                    It is usually recommended to use native XML types within XForms instances, as this guarantees
                    interoperability and maintainability. For example, a date of January 10, 2005 is stored in ISO
                    format as: <code>2005-10-01</code>. However it is often necessary to format such values on screen
                    in a user-readable format, like "January 10, 2005", "10 janvier 2005", or "10. Januar 2005".
                </p>
                <p>
                    Orbeon Forms provides an extension attribute, <code>xxforms:format</code>, for that purpose.
                    <code>xxforms:format</code> must contain an XPath 2.0 expression. In your XPath expression you can
                    use all the XPath 2.0 functions, including those for date manipulation (<a
                    href="http://www.w3.org/TR/2005/CR-xpath-functions-20051103/#durations-dates-times">external
                    documentation</a>). However since XPath 2.0 functions don't provide any facility for date and time
                    formatting, you can in this attribute also use the following XSLT 2.0 functions:
                </p>
                <ul>
                    <li><p><code>format-date()</code> (<a href="http://www.w3.org/TR/2005/WD-xslt20-20050915/#function-format-date">external documentation</a>)</p></li>
                    <li><p><code>format-dateTime()</code> (<a href="http://www.w3.org/TR/2005/WD-xslt20-20050915/#function-format-dateTime">external documentation</a>)</p></li>
                    <li><p><code>format-time()</code> (<a href="http://www.w3.org/TR/2005/WD-xslt20-20050915/#function-format-time">external documentation</a>)</p></li>
                    <li><p><code>format-number()</code> (<a href="http://www.w3.org/TR/2005/WD-xslt20-20050915/#function-format-number">external documentation</a>)</p></li>
                </ul>
                <p>
                    The XPath expression is evaluated by the XForms engine whenever the value bound to the
                    <code>xforms:input</code> control changes and needs to be updated on screen. It is evaluated in the
                    context of the instance node bound to the control. This means that the current value of the control
                    can be accessed with "<code>.</code>". Often the value must be converted (for example to a date) in
                    which case the conversion can be done with a XPath 2.0 constructor such as <code>xs:date(.)</code>
                    or with as cast such as <code>(. cast as xs:date?)</code>.
                </p>
            </section>
            <section>
                <title>xforms:output</title>
                <p>
                    When using <code>xforms:output</code>, you can control the formatting of the date using the
                    <code>xxforms:format</code> extension attribute on the <code>xforms:output</code> control.
                </p>
                <xml-source show-namespaces="false">
                    <xforms:output ref="date" xxforms:format="format-date(xs:date(.), '[MNn] [D], [Y]', 'en', (), ())"/>
                    <xforms:output ref="size" xxforms:format="format-number(., '###,##0')"/>
                </xml-source>
            </section>
            <a name="xforms-default-formatting"/>
            <section>
                <title>Default Formatting</title>
                <p>
                    For both <code>xforms:input</code> and <code>xforms:output</code>, if the bound node is of one of
                    the following types: <code>xs:date</code>, <code>xs:dateTime</code>, <code>xs:time</code>,
                    <code>xs:decimal</code>, <code>xs:integer</code>, <code>xs:float</code>, and <code>xs:double</code>,
                    and if no <code>xxforms:format</code> attribute is present on the control, formatting is based on
                    <a href="reference-properties">properties</a>. If the properties are missing, a built-in default
                    formatting is used. The default properties, as well as the built-in defaults, are as follows:
                </p>
                <xml-source>
                    <property as="xs:string"  name="oxf.xforms.format.date"                          value="if (. castable as xs:date) then format-date(xs:date(.), '[FNn] [MNn] [D], [Y]', 'en', (), ()) else ."/>
                    <property as="xs:string"  name="oxf.xforms.format.dateTime"                      value="if (. castable as xs:dateTime) then format-dateTime(xs:dateTime(.), '[FNn] [MNn] [D], [Y] [H01]:[m01]:[s01] UTC', 'en', (), ()) else ."/>
                    <property as="xs:string"  name="oxf.xforms.format.time"                          value="if (. castable as xs:time) then format-time(xs:time(.), '[H01]:[m01]:[s01] UTC', 'en', (), ()) else ."/>
                    <property as="xs:string"  name="oxf.xforms.format.decimal"                       value="if (. castable as xs:decimal) then format-number(xs:decimal(.),'#,##0.00') else ."/>
                    <property as="xs:string"  name="oxf.xforms.format.integer"                       value="if (. castable as xs:integer) then format-number(xs:integer(.),'#,##0') else ."/>
                    <property as="xs:string"  name="oxf.xforms.format.float"                         value="if (. castable as xs:float) then format-number(xs:float(.),'#,##0.000') else ."/>
                    <property as="xs:string"  name="oxf.xforms.format.double"                        value="if (. castable as xs:double) then format-number(xs:double(.),'#,##0.000') else ."/>
                </xml-source>
                <p>
                    They produce results as follows:
                </p>
                <ul>
                    <li>
                        <p>
                            <code>2004-01-07</code> as <code>xs:date</code> is displayed as <code>Wednesday January 7, 2004</code>
                        </p>
                    </li>
                    <li>
                        <p>
                            <code>2004-01-07T04:38:35.123</code> as <code>xs:dateTime</code> is displayed as <code>Wednesday January 7, 2004 04:38:35 UTC</code>
                        </p>
                    </li>
                    <li>
                        <p>
                            <code>04:38:35.123</code> as <code>xs:time</code> is displayed as <code>04:38:35 UTC</code>
                        </p>
                    </li>
                    <li>
                        <p>
                            <code>123456.789</code> as <code>xs:decimal</code> is displayed as <code>123,456.79</code>
                        </p>
                    </li>
                    <li>
                        <p>
                            <code>123456.789</code> as <code>xs:integer</code> is displayed as <code>123,456</code>
                        </p>
                    </li>
                    <li>
                        <p>
                            <code>123456.789</code> as <code>xs:float</code> or <code>xs:double</code> is displayed as <code>123,456.789</code>
                        </p>
                    </li>
                </ul>
                <p>Note:</p>
                <ul>
                    <li>
                        With the "if" condition in the XPath expressions, a value which cannot be converted to the
                        appropriate type is simply displayed as is.
                    </li>
                    <li>
                        For values of type <tt>xs:time</tt> or <tt>xs:dateTime</tt>, if you wish the time to be
                        displayed using the current timezone instead of UTC, replace in the <tt>value</tt> attribute
                        <tt>UTC</tt> by <tt>[ZN]</tt>.
                    </li>
                </ul>
            </section>
        </section>
        <a name="exforms-iterate"/>
        <section>
            <title>Iteration of XForms Actions over Sequences</title>
            <p>
                Orbeon Forms supports the <code>exforms:iterate</code> attribute, also available as
                <code>xxforms:iterate</code> attribute, on XForms action elements. Consider the following
                instances:
            </p>
            <xml-source>
                <xforms:instance id="main-instance">
                    <instance xmlns=""/>
                </xforms:instance>

                <xforms:instance id="template-instance">
                    <book xmlns="">
                        <title/>
                        <author/>
                    </book>
                </xforms:instance>

                <xforms:instance id="source-instance">
                    <instance xmlns="">
                        <title>Don Quixote de la Mancha</title>
                        <author>Miguel de Cervantes Saavedra</author>
                        <title>Jacques le fataliste et son maître</title>
                        <author>Denis Diderot</author>
                        <title>Childhood's End</title>
                        <author>Arthur C. Clarke</author>
                    </instance>
                </xforms:instance>
            </xml-source>
            <p>
                The following action iterates over the <code>&lt;title></code> elements of
                <code>source-instance</code>. For each of those, a new <code>&lt;book></code> element, copied from
                the template stored in <code>template-instance</code>, is inserted into <code>main-instance</code>.
                Then values from the <code>&lt;title></code> and <code>&lt;author></code> elements are copied over
                to the new structure. The XForms 1.1 <code>context()</code> function provides access to each of the
                iterated nodes:
            </p>
            <xml-source>
                <xforms:action ev:event="xforms-ready" xxforms:iterate="instance('source-instance')/title">
                    <xforms:insert context="instance('main-instance')" nodeset="book" origin="instance('template-instance')"/>
                    <xforms:setvalue ref="instance('main-instance')/book[last()]/title" value="context()"/>
                    <xforms:setvalue ref="instance('main-instance')/book[last()]/author" value="context()/following-sibling::author"/>
                </xforms:action>
            </xml-source>
            <p>
                The resulting <code>main-instance</code> is as follows:
            </p>
            <xml-source>
                <instance>
                    <book>
                        <title>Don Quixote de la Mancha</title>
                        <author>Miguel de Cervantes Saavedra</author>
                    </book>
                    <book>
                        <title>Jacques le fataliste et son maître</title>
                        <author>Denis Diderot</author>
                    </book>
                    <book>
                        <title>Childhood's End</title>
                        <author>Arthur C. Clarke</author>
                    </book>
                </instance>
            </xml-source>
            <p>
                Note that because Orbeon Forms uses XPath 2.0, <code>xxforms:iterate</code> is not limited to
                returning node-sets, but can return sequences of items such as strings.
            </p>
            <p>
                For more information about eXforms extensions, please visit the <a
                href="http://www.exforms.org/conditionals.html#id4484032">eXforms site</a>.
            </p>
        </section>
        <a name="context-attribute"/>
        <section>
            <title>Generalized <code>context</code> attribute</title>
            <p>
                XForms 1.1 introduces the <code>context</code> attribute on <code>&lt;xforms:insert></code> and
                <code>&lt;xforms:delete></code>. Orbeon Forms supports this convenient attribute on all XForms
                elements changing the XPath evaluation context, including controls, actions, binds, and
                submissions.
            </p>
            <p>
                The <code>context</code> attribute overrides the in-scope XPath evaluation context for an action. It
                applies before the <code>ref</code> and <code>context</code> attributes, but after the
                <code>model</code> attribute.
            </p>
            <p>
                One convenient use is to just change the context within a group:
            </p>
            <xml-source>
                <xforms:group context="personal-information">
                    ...
                </xforms:group>
            </xml-source>
            <p>
                Note that it is also possible to use <code>ref</code> in this case, but doing so has the side effect
                of binding the group to an instance data node, which may affect group relevance, for example.
            </p>
        </section>
        <a name="event-context"/>
        <section>
            <title>Enhanced <code>event()</code> Function Support</title>
            <p>
                This section has <a
                href="http://wiki.orbeon.com/forms/doc/developer-guide/xforms-events#TOC-Enhanced-event-function-support">migrated
                to the wiki</a>.
            </p>
        </section>
        <a name="dispatch-context"/>
        <section>
            <title>Enhanced <code>&lt;xforms:dispatch></code> Support</title>
            <p>
                This section has <a
                href="http://wiki.orbeon.com/forms/doc/developer-guide/xforms-events#TOC-Enhanced-xforms:dispatch-support">migrated
                to the wiki</a>.
            </p>
        </section>
        <a name="repeat-indexes"/>
        <section>
            <title>Targeting effective controls within repeat iterations</title>
            <p>
                This section has <a
                href="http://wiki.orbeon.com/forms/doc/developer-guide/xforms-events#TOC-Targeting-effective-controls-within">migrated
                to the wiki</a>.
            </p>
        </section>
        <a name="validation-extensions"/>
        <section>
            <title>Validation Extensions</title>
            <a name="validation-extensions-events"/>
            <section>
                <title>Extension Events</title>
                <p>
                    Orbeon Forms supports extensions events dispatched to an instance when it becomes valid or
                    invalid: <code>xxforms-valid</code> and <code>xxforms-invalid</code>. These events are
                    dispatched just before <code>xforms-revalidate</code> completes, to all instances of the model
                    being revalidated. For a given instance, either <code>xxforms-valid</code> or
                    <code>xxforms-invalid</code> is dispatched for a given revalidation.
                </p>
                <p>
                    These events can be used, for example, to toggle the appearance of icons indicating that a form
                    is valid or invalid:
                </p>
                <xml-source>
                    <xforms:instance id="my-instance">
                        ...
                    </xforms:instance>
                    <xforms:action ev:event="xxforms-invalid" ev:observer="my-instance">
                        <xforms:toggle case="invalid-form-case"/>
                    </xforms:action>
                    <xforms:action ev:event="xxforms-valid" ev:observer="my-instance">
                        <xforms:toggle case="valid-form-case"/>
                    </xforms:action>
                </xml-source>
            </section>
            <a name="validation-extensions-types"/>
            <section>
                <title>Extension Types</title>
                <p>
                    Orbeon Forms supports the built-in <code>xxforms:xml</code> extension type. This types checks
                    that the value is well-formed XML:
                </p>
                <xml-source>
                    <xforms:bind nodeset="my-xml" type="xxforms:xml"/>
                </xml-source>
                <p>
                    Note that this checks the <b>string value</b> of the node, which means that the node must
                    contain escaped XML.
                </p>
                <p>
                    Orbeon Forms supports the built-in <code>xxforms:xpath2</code> extension type. This types
                    checks that the value is well-formed XPath 2.0. Any variable used by the expression is assumed
                    to be in scope:
                </p>
                <xml-source>
                    <xforms:bind nodeset="my-xpath" type="xxforms:xpath2"/>
                </xml-source>
                <note>
                    <p>
                        In both these cases, Orbeon Forms checks for the <code>required</code> MIP: if it evaluates
                        to <code>false()</code> and the value is the empty string, then the instance data node is
                        considered valid. This is contrary to XForms 1.1 as of August 2008.
                    </p>
                </note>
            </section>
            <a name="validation-extensions-schema"/>
            <section>
                <title>Controlling the XML Schema Validation Mode</title>
                <p>
                    When an XML Schema is provided, Orbeon Forms supports controlling whether a particular instance
                    is validated in "lax" mode, "strict" mode, or not validated at all.
                </p>
                <p>
                    Orbeon Forms implements a "lax" validation mode by default, where only elements that have
                    definitions in the imported schemas are validated. Other elements are not considered for
                    validation. This is in line with XML Schema and XSLT 2.0 lax validation modes, and with the
                    default validation mode as specified in XForms 1.1
                </p>
                <p>
                    In addition, the author can specify the validation mode directly on each instance with the
                    extension <code>xxforms:validation</code> attribute, which takes values <code>lax</code>
                    (the default), <code>strict</code> (the root element has to have a definition in the schema
                    and must be valid), or <code>skip</code> (no validation at all for that instance).
                </p>
                <xml-source>
                    <xforms:model schema="my-schema.xsd">
                        <xforms:instance id="my-form" xxforms:validation="strict">
                            <my-form>
                                ...
                            </my-form>
                        </xforms:instance>
                        <xforms:instance id="items" xxforms:validation="skip">
                            <items>
                                ...
                            </items>
                        </xforms:instance>
                    </xforms:model>
                </xml-source>
                <p>
                    Nodes validated through a schema receive datatype annotations, which means that if an element
                    or attribute is validated against <code>xs:date</code> in a schema, an XForms control bound to
                    that node will display a date picker.
                </p>
            </section>
        </section>
        <a name="xforms-javascript"/>
        <section>
            <title>JavaScript Integration</title>
            <p>
                This section has <a
                href="http://wiki.orbeon.com/forms/doc/developer-guide/xforms-javascript-integration">migrated
                to the wiki</a>.
            </p>
        </section>
        <a name="avts"/>
        <section>
            <title>Attribute Value Templates</title>
            <p>
                This section has <a
                href="http://wiki.orbeon.com/forms/doc/developer-guide/xforms-attribute-value-templates">migrated
                to the wiki</a>.
            </p>
        </section>
        <a name="variables"/>
        <section>
            <title>Variables</title>
            <p>
                This section has <a href="http://wiki.orbeon.com/forms/doc/developer-guide/xforms-variables">migrated
                to the wiki</a>.
            </p>
        </section>
        <a name="dialog"/>
        <section>
            <title>Dialogs</title>
            <a name="dialog-dialog"/>
            <section>
                <title>The <code>xxforms:dialog</code> Control</title>
                <p>
                    You declare dialogs directly under the <code>&lt;xhtml:body></code> element with:
                </p>
                <xml-source>
                    <xxforms:dialog id="my-dialog-id" appearance="full | minimal" level="modeless" close="true" draggable="true" visible="false">
                        <xforms:label>Dialog title</xforms:label>
                        Content of the dialog (XHTML + XForms)
                    </xxforms:dialog>
                </xml-source>
                <ul>
                    <li>
                        When you have <code>appearance="full"</code> on the dialog, you define the title of the
                        dialog with the embedded <code>&lt;xforms:label></code> element.
                    </li>
                    <li>
                        Inside an <code>&lt;xxforms:dialog></code> you can use all the XHTML and XForms elements you
                        can normally use elsewhere on the page. You can have other XForms controls, or show anything
                        you would like to with HTML.
                    </li>
                    <li>
                        The attributes on the <code>&lt;xxforms:dialog></code> are as follows:
                    </li>
                </ul>
                <table>
                    <tr>
                        <th><code>id</code></th>
                        <td>Mandatory</td>
                        <td>
                            The ID of the dialog. You reference this ID when opening the dialog with
                            <code>&lt;xxforms:show dialog="my-dialog-id"></code>.
                        </td>
                    </tr>
                    <tr>
                        <th>appearance</th>
                        <td>
                            Optional. Possible values are:
                            <ul>
                                <li><code>full</code> (default)</li>
                                <li><code>minimal</code></li>
                            </ul>
                        </td>
                        <td>
                            You can set the appearance to either <code>full</code> or <code>minimal</code>:
                            <ul>
                                <li>
                                    The first screenshot below shows a dialog with <code>appearance="full"</code>
                                    while the second one shows a dialog with <code>appearance="minimal"</code>.
                                </li>
                                <li>
                                    In general, you will use the minimal dialog when you want to show a limited set
                                    of information which is related to a certain element in the page. The minimal
                                    dialog is sometime also referred to as a "drop-down dialog".
                                </li>
                                <li>
                                    Some of the other attributes on <code>&lt;xxforms:dialog></code> can only be
                                    used for the full or the minimal dialog. You will find more details on this
                                    below.
                                </li>
                            </ul>

                            <img src="../apps/doc/images/reference-xforms-dialog-full.png"/>
                            <img src="../apps/doc/images/reference-xforms-dialog-minimal.png"/>
                        </td>
                    </tr>
                    <tr>
                        <th><code>level</code></th>
                        <td>
                            Optional. Can only be used appearance is set to <code>full</code>. Possible values are:
                            <ul>
                                <li><code>modal</code> (default)</li>
                                <li><code>modeless</code></li>
                            </ul>
                        </td>
                        <td>
                            When set to <code>modal</code> the rest the page is grayed out and you can't interact
                            with any ontrol on the page outside of the dialog. When set to <code>modeless</code> you
                            can still use other controls on the page.
                        </td>
                    </tr>
                    <tr>
                        <th><code>close</code></th>
                        <td>
                            Optional. Can only be used appearance is set to <code>full</code>. Possible values are:
                            <ul>
                                <li><code>true</code> (default)</li>
                                <li><code>false</code></li>
                            </ul>
                        </td>
                        <td>
                            A "x" is shown in the dialog title bar when <code>close</code> is set to
                            <code>true</code>. If you specify <code>close="false"</code>, then you should provide a
                            way to close the dialog, for instance by having you own "Close" button inside the
                            dialog. This is typically useful when you want to force users to enter some data before
                            proceeding and you don't want them to cancel the current operation by closing the
                            dialog.
                        </td>
                    </tr>
                    <tr>
                        <th><code>draggable</code></th>
                        <td>
                            Optional. Can only be used appearance is set to <code>full</code>. Possible values are:
                            <ul>
                                <li><code>true</code> (default)</li>
                                <li><code>false</code></li>
                            </ul>
                        </td>
                        <td>
                            When set to <code>false</code>, you won't be able to move dialog on the page by using
                            drag and drop in the dialog title bar.
                        </td>
                    </tr>
                    <tr>
                        <th><code>visible</code></th>
                        <td>
                            Optional. Whether the dialog is initially visible when the page loads. Possible values
                            are:
                            <ul>
                                <li><code>true</code></li>
                                <li><code>false</code> (default)</li>
                            </ul>
                        </td>
                        <td>
                            When set to <code>true</code>, the dialog appears immediately when the page loads.
                        </td>
                    </tr>
                    <tr>
                        <th><code>neighbor</code></th>
                        <td>Optional</td>
                        <td>
                            Optional. Use only with <code>minimal</code> appearance. The id of the control next to
                            which the dialog should display when opening.
                        </td>
                    </tr>
                </table>
            </section>
            <a name="dialog-show-hide"/>
            <section added="2008-03-01">
                <title>The <code>xxforms:show</code> and <code>xxforms:hide</code> Actions</title>
                <p>
                    You open a dialog by using the <code>xxforms:show</code> action:
                </p>
                <xml-source>
                    <xforms:trigger>
                        <xforms:label>Show Dialog</xforms:label>
                        <xxforms:show ev:event="DOMActivate" dialog="hello-dialog"/>
                    </xforms:trigger>
                </xml-source>
                <p>
                    If the dialog is already open, no action takes place.
                </p>
                <p>
                    <code>xxforms:show</code> supports the following attributes:
                </p>
                <table>
                    <tr>
                        <th><code>dialog</code></th>
                        <td>Mandatory</td>
                        <td>
                            The id of an existing dialog to open.
                        </td>
                    </tr>
                    <tr>
                        <th><code>neighbor</code></th>
                        <td>Optional</td>
                        <td>
                            Optional. Use only with <code>minimal</code> appearance. The id of the control next to
                            which the dialog should display when opening.
                        </td>
                    </tr>
                    <tr>
                        <th><code>constrain</code></th>
                        <td>Optional</td>
                        <td>
                            Whether to constrain the dialog to the viewport. Possible values
                            are:
                            <ul>
                                <li><code>true</code> (default)</li>
                                <li><code>false</code></li>
                            </ul>
                        </td>
                    </tr>
                </table>
                <p>
                    You close a dialog by using the <code>xxforms:hide</code> action:
                </p>
                <xml-source>
                    <xforms:trigger>
                        <xforms:label>Hide Dialog</xforms:label>
                        <xxforms:hide ev:event="DOMActivate" dialog="hello-dialog"/>
                    </xforms:trigger>
                </xml-source>
                <p>
                    If the dialog is already closed, no action takes place.
                </p>
                <p>
                    <code>xxforms:hide</code> supports the following attributes:
                </p>
                <table>
                    <tr>
                        <th><code>dialog</code></th>
                        <td>Mandatory</td>
                        <td>
                            The id of an existing dialog to close.
                        </td>
                    </tr>
                </table>
            </section>
            <a name="xxforms-dialog-open"/>
            <section added="2008-03-01">
                <title>The <code>xxforms-dialog-open</code> Event</title>
                <p>
                    Dispatched in response to: <code>xxforms:show</code> action executed with an existing dialog id.
                </p>
                <p>
                    Target: <code>dialog</code>
                </p>
                <p>
                    Bubbles: Yes
                </p>
                <p>
                    Cancelable: Yes
                </p>
                <p>
                    Context Info: none
                </p>
                <p>
                    Default Action: Open the dialog.
                </p>
                <p>
                    You can respond to this event before the dialog opens, for example to perform initialization of
                    data:
                </p>
                <xml-source>
                    <xxforms:dialog id="hello-dialog">
                        <xhtml:div>
                            Hello!
                        </xhtml:div>
                        <xxforms:setvalue ev:event="xxforms-dialog-open" ref="..." value="..."/>
                    </xxforms:dialog>
                </xml-source>
            </section>
            <a name="xxforms-dialog-close"/>
            <section added="2008-03-01">
                <title>The <code>xxforms-dialog-close</code> Event</title>
                <p>
                    Dispatched in response to: <code>xxforms:hide</code> action executed with an existing dialog id.
                </p>
                <p>
                    Target: <code>dialog</code>
                </p>
                <p>
                    Bubbles: Yes
                </p>
                <p>
                    Cancelable: Yes
                </p>
                <p>
                    Context Info: none
                </p>
                <p>
                    Default Action: Close the dialog.
                </p>
            </section>
        </section>
        <a name="submission-extensions"/>
        <section>
            <title>Submission Extensions</title>
            <a name="submission-auth-extension"/>
            <section>
                <title>HTTP Authentication</title>
                <p>
                    The <code>&lt;xforms:submission></code> element supports optional <code>xxforms:username</code> and
                    <code>xxforms:password</code> attributes that allow specifying HTTP authentication credentials.
                    You can specify either both attributes, or only the <code>xxforms:username</code> attribute. The
                    latter case is equivalent to setting the value of <code>xxforms:password</code> to an empty
                    string.
                </p>
                <xml-source show-namespaces="false">
                    <xforms:submission id="save-submission" ref="instance('my-instance')"
                               method="put" resource="/exist/rest/ops/my-file.xml" replace="none" xxforms:username="admin" xxforms:password=""/>
                </xml-source>
            </section>
            <a name="submission-headers-forwarding"/>
            <section>
                <title>HTTP Headers Forwarding</title>
                <p>
                    The <code>&lt;xforms:submission></code> automatically forwards current HTTP headers specified by the
                    <code>oxf.xforms.forward-submission-headers</code> property. This property contains a
                    space-separated list of header names to forward:
                </p>
                <xml-source show-namespaces="false">
                    <property as="xs:string"  name="oxf.xforms.forward-submission-headers" value="Authorization SM_USER"/>
                </xml-source>
                <p>
                    It can also be set on a per-page basis on your first model element:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:model xxforms:forward-submission-headers="Authorization SM_USER">
                        ...
                    </xforms:model>
                </xml-source>
                <p>
                    Whenever <code>&lt;xforms:submission></code> performs an HTTP request, it looks at this list of
                    header names and it forwards the header value if the following conditions are met:
                </p>
                <ul>
                    <li>
                        There is an incoming header with that name, i.e. either the HTTP request causing the XForms
                        page to load or the XForms Ajax request to run contains that header.
                    </li>
                    <li>
                        There is no author-specifed header with the same name in an <code>&lt;xforms:header></code>
                        element within <code>&lt;xforms:submission></code>.
                    </li>
                </ul>
                <p>
                    Forwarding the <code>Authorization</code> or other authentication-related headers can be useful
                    to propagate authentication credentials to other services.
                </p>
                <note>
                    <p>
                        The <code>Authorization</code> is treated specially: if a username is specified on the
                        submission with <code>xxforms:username</code>, then this header is never forward.
                    </p>
                </note>
                <warning>
                    <p>
                        Forwarding authentication-related headers may cause a security risks when communicated with
                        non-trusted servers. Use carefully!
                    </p>
                </warning>
            </section>
            <a name="submission-show-progress"/>
            <section>
                <title>Loading Indicator</title>
                <p>
                    When an <code>&lt;xforms:submission></code> with <code>replace="all"</code> is executed, in general,
                    the browser will load another page. While this happens, the loading indicator, by default shown
                    in red at the top right of the window, is displayed. However, when the browser is served not a
                    web page but say a ZIP file, the browser might ask you in you want to download it, and then stay
                    in the current page. When this happens, the loading indicator does not go away.
                </p>
                <p>
                    In those cases where you know that the target page does not replace the current page, you can
                    prevent the loading indicator from being displayed by adding the
                    <code>xxforms:show-progress="false"</code> attribute:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:submission xxforms:show-progress="false"/>
                </xml-source>
                <p>
                    Similarly the <code>xxforms:show-progress="false"</code> attribute can be used with the
                    <code>xforms:load</code> action:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:load xxforms:show-progress="false"/>
                </xml-source>
            </section>
            <a name="submission-target"/>
            <section>
                <title>Target</title>
                <p>
                    You can use the <code>xxforms:target</code> attribute on both <code>&lt;xforms:submission></code> and
                    <code>xforms:load</code>. It behaves just like the <a
                    href="http://www.w3.org/TR/html401/present/frames.html#adef-target">HTML target attribute</a>.
                    When used on <code>&lt;xforms:submission></code>, it makes sense to use this attribute only when you
                    have a <code>replace="all"</code>, as the <code>replace="instance"</code> doesn't load another
                    page.
                </p>
            </section>
            <a name="submission-xxforms-instance"/>
            <section>
                <title><code>xxforms:instance</code> Attribute</title>
                <p>
                    On an <code>&lt;xforms:submission></code> element with <code>replace="instance"</code>, the
                    optional <code>instance</code> attribute specifies a destination instance for the result. That
                    attribute is processed like the <code>instance()</code> function, which means that the instance
                    specified must be in the current model.
                </p>
                <p>
                    The <code>xxforms:instance</code> extension attribute can be use instead of the standard
                    <code>instance</code> attribute. It works like <code>instance</code>, except that the instance
                    is searched globally among all models. <code>xxforms:instance</code> is to the
                    <code>instance</code> attribute what the <a
                    href="xxforms-instance"><code>xxforms:instance()</code></a> function is to the standard
                    <code>instance()</code> function.
                </p>
                <xml-source>
                    <xforms:submission id="my-submission" method="post" resource="http://example.org/"
                                       replace="instance" xxforms:instance="my-instance"/>
                </xml-source>
            </section>
            <a name="submission-xxforms-xinclude"/>
            <section>
                <title><code>xxforms:xinclude</code> Attribute</title>
                <p>
                    On an <code>&lt;xforms:submission></code> element with <code>replace="instance"</code>, the
                    optional <code>xxforms:xinclude</code> attribute specifies whether XInclude processing should be
                    performed on the XML document returned, before storing it into the destination instance. The
                    default is <code>false</code>.
                </p>
                <xml-source>
                    <xforms:submission id="my-submission" method="post" resource="http://example.org/"
                                       replace="instance" xxforms:xinclude="true"/>
                </xml-source>
            </section>
            <a name="submission-text"/>
            <section>
                <title>Submitting Text Content</title>
                <p>
                    Orbeon Forms supports sending the text content of an XML document as per
                    <a href="http://www.w3.org/TR/xslt-xquery-serialization/">XSLT 2.0 and XQuery 1.0 Serialization</a>.
                    To perform a text submission:
                </p>
                <ul>
                    <li>
                        <p>
                            The <code>post</code> or <code>put</code> method is required.
                        </p>
                    </li>
                    <li>
                        <p>
                            You must use a the <code>text/plain</code> value for the <code>serialization</code> attribute.
                        </p>
                    </li>
                </ul>
                <xml-source>
                    <xforms:instance id="instance">
                        <text>This contains some text. The <b>string value</b> of the document will be sent </text>
                    </xforms:instance>
                    ...
                    <xforms:submission id="save-submission"
                        ref="instance()"
                        method="post" serialization="text/plain"
                        replace="none"
                        resource="http://example.com/foo.text"/>
                    ...
                </xml-source>
            </section>
            <a name="submission-html"/>
            <section>
                <title>Submitting HTML or XHTML Content</title>
                <p>
                    Orbeon Forms supports sending an XML document as HTML or XHTML as per
                    <a href="http://www.w3.org/TR/xslt-xquery-serialization/">XSLT 2.0 and XQuery 1.0 Serialization</a>.
                    To perform a HTML or XHTML submission:
                </p>
                <ul>
                    <li>
                        <p>
                            The <code>post</code> or <code>put</code> method is required.
                        </p>
                    </li>
                    <li>
                        <p>
                            You must use a the <code>text/html</code> or the <code>application/xhtml+xml</code>
                            value for the <code>serialization</code> attribute.
                        </p>
                    </li>
                </ul>
                <xml-source>
                    <xforms:instance id="instance">
                        <html>
                            <head><title>My page</title></head>
                            <body><p>Cool HTML!</p></body>
                        </html>
                    </xforms:instance>
                    ...
                    <xforms:submission id="save-submission"
                        ref="instance()"
                        method="post" serialization="text/html"
                        replace="none"
                        resource="http://example.com/foo.html"/>
                    ...
                </xml-source>
            </section>
            <a name="submission-binary"/>
            <section>
                <title>Submitting Binary Content</title>
                <p>
                    XForms 1.1 does not explicitly support submitting binary content, but does not prohibit it
                    either. Orbeon Forms supports sending the content of a binary resource specified by a URI. Such
                    resources are easily obtained with <code>&lt;xforms:upload></code>, for example. To perform a
                    binary submission:
                </p>
                <ul>
                    <li>
                        <p>
                            The <code>post</code> or <code>put</code> method is required.
                        </p>
                    </li>
                    <li>
                        <p>
                            You must use a binary <code>serialization</code> attribute. This includes all
                            mediatypes which are not XML or text, including <code>application/octet-stream</code>,
                            <code>image/*</code>, etc.
                        </p>
                    </li>
                    <li>
                        <p>
                            The node referred to by the submission must be of type <code>xs:anyURI</code>.
                        </p>
                    </li>
                </ul>
                <xml-source>
                    <xforms:instance id="attachment">
                        <attachment>file:/Users/jdoe/Applications/apache-tomcat-5.5.20/temp/xforms_upload_30877.tmp</attachment>
                    </xforms:instance>
                    <xforms:bind nodeset="instance('attachment')" type="xs:anyURI"/>
                    ...
                    <xforms:submission id="save-submission"
                        ref="instance('attachment')"
                        method="put" serialization="application/octet-stream"
                        replace="none"
                        resource="http://example.com/foo.bin"/>
                    ...
                </xml-source>
                <p>
                    Alternatively, you can set the type information using the <code>xsi:type</code> attribute:
                </p>
                <xml-source>
                    <xforms:instance id="attachment">
                        <attachment xsi:type="xs:anyURI">file:/Users/jdoe/Applications/apache-tomcat-5.5.20/temp/xforms_upload_30877.tmp</attachment>
                    </xforms:instance>
                </xml-source>
            </section>
        </section>
        <a name="other-extensions"/>
        <section>
            <title>Other Extensions</title>
            <a name="xxforms-script-extension"/> 
            <p>
                This section has <a
                href="http://wiki.orbeon.com/forms/doc/developer-guide/xforms-javascript-integration#TOC-The-xxforms:script-action">migrated
                to the wiki</a>.
            </p>
            <a name="tree"/>
            <section>
                <title>Trees with the <code>xxforms:tree</code> Appearance</title>
                <p>
                    [TODO: describe the Orbeon Forms <code>xxforms:tree</code> appearance on
                    <code>xforms:select</code> and <code>xforms:select1</code>]
                </p>
            </section>
            <a name="menu"/>
            <section>
                <title>Menus with the <code>xxforms:menu</code> Appearance</title>
                <p>
                    [TODO: describe the Orbeon Forms <code>xxforms:tree</code> appearance on
                    <code>xforms:select1</code>]
                </p>
            </section>
            <a name="autocomplete"/>
            <section>
                <title>Autocomplete box <code>xxforms:tree</code> Appearance</title>
                <p>
                    [TODO: describe the Orbeon Forms <code>xxforms:autocomplete</code> appearance on
                    <code>xforms:select</code> and <code>xforms:select1</code>]
                </p>
            </section>
            <a name="events-multiple"/>
            <section>
                <title>Multiple Event Names, Observers and Targets on Event Handlers</title>
                <p>
                    This section has <a
                    href="http://wiki.orbeon.com/forms/doc/developer-guide/xforms-events#TOC-Multiple-event-names-observers-and-">migrated
                    to the wiki</a>.
                </p>
            </section>
            <a name="xxforms-download-appearance"/>
            <section>
                <title><code>xxforms:download</code> Appearance on <code>&lt;xforms:output></code></title>
                <p>
                    <code>&lt;xforms:output></code> supports the <code>xxforms:download</code> appearance, which
                    causes the the resource identified by the single-node binding to be downloadable through a
                    link.
                </p>
                <p>
                    Like <code>&lt;xforms:upload></code>, when using this appearance,
                    <code>&lt;xforms:mediatype></code> and <code>&lt;xforms:filename></code> children elements are
                    allowed (but not the <code>&lt;xxforms:size></code> element). When serving the file, if these
                    elements are present, they are passed to the resulting HTTP response to provide mediatype and
                    file name hints to the browser. Example:
                </p>
                <xml-source>
                    <xforms:instance id="my-instance">
                        <instance>
                            <file mediatype="" filename="" size=""/>
                        </instance>
                    </xforms:instance>
                    ...
                    <xforms:upload ref="file">
                        <xforms:label>Upload</xforms:label>
                        <xforms:mediatype ref="@mediatype"/>
                        <xforms:filename ref="@filename"/>
                        <xxforms:size ref="@size"/>
                    </xforms:upload>

                    <xforms:output ref="file" appearance="xxforms:download">
                        <xforms:label>Download</xforms:label>
                        <xforms:mediatype ref="@mediatype"/>
                        <xforms:filename ref="@filename"/>
                    </xforms:output>
                </xml-source>
                <p>
                    The data type for the resource must be <code>xs:anyURI</code> or <code>xs:base64Binary</code>.
                </p>
            </section>
            <a name="xxforms-radio-button-group"/>
            <section>
                <title><code>xxforms:group</code> Attribute on <code>&lt;xforms:select1></code> with <code>appearance="full"</code></title>
                <p>
                    <code>&lt;xforms:select1></code> supports an extension attribute called <code>xxforms:group</code>
                    which allows grouping a series of radio buttons together in a way similar to the <code>name</code>
                    attribute in HTML.
                </p>
                <p>
                    In general, this attribute is not necessary. It is useful in the following case:
                </p>
                <ul>
                    <li>
                        <p>
                            Multiple <code>&lt;xforms:select1 appearance="full"></code> point to the same node.
                        </p>
                    </li>
                        <li>
                        <p>
                            You enable <a
                            href="http://wiki.orbeon.com/forms/doc/developer-guide/configuration-properties#TOC-Client-Events-Optimizations">deferred
                            event handling</a> on the client.
                        </p>
                    </li>
                </ul>
                <p>
                    The <code>xxforms:group</code> attribute must contain an identifier unique between groups of radio
                    controls. Example:
                </p>
                <xml-source>
                    <xforms:repeat nodeset="instance('countries')/country">
                        <xxforms:variable name="country" select="."/>
                        <xhtml:tr>
                            <xhtml:td>
                                <xforms:select1 appearance="full" ref="instance('selected')" xxforms:group="country-code-group">
                                    <xforms:item>
                                        <xforms:label/>
                                        <xforms:value value="$country/us-code"/>
                                    </xforms:item>
                                </xforms:select1>
                            </xhtml:td>
                        </xhtml:tr>
                    </xforms:repeat>
                </xml-source>
                <note>
                    This attribute does not work in <i>noscript</i> mode yet even though it would be very useful in this
                    case as well.
                </note>
            </section>
        </section>
    </body>
</document>
