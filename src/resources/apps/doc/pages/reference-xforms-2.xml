<?xml version="1.0" encoding="windows-1252"?>
<!--
    Copyright (C) 2004-2008 Orbeon, Inc.

    The Orbeon documentation is not distributed under the LGPL license. Use of the documentation is
    subject to the following terms:

    * Conversion to other formats is allowed, but the actual content may not be altered or edited
      in any way.

    * You may create printed copies for your own personal use.

    * For all other uses, such as selling printed copies or using (parts of) the manual in another
      publication, prior written agreement from Orbeon, Inc. is required.

    Please contact Orbeon at info@orbeon.com for more information.
-->
<document xmlns:p="http://www.orbeon.com/oxf/pipeline"
          xmlns:xforms="http://www.w3.org/2002/xforms"
          xmlns:xxforms="http://orbeon.org/oxf/xml/xforms"
          xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xmlns:xhtml="http://www.w3.org/1999/xhtml"
          xmlns:ev="http://www.w3.org/2001/xml-events"
          xmlns:xi="http://www.w3.org/2001/XInclude" >
    <header>
        <title>XForms Reference, Part 2</title>
    </header>
    <body>
        <section>
            <title>Introduction</title>
            <p>
                This is Part 2 of a two-part documentation. This part focuses on extensions over XForms provided by
                Orbeon Forms, as well as XForms engine configuration.
            </p>
            <p>
                Please be sure to visit <a href="reference-xforms-ng">Part 1</a> as well.
            </p>
        </section>
        <a name="xforms11-extensions"/>
        <a name="xforms11"/>
        <section>
            <title>XForms 1.1 Support</title>
            <a name="output-mediatype"/>
            <section>
                <title>Media Type for <code>xforms:output</code></title>
                <p>
                    In XForms 1.0, <code>xforms:output</code> is only used to display text. However, XForms 1.1 supports
                    a <code>mediatype</code> attribute on that element allowing display of other media types.
                </p>
                <a name="xforms-image-mediatype"/>
                <section>
                    <title>Image Types</title>
                    <p>
                         For the <code>&lt;xforms:output></code> control to display an image, you
                         need to:
                    </p>
                    <ul>
                        <li>
                            <p>
                                Have a <code>mediatype</code> attribute on the <code>&lt;xforms:output></code>. That
                                attribute must refer to an image mediatype, such as <code>image/*</code> or
                                <code>image/jpeg</code>.
                            </p>
                        </li>
                       <li>
                            <p>
                                Use the <code>value</code> attribute on <code>&lt;xforms:output></code> or bind to the
                                control to a node without type, with an <code>xs:anyURI</code> type or with an
                                <code>xs:base64Binary</code> type.
                            </p>
                        </li>
                   </ul>
                    <p>
                        The resulting value from the instance is interpreted either as a URI pointing to an image, or as
                        a base64-encoded binary representation of the image. The image will display in place of the
                        <code>xforms:output</code>. It is possible to dynamically change the image pointed to. For
                        example:
                    </p>
                    <xml-source show-namespaces="false">
                        <xforms:output mediatype="image/*" value="'/images/moon.jpg'"/>
                    </xml-source>
                    <xml-source show-namespaces="false">
                        <xforms:model>
                            <xforms:instance>
                                <image-uri/>
                            </xforms:instance>
                            <xforms:bind nodeset="image-uri" type="xs:anyURI"/>
                        </xforms:model>
                        ...
                        <xforms:output mediatype="image/*" ref="image-uri"/>
                    </xml-source>
                    <p>
                        The image URI may or may no be reachable from the client browser. Orbeon Forms hides this from
                        the developer. For example, to upload and show an image:
                    </p>
                    <xml-source>
                        <comment> Hide xforms:output when there is no URI available </comment>
                        <xforms:group ref="image[normalize-space() != '']">
                            <comment> Image output </comment>
                            <xforms:output ref="." mediatype="image/*">
                                <xforms:label/>
                            </xforms:output>
                        </xforms:group>
                        <comment> File chooser </comment>
                        <xforms:upload ref="image">
                            <xforms:label/>
                            <xforms:filename ref="@filename"/>
                            <xforms:mediatype ref="@mediatype"/>
                            <xxforms:size ref="@size"/>
                        </xforms:upload>
                    </xml-source>
                    <p>
                        In that example, the upload control stores a temporary URI pointing to a local
                        <code>file:</code> resource. While this URI is not visible from the client web browser, the
                        output control automatically proxies it so that the end user can see the image.
                    </p>
                </section>
                <section>
                    <title>HTML Type</title>
                    <p>
                        When an <code>xforms:output</code> control has a <code>mediatype</code>
                        attribute with value <code>text/html</code>, the value of the node to which
                        the control is bound is interpreted as HTML content. Consider the following
                        XForms instance:
                    </p>
                    <xml-source show-namespaces="false">
                        <xforms:instance id="my-instance">
                            <form>
                                <html-content>
                                    This is in &amp;lt;b&amp;gt;bold&amp;lt;/b&amp;gt;!
                                </html-content>
                            </form>
                        </xforms:instance>
                    </xml-source>
                    <p>
                        You bind an <code>xforms:output</code> control to the
                        <code>html-content</code> node as follows:
                    </p>
                    <xml-source show-namespaces="false">
                        <xforms:output ref="instance('my-instance')/html-content" mediatype="text/html"/>
                    </xml-source>
                    <p>
                        This will display the result as HTML, as expected: "This is in <b>bold</b>!". If the
                        <code>mediatype</code> is not specified, the result would be instead: "This is in
                        &lt;b>bold&lt;/b>!". In the XForms instance, the HTML content must be escaped as text. On
                        the other hand, the following content will not work as expected:
                    </p>
                    <xml-source show-namespaces="false">
                        <xforms:instance>
                            <form>
                                <html-content>
                                    This is in in <b>bold</b>!
                                </html-content>
                            </form>
                        </xforms:instance>
                    </xml-source>
                    <note>
                        When using a <code>mediatype="text/html"</code>, an HTML
                        <code>&lt;div></code> element will be generated by the XForms engine to hold
                        the HTML data. As in HTML a <code>&lt;div></code> cannot
                        be embedded into a <code>&lt;p></code>, if you have a
                        <code>&lt;xforms:output mediatype="text/html"></code> control, you should
                        not put that control into a <code>&lt;xhtml:p></code>.
                    </note>
                </section>
            </section>
            <a name="origin-attribute"/>
            <section>
                <title><code>origin</code> Attribute on <code>xforms:insert</code> Action</title>
                <p>
                    Orbeon Forms supports the XForms 1.1 <code>origin</code> attribute on the
                    <code>xforms:insert</code> action. This attribute allows specifying the source node to use as
                    template. This allows storing templates separately from the node-set specified by the
                    <code>nodeset</code> attribute. For example:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:insert nodeset="address" at="last()" position="after" origin="instance('template-instance')"/>
                </xml-source>
                <p>
                    The template copied in this case comes from an XForms instance:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:instance id="template-instance">
                        <address>
                            <street>
                                <number/>
                                <name-1/>
                                <name-2/>
                            </street>
                            <apt/>
                            <city/>
                            <state/>
                            <zip/>
                        </address>
                    </xforms:instance>
                </xml-source>
            </section>
            <a name="insert-context-attribute"/>
            <section>
                <title><code>context</code> Attribute on <code>xforms:insert</code> Action</title>
                <p>
                    Orbeon Forms supports the XForms 1.1 <code>context</code> attribute on the
                    <code>xforms:insert</code> action. This attribute allows specifying a context for insertion,
                    which along with the <code>origin</code> attribute allows inserting content into elements:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:insert context="instance('main-instance')/books" nodeset="book" origin="instance('book-instance')"/>
                </xml-source>
                <p>
                    With original instances as follows:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:instance id="main-instance">
                        <instance xmlns="">
                            <books/>
                        </instance>
                    </xforms:instance>
                    <xforms:instance id="book-instance">
                        <book xmlns="">
                            <title>Cosmos</title>
                            <author>Carl Sagan</author>
                        </book>
                    </xforms:instance>
                </xml-source>
                <p>
                    The result of a first insertion is:
                </p>
                <xml-source show-namespaces="false">
                    <xforms:instance id="main-instance">
                        <instance xmlns="">
                            <books>
                                <book>
                                    <title>Cosmos</title>
                                    <author>Carl Sagan</author>
                                </book>
                            </books>
                        </instance>
                    </xforms:instance>
                </xml-source>
            </section>
            <a name="validate-relevant-attributes"/>
            <section>
                <title><code>validate</code> and <code>relevant</code> Attributes on <code>xforms:submission</code></title>
                <p>
                    Orbeon Forms supports the XForms 1.1 <code>validate</code> and <code>relevant</code> attributes
                    on <code>xforms:submission</code>. These boolean attributes disable processing of validation
                    and relevance respectively for a given submission:
                </p>
                <xml-source>
                    <xforms:submission id="my-submission" method="post" validate="false" relevant="false"
                                       resource="http://example.org/rest/draft/"
                                       replace="none"/>
                </xml-source>
                <p>
                    For more information, please visit the <a
                    href="http://www.w3.org/TR/xforms11/#submit-submission-element">XForms 1.1 specification</a>.
                </p>
            </section>
            <a name="serialization-attribute"/>
            <section>
                <title><code>serialization</code> Attribute on <code>xforms:submission</code></title>
                <p>
                    Orbeon Forms partially supports the XForms 1.1 <code>serialization</code> on
                    <code>xforms:submission</code>: when the value of this attribute is set to <code>none</code>, no
                    serialization of the data takes place. This is particularly useful for the <code>get</code>
                    method:
                </p>
                <xml-source>
                    <xforms:submission id="my-submission" method="get" serialization="none" resource="http://example.org/document.xml"
                                       replace="instance" instance="my-instance"/>
                </xml-source>
                <p>
                    For more information, please visit the <a
                    href="http://www.w3.org/TR/xforms11/#submit-submission-element">XForms 1.1 specification</a>.
                </p>
            </section>
            <a name="xforms11-if-while"/>
            <section>
                <title>Conditional Execution and Iteration of XForms Actions</title>
                <p>
                    Orbeon Forms supports the XForms 1.1 <code>if</code> and <code>while</code> attributes on XForms
                    action elements. For more information, please visit the <a
                    href="http://www.w3.org/TR/xforms11/#action-conditional">XForms 1.1 specification</a>.
                </p>
            </section>
            <a name="xforms11-function"/>
            <section>
                <title>XForms 1.1 Functions</title>
                <p>
                    [TODO: List all XForms 1.1 functions implemented]
                </p>
            </section>
        </section>
        <a name="extensions"/>
        <section>
            <title>Extensions</title>
            <a name="readonly-mode"/>
            <section>
                <title>Read-Only Mode</title>
                <section>
                    <title>Making an Entire Instance Read-Only</title>
                    <p>
                        You often want to present a form without allowing the user to enter data. An easy solution is to use
                        the <code>readonly</code> MIP in the model. By making for example the root element of an instance
                        read-only, all the controls bound to any node of that instance will appear read-only (because the
                        read-only property is inherited in an instance):
                    </p>
                    <xml-source>
                        <xforms:instance id="my-form">
                            <form>
                                ...
                            </form>
                        </xforms:instance>
                        <xforms:bind nodeset="instance('my-form')" readonly="true()"/>
                    </xml-source>
                </section>
                <section>
                    <title>Static Appearance for Read-Only Mode</title>
                    <p>
                        Sometimes, read-only controls don't appear very nicely in web browsers. For example, a combo box
                        will appear grayed out. It maybe be hard to read, and there is not much point showing a combo box
                        since the user can't interact with it. Furthermore, with some browsers, like IE 6 and earlier, it
                        is not even possible to make disabled controls appear nicer with CSS. In order to make read-only
                        versions of forms look nicer, Orbeon Forms supports a special extention attribute that allows you
                        to produce a "static" appearance for read-only controls. You enable this on your first XForms model:
                    </p>
                    <xml-source>
                        <xforms:model xxforms:readonly-appearance="static">
                            ...
                        </xforms:model>
                    </xml-source>
                    <p>
                        The attribute takes one of two vales: <code>static</code> or <code>dynamic</code> (the default).
                        When using the value <code>static</code>, read-only controls do not produce disabled HTML form
                        controls. This has one major limitation: you can't switch a control back to being read-write once
                        it is displayed as read-only.
                    </p>
                    <p>
                        You can also set the <code>xxforms:readonly-appearance</code> attribute directly on individual
                        XForms controls.
                    </p>
                    <p>
                        See the <a href="/forms/">Government Forms</a> sample application's <i>View Read-Only</i> option for
                        an example of this feature in action.
                    </p>
                </section>
            </section>
            <a name="xforms-formatting"/>
            <section>
                <title>Formatting</title>
                <section>
                    <title>Rationale</title>
                    <p>
                        It is usually recommended to use native XML types within XForms instances, as this guarantees
                        interoperability and maintainability. For example, a date of January 10, 2005 is stored in ISO
                        format as: <code>2005-10-01</code>. However it is often necessary to format such values on screen
                        in a user-readable format, like "January 10, 2005", "10 janvier 2005", or "10. Januar 2005".
                    </p>
                    <p>
                        Orbeon Forms provides an extension attribute, <code>xxforms:format</code>, for that purpose.
                        <code>xxforms:format</code> must contain an XPath 2.0 expression. In your XPath expression you can
                        use all the XPath 2.0 functions, including those for date manipulation (<a
                        href="http://www.w3.org/TR/2005/CR-xpath-functions-20051103/#durations-dates-times">external
                        documentation</a>). However since XPath 2.0 functions don't provide any facility for date and time
                        formatting, you can in this attribute also use the following XSLT 2.0 functions:
                    </p>
                    <ul>
                        <li><p><code>format-date()</code> (<a href="http://www.w3.org/TR/2005/WD-xslt20-20050915/#function-format-date">external documentation</a>)</p></li>
                        <li><p><code>format-dateTime()</code> (<a href="http://www.w3.org/TR/2005/WD-xslt20-20050915/#function-format-dateTime">external documentation</a>)</p></li>
                        <li><p><code>format-time()</code> (<a href="http://www.w3.org/TR/2005/WD-xslt20-20050915/#function-format-time">external documentation</a>)</p></li>
                        <li><p><code>format-number()</code> (<a href="http://www.w3.org/TR/2005/WD-xslt20-20050915/#function-format-number">external documentation</a>)</p></li>
                    </ul>
                    <p>
                        The XPath expression is evaluated by the XForms engine whenever the value bound to the
                        <code>xforms:input</code> control changes and needs to be updated on screen. It is evaluated in the
                        context of the instance node bound to the control. This means that the current value of the control
                        can be accessed with "<code>.</code>". Often the value must be converted (for example to a date) in
                        which case the conversion can be done with a XPath 2.0 constructor such as <code>xs:date(.)</code>
                        or with as cast such as <code>(. cast as xs:date?)</code>.
                    </p>
                </section>
                <section>
                    <title>xforms:input</title>
                    <p>
                        When using <code>xforms:input</code> and a bound <code>xs:date</code> type, you can control the
                        formatting of the date using the <code>xxforms:format</code> extension attribute on the
                        <code>xforms:input</code> control. For example:
                    </p>
                    <xml-source show-namespaces="false">
                        <xforms:input ref="date" xxforms:format="format-date(xs:date(.), '[MNn] [D], [Y]', 'en', (), ())"/>
                    </xml-source>
                    <note>
                        <p>
                            This only controls the appearance of the date as shown to the user. It does not control the
                            format of the date captured in the XML document, or determines the format into which the
                            user can type the date.
                        </p>
                    </note>
                </section>
                <section>
                    <title>xforms:output</title>
                    <p>
                        When using <code>xforms:output</code>, you can control the formatting of the date using the
                        <code>xxforms:format</code> extension attribute on the <code>xforms:output</code> control.
                    </p>
                    <xml-source show-namespaces="false">
                        <xforms:output ref="date" xxforms:format="format-date(xs:date(.), '[MNn] [D], [Y]', 'en', (), ())"/>
                        <xforms:output ref="size" xxforms:format="format-number(., '###,##0')"/>
                    </xml-source>
                </section>
                <a name="xforms-default-formatting"/>
                <section>
                    <title>Default Formatting</title>
                    <p>
                        For both <code>xforms:input</code> and <code>xforms:output</code>, if the bound node is of one of
                        the following types: <code>xs:date</code>, <code>xs:dateTime</code>, <code>xs:time</code>,
                        <code>xs:decimal</code>, <code>xs:integer</code>, <code>xs:float</code>, and <code>xs:double</code>,
                        and if no <code>xxforms:format</code> attribute is present on the control, formatting is based on
                        <a href="reference-properties">properties</a>. If the properties are missing, a built-in default
                        formatting is used. The default properties, as well as the built-in defaults, are as follows:
                    </p>
                    <xml-source>
                        <property as="xs:string"  name="oxf.xforms.format.date"                          value="if (. castable as xs:date) then format-date(xs:date(.), '[FNn] [MNn] [D], [Y]', 'en', (), ()) else ."/>
                        <property as="xs:string"  name="oxf.xforms.format.dateTime"                      value="if (. castable as xs:dateTime) then format-dateTime(xs:dateTime(.), '[FNn] [MNn] [D], [Y] [H01]:[m01]:[s01] UTC', 'en', (), ()) else ."/>
                        <property as="xs:string"  name="oxf.xforms.format.time"                          value="if (. castable as xs:time) then format-time(xs:time(.), '[H01]:[m01]:[s01] UTC', 'en', (), ()) else ."/>
                        <property as="xs:string"  name="oxf.xforms.format.decimal"                       value="if (. castable as xs:decimal) then format-number(xs:decimal(.),'#,##0.00') else ."/>
                        <property as="xs:string"  name="oxf.xforms.format.integer"                       value="if (. castable as xs:integer) then format-number(xs:integer(.),'#,##0') else ."/>
                        <property as="xs:string"  name="oxf.xforms.format.float"                         value="if (. castable as xs:float) then format-number(xs:float(.),'#,##0.000') else ."/>
                        <property as="xs:string"  name="oxf.xforms.format.double"                        value="if (. castable as xs:double) then format-number(xs:double(.),'#,##0.000') else ."/>
                    </xml-source>
                    <p>
                        They produce results as follows:
                    </p>
                    <ul>
                        <li>
                            <p>
                                <code>2004-01-07</code> as <code>xs:date</code> is displayed as <code>Wednesday January 7, 2004</code>
                            </p>
                        </li>
                        <li>
                            <p>
                                <code>2004-01-07T04:38:35.123</code> as <code>xs:dateTime</code> is displayed as <code>Wednesday January 7, 2004 04:38:35 UTC</code>
                            </p>
                        </li>
                        <li>
                            <p>
                                <code>04:38:35.123</code> as <code>xs:time</code> is displayed as <code>04:38:35 UTC</code>
                            </p>
                        </li>
                        <li>
                            <p>
                                <code>123456.789</code> as <code>xs:decimal</code> is displayed as <code>123,456.79</code>
                            </p>
                        </li>
                        <li>
                            <p>
                                <code>123456.789</code> as <code>xs:integer</code> is displayed as <code>123,456</code>
                            </p>
                        </li>
                        <li>
                            <p>
                                <code>123456.789</code> as <code>xs:float</code> or <code>xs:double</code> is displayed as <code>123,456.789</code>
                            </p>
                        </li>
                    </ul>
                    <p>Note:</p>
                    <ul>
                        <li>
                            With the "if" condition in the XPath expressions, a value which cannot be converted to the
                            appropriate type is simply displayed as is.
                        </li>
                        <li>
                            For values of type <tt>xs:time</tt> or <tt>xs:dateTime</tt>, if you wish the time to be
                            displayed using the current timezone instead of UTC, replace in the <tt>value</tt> attribute
                            <tt>UTC</tt> by <tt>[ZN]</tt>.
                        </li>
                    </ul>
                </section>
            </section>
            <a name="exforms-iterate"/>
            <section>
                <title>Iteration of XForms Actions over Sequences</title>
                <p>
                    Orbeon Forms supports the <code>exforms:iterate</code> attribute, also available as
                    <code>xxforms:iterate</code> attribute, on XForms action elements. Consider the following
                    instances:
                </p>
                <xml-source>
                    <xforms:instance id="main-instance">
                        <instance xmlns=""/>
                    </xforms:instance>

                    <xforms:instance id="template-instance">
                        <book xmlns="">
                            <title/>
                            <author/>
                        </book>
                    </xforms:instance>

                    <xforms:instance id="source-instance">
                        <instance xmlns="">
                            <title>Don Quixote de la Mancha</title>
                            <author>Miguel de Cervantes Saavedra</author>
                            <title>Jacques le fataliste et son maître</title>
                            <author>Denis Diderot</author>
                            <title>Childhood's End</title>
                            <author>Arthur C. Clarke</author>
                        </instance>
                    </xforms:instance>
                </xml-source>
                <p>
                    The following action iterates over the <code>&lt;title></code> elements of
                    <code>source-instance</code>. For each of those, a new <code>&lt;book></code> element, copied from
                    the template stored in <code>template-instance</code>, is inserted into <code>main-instance</code>.
                    Then values from the <code>&lt;title></code> and <code>&lt;author></code> elements are copied over
                    to the new structure. The XForms 1.1 <code>context()</code> function provides access to each of the
                    iterated nodes:
                </p>
                <xml-source>
                    <xforms:action ev:event="xforms-ready" xxforms:iterate="instance('source-instance')/title">
                        <xforms:insert context="instance('main-instance')" nodeset="book" origin="instance('template-instance')"/>
                        <xforms:setvalue ref="instance('main-instance')/book[last()]/title" value="context()"/>
                        <xforms:setvalue ref="instance('main-instance')/book[last()]/author" value="context()/following-sibling::author"/>
                    </xforms:action>
                </xml-source>
                <p>
                    The resulting <code>main-instance</code> is as follows:
                </p>
                <xml-source>
                    <instance>
                        <book>
                            <title>Don Quixote de la Mancha</title>
                            <author>Miguel de Cervantes Saavedra</author>
                        </book>
                        <book>
                            <title>Jacques le fataliste et son maître</title>
                            <author>Denis Diderot</author>
                        </book>
                        <book>
                            <title>Childhood's End</title>
                            <author>Arthur C. Clarke</author>
                        </book>
                    </instance>
                </xml-source>
                <p>
                    Note that because Orbeon Forms uses XPath 2.0, <code>xxforms:iterate</code> is not limited to
                    returning node-sets, but can return sequences of items such as strings.
                </p>
                <p>
                    For more information about eXforms extensions, please visit the <a
                    href="http://www.exforms.org/conditionals.html#id4484032">eXforms site</a>.
                </p>
            </section>
            <a name="context-attribute"/>
            <section>
                <title>Generalized <code>context</code> attribute</title>
                <p>
                    XForms 1.1 introduces the <code>context</code> attribute on <code>&lt;xforms:insert></code> and
                    <code>&lt;xforms:delete></code>. Orbeon Forms supports this convenient attribute on all XForms
                    elements changing the XPath evaluation context, including controls, actions, binds, and
                    submissions.
                </p>
                <p>
                    The <code>context</code> attribute overrides the in-scope XPath evaluation context for an action. It
                    applies before the <code>ref</code> and <code>context</code> attributes, but after the
                    <code>model</code> attribute.
                </p>
                <p>
                    One convenient use is to just change the context within a group:
                </p>
                <xml-source>
                    <xforms:group context="personal-information">
                        ...
                    </xforms:group>
                </xml-source>
                <p>
                    Note that it is also possible to use <code>ref</code> in this case, but doing so has the side effect
                    of binding the group to an instance data node, which may affect group relevance, for example.
                </p>
            </section>
            <a name="event-context"/>
            <section>
                <title>Enhanced <code>event()</code> Function Support</title>
                <p>
                    [TODO: describe Orbeon Forms support for event() function for each event]
                </p>
            </section>
            <a name="dispatch-context"/>
            <section>
                <title>Enhanced <code>&lt;xforms:dispatch></code> Support</title>
                <p>
                    Orbeon Forms supports passing event context attributes with the <code>&lt;xxforms:context></code>
                    child element. The actions supported are actions which directly cause an event to be dispatched:
                </p>
                <ul>
                    <li>
                        <p>
                            <code>&lt;xforms:dispatch></code>
                        </p>
                    </li>
                    <li>
                        <p>
                            <code>&lt;xforms:send></code>
                        </p>
                    </li>
                    <li>
                        <p>
                            <code>&lt;xxforms:show></code>
                        </p>
                    </li>
                    <li>
                        <p>
                            <code>&lt;xxforms:hide></code>
                        </p>
                    </li>
                </ul>
                <p>
                    Here is how you pass context attributes when executing an action:
                </p>
                <xml-source>
                    <xforms:dispatch name="rename-control" target="my-model">
                        <xxforms:context name="control" select="my/control"/>
                        <xxforms:context name="control-name" select="'beverage-selection'"/>
                    </xforms:dispatch>
                </xml-source>
                <p>
                    <code>&lt;xxforms:context></code> supports the following two attributes:
                </p>
                <table>
                    <tr>
                        <th><code>name</code></th>
                        <td>Mandatory</td>
                        <td>
                            Name of the context attribute.
                        </td>
                    </tr>
                    <tr>
                        <th><code>select</code></th>
                        <td>Mandatory</td>
                        <td>
                            XPath 2.0 expression determining the value of the context attribute.
                        </td>
                    </tr>
                </table>
                <p>
                    Context attribute passed this way can be retrieved using the <code>event()</code> function:
                </p>
                <xml-source>
                    <xforms:action ev:event="rename-control">
                        <xforms:setvalue ref="event('control')/@name" value="event('control-name')"/>
                    </xforms:action>
                </xml-source>
                <note>
                    <p>
                        At the moment, with, <code>&lt;xforms:dispatch></code>, only custom events support passing
                        context attributes this way. Built-in events, such as <code>xforms-value-changed</code>, or
                        <code>DOMActivate</code>, ignore nested <code>&lt;xxforms:context></code> elements.
                    </p>
                </note>
            </section>
            <a name="xforms-select-deselect"/>
            <section>
                <title>Enhanced Support for <code>xforms-select</code> and <code>xforms-deselect</code></title>
                <p>
                    [TODO: describe support for these events on xforms:upload]
                </p>
            </section>
            <a name="xpath-extensions"/>
            <section>
                <title>XPath Extension Functions</title>
                <p>
                    Orbeon Forms implements some extension functions which can be used from XPath expressions
                    in XForms documents.
                </p>
                <section>
                    <title>XSLT 2.0 Functions</title>
                    <p>
                        When using XPath 2.0, the following functions from XSLT 2.0 are also available:
                    </p>
                    <ul>
                        <li><p><code>format-date()</code> (<a href="http://www.w3.org/TR/2005/WD-xslt20-20050915/#function-format-date">external documentation</a>)</p></li>
                        <li><p><code>format-dateTime()</code> (<a href="http://www.w3.org/TR/2005/WD-xslt20-20050915/#function-format-dateTime">external documentation</a>)</p></li>
                        <li><p><code>format-time()</code> (<a href="http://www.w3.org/TR/2005/WD-xslt20-20050915/#function-format-time">external documentation</a>)</p></li>
                        <li><p><code>format-number()</code> (<a href="http://www.w3.org/TR/2005/WD-xslt20-20050915/#function-format-number">external documentation</a>)</p></li>
                    </ul>
                </section>
                <a name="ops-extensions"/>
                <section>
                    <title>Orbeon Forms Functions</title>
                    <p>
                        The following functions are implemented:
                    </p>
                    <ul>
                        <li>
                            <a name="xxforms-if"/>
                            <p>
                                <code>xxforms:if()</code>
                            </p>
                            <p>
                                This function implements the semantic of the XForms 1.0 <code>if()</code> function.
                                See <a href="#xforms-xpath-20">Note About XPath 2.0 Expressions</a> for more details.
                            </p>
                        </li>
                        <li>
                            <a name="xxforms-call-xpl"/>
                            <p>
                                <code>xxforms:call-xpl($xplURL as xs:string, $inputNames as xs:string*, $inputElements
                                as element()*, $outputNames as xs:string+) as document-node()*</code>
                            </p>
                            <p>
                                This function lets you call an XPL pipeline.
                            </p>
                            <ol>
                                <li>
                                    The first argument, <code>$XPLurl</code>, is the URL of the pipeline. It must be an
                                    absolute URL.
                                </li>
                                <li>
                                    The second argument, <code>$inputNames</code>, is a sequence of strings, each one
                                    representing the name of an input of the pipeline that you want to connect.
                                </li>
                                <li>
                                    The third argument, <code>$inputElements</code>, is a sequence of elements to be
                                    used as input for the pipeline. The <code>$inputNames</code> and
                                    <code>$inputElements</code> sequences must have the same length. For each element
                                    in <code>$inputElements</code>, a document is created and connected to an input of
                                    the pipeline. Elements are matched to input name by position, for instance the
                                    element at position 3 of <code>$inputElements</code> is connected to the input with
                                    the name specified at position 3 in <code>$inputNames</code>.
                                </li>
                                <li>
                                    The fourth argument, <code>$outputNames</code>, is a sequence of output names to
                                    read.
                                </li>
                                <li>
                                    The function returns a sequence of document nodes corresponding the output of the
                                    pipeline. The returned sequence will have the same length as
                                    <code>$outputNames</code> and will correspond to the pipeline output with the name
                                    specified on <code>$outputNames</code> based on position.
                                </li>
                            </ol>
                            <p>
                                The example below shows a call to the <code>xxforms:call-xpl</code> function:
                            </p>
                            <xml-source>
                                xxforms:call-xpl ('oxf:/examples/sandbox/xpath/run-xpath.xpl', ('input', 'xpath'),
                                (instance('instance')/input, instance('instance')/xpath), 'formatted-output')/*, 'html')
                            </xml-source>
                        </li>
                        <li>
                            <a name="xxforms-evaluate"/>
                            <p>
                                <code>xxforms:evaluate($xpath as xs:string) as item()*</code>
                            </p>
                            <p>
                                The <code>xxforms:evaluate()</code> function allows you to evaluate XPath expressions
                                dynamically. For example:
                            </p>
                            <xml-source show-namespaces="false">
                                <xforms:input ref="xxforms:evaluate(concat('instance(''my-instance'')/document', my-xpath))">
                                    <xforms:label>...</xforms:label>
                                </xforms:input>
                            </xml-source>
                        </li>
                        <li>
                            <a name="xxforms-serialize"/>
                            <p>
                                <code>xxforms:serialize($item as node(), $format as xs:string?) as xs:string</code>
                            </p>
                            <p>
                                The <code>xxforms:serialize()</code> function allows you to serialize an XML node to
                                XML, HTML, XHTML or text. For example:
                            </p>
                            <xml-source show-namespaces="false">
                                <xforms:bind nodeset="my-html" calculate="xxforms:serialize(instance('my-instance'), 'html')"/>
                            </xml-source>
                        </li>
                        <li>
                            <a name="xxforms-context"/>
                            <p>
                                <code>xxforms:context($element-id as xs:string) as node()</code>
                            </p>
                            <p>
                                The <code>xxforms:context()</code> function allows you to obtain the single-node binding
                                for an enclosing <code>xforms:group</code>, <code>xforms:repeat</code>, or
                                <code>xforms:switch</code>. It takes one mandatory string parameter containing the id of
                                an enclosing grouping XForms control. For xforms:repeat, the context returned is the
                                context of the current iteration.
                            </p>
                            <xml-source show-namespaces="false">
                                <xforms:group ref="employee" id="employee-group">
                                    <comment> The context is being set to another instance that controls the visibility of the group. </comment>
                                    <xforms:group ref="instance('control-instance')/input">
                                        <comment> Using xxforms:context() allows reclaiming the context of the enclosing group. </comment>
                                        <xforms:input ref="xxforms:context('employee-group')/name">
                                            <xforms:label>Employee Name</xforms:label>
                                        </xforms:input>
                                    </xforms:group>
                                </xforms:group>
                            </xml-source>
                            <note>
                                <p>
                                    See also the XForms 1.1 <code>context()</code> function, which returns the current
                                    evaluation context:
                                </p>
                                <xml-source show-namespaces="false">
                                    <xforms:group ref="employee">
                                        <xforms:setvalue ref="instance('foo')/name" value="context()/name"/>
                                    </xforms:group>
                                </xml-source>
                            </note>
                        </li>
                        <li>
                            <a name="xxforms-bind"/>
                            <p>
                                <code>xxforms:bind(bind-id as xs:string) as node()*</code>
                            </p>
                            <p>
                                The <code>xxforms:bind()</code> function returns the node-set of a given
                                <code>&lt;xforms:bind></code>:
                            </p>
                            <xml-source show-namespaces="false">
                                <comment> The following... </comment>
                                <xforms:input bind="my-bind">
                                    ...
                                </xforms:input>
                                <comment> ...is equivalent to this: </comment>
                                <xforms:input ref="xxforms:bind('my-bind')">
                                    ...
                                </xforms:input>
                            </xml-source>
                            <p>
                                <code>xxforms:bind()</code> is particularly useful when referring to a bind is subject
                                to a condition:
                            </p>
                            <xml-source>
                                <xforms:hint ref="for $bind in xxforms:bind('my-hint') return if (normalize-space($bind) = '') then instance('default-hint') else $bind"/>
                            </xml-source>
                        </li>
                        <li>
                            <a name="xxforms-repeat-nodeset"/>
                            <p>
                                <code>xxforms:repeat-nodeset($repeat-id as xs:string) as node()*</code>
                            </p>
                            <p>
                                The <code>xxforms:repeat-nodeset()</code> function returns the node-set of an enclosing
                                <code>xforms:repeat</code>. It takes one mandatory string parameter containing the id of
                                an enclosing repeat XForms control.
                            </p>
                            <xml-source show-namespaces="false">
                                <xforms:repeat id="employee-repeat" nodeset="employee">
                                    <xhtml:div>
                                        <xforms:output value="count(xxforms:repeat-nodeset('book-repeat'))"/>
                                    </xhtml:div>
                                </xforms:repeat>
                            </xml-source>
                        </li>
                        <li>
                            <a name="xxforms-instance"/>
                            <p>
                                <code>xxforms:instance($instance-id as xs:string) as element()?</code>
                            </p>
                            <p>
                                The <code>xxforms:instance()</code> function works like the standard
                                <code>instance()</code> function except that it searches for instances in all the models
                                of the XForms document (the standard <code>instance()</code> function only searches
                                within the current XForms model).
                            </p>
                            <xml-source show-namespaces="false">
                                <xforms:model id="main-model">
                                    <xforms:instance id="main-instance">
                                        ...
                                    </xforms:instance>
                                </xforms:model>
                                <xforms:model id="resources-model">
                                    <xforms:instance id="resources-instance">
                                        ...
                                    </xforms:instance>
                                </xforms:model>
                                ...
                                <xforms:group model="main-model">
                                    <xforms:output value="xxforms:instance('resources-instance')/titles/company-information"/>
                                </xforms:group>
                            </xml-source>
                        </li>
                        <li>
                            <a name="xxforms-index"/>
                            <p>
                                <code>xxforms:index($repeat-id as xs:string?) as xs:integer</code>
                            </p>
                            <p>
                                The <code>xxforms:index()</code> function behaves like the standard XForms
                                <code>index()</code> function, except that its argument is optional. When the argument
                                is omitted, the function returns the index of the closest enclosing
                                <code>&lt;xforms:repeat></code> element. This function must always be used within
                                <code>&lt;xforms:repeat></code> otherwise an error is raised.
                            </p>
                            <xml-source show-namespaces="false">
                                <xforms:repeat nodeset="employee" id="employee-repeat">
                                    <div>
                                        <xforms:trigger>
                                            <xforms:label>Add One</xforms:label>
                                            <xforms:insert ev:event="DOMActivate" nodeset="../employee" at="xxforms:index()"/>
                                        </xforms:trigger>
                                    </div>
                                </xforms:repeat>
                            </xml-source>
                        </li>
                        <li>
                            <a name="xxforms-property"/>
                            <p>
                                <code>xxforms:property($property-name as xs:string) as xs:string?</code>
                            </p>
                            <p>
                                The <code>xxforms:property()</code> function retrieves the value of a property defined
                                in <code>properties.xml</code>. If no property exists with the given name, returns an
                                empty sequence.
                            </p>
                            <xml-source show-namespaces="false">
                                <xforms:repeat nodeset="employee" id="employee-repeat">
                                    <div>
                                        <xforms:trigger>
                                            <xforms:label>Read Property</xforms:label>
                                            <xforms:setvalue ev:event="DOMActivate" ref="my-property" value="xxforms:property('my.property.name')"/>
                                        </xforms:trigger>
                                    </div>
                                </xforms:repeat>
                            </xml-source>
                        </li>
                        <li>
                            <a name="xxforms-element"/>
                            <p>
                                <code>xxforms:element($element-name as xs:string) as element()</code>
                            </p>
                            <p>
                                <code>xxforms:element($element-name as xs:string, $content as item()*) as element()</code>.
                            </p>
                            <p>
                                The <code>xxforms:element()</code> function returns a new XML element with the qualified
                                name provided. If the name has a prefix, it is resolved using in-scope namespaces.
                            </p>
                            <xml-source show-namespaces="false">
                                <comment> Insert an element called "value" as a child of element "section" </comment>
                                <xforms:insert context="section" origin="xxforms:element('value')"/>
                            </xml-source>
                            <p>
                                The second, optional argument can take a sequence of items specifying attributes and
                                content for the new element:
                            </p>
                            <xml-source show-namespaces="false">
                                <comment> Insert an element called "value" as a child of element "section", with an attribute and text content </comment>
                                <xforms:insert context="section" origin="xxforms:element('value', (xxforms:attribute('id', 'my-value'), 'John'))"/>
                            </xml-source>
                        </li>
                        <li>
                            <a name="xxforms-attribute"/>
                            <p>
                                <code>xxforms:attribute($qname as xs:string, $value as xs:string?) as attribute()</code>
                            </p>
                            <p>
                                The <code>xxforms:attribute()</code> function returns a new XML attribute with the
                                qualified name provided as first argument. If the name has a prefix, it is resolved
                                using in-scope namespaces. The second argument is an optional value for the attribute.
                                It default to the empty string.
                            </p>
                            <xml-source show-namespaces="false">
                                <comment> Add an attribute called "id" with a value of "first-name" to element "section" </comment>
                                <xforms:insert context="section" origin="xxforms:attribute('id', 'first-name')"/>
                            </xml-source>
                        </li>
                        <li>
                            <a name="xxforms-get-request-header"/>
                            <p>
                                <code>xxforms:get-request-header($header-name as xs:string) as xs:string*</code>
                            </p>
                            <p>
                                The <code>xxforms:get-request-header()</code> function returns the value(s) of the
                                given request HTTP header.
                            </p>
                            <xml-source show-namespaces="false">
                                <comment> Remember the User-Agent header </comment>
                                <xforms:setvalue ref="user-agent" select="xxforms:get-request-header('User-Agent')"/>
                            </xml-source>
                            <note>
                                <p>
                                    This function can only be called during page initialization, otherwise it will throw
                                    an error. We recommend you use it only within event handlers called as a result of
                                    processing <code>xforms-model-construct-done</code> or <code>xforms-ready</code>.
                                </p>
                            </note>
                        </li>
                        <li>
                            <a name="xxforms-get-request-parameter"/>
                            <p>
                                <code>xxforms:get-request-parameter($parameter-name as xs:string) xs:string*</code>
                            </p>
                            <p>
                                The <code>xxforms:get-request-parameter()</code> function returns the value(s) of the
                                given request parameter.
                            </p>
                            <xml-source show-namespaces="false">
                                <comment> Remember the "columns" parameter </comment>
                                <xforms:setvalue ref="columns" select="xxforms:get-request-parameter('columns')"/>
                            </xml-source>
                            <note>
                                <p>
                                    This function can only be called during page initialization, otherwise it will throw
                                    an error. We recommend you use it only within event handlers called as a result of
                                    processing <code>xforms-model-construct-done</code> or <code>xforms-ready</code>.
                                </p>
                            </note>
                        </li>
                        <li>
                            <a name="xxforms-get-request-attribute"/>
                            <p>
                                <code>xxforms:get-request-attribute($a as xs:string) document-node()?</code>
                            </p>
                            <p>
                                The <code>xxforms:get-request-attribute()</code> function returns the value of the given
                                request attribute. The attribute may have been previously placed in the request through
                                Java code, for example.
                            </p>
                            <p>
                                Currently, this function always returns an XML document or an empty sequence. The
                                types of attribute objects supported are the same <a
                                href="processors-generators#scope-generator-types">types supported by the Scope
                                generator</a>.
                            </p>
                            <xml-source show-namespaces="false">
                                <comment> Get the "document" attribute and use it to replace instance "my-instance" </comment>
                                <xforms:insert nodeset="instance('my-instance')" origin="xxforms:get-request-attribute('document')"/>
                            </xml-source>
                            <note>
                                <p>
                                    This function can only be called during page initialization, otherwise it will throw
                                    an error. We recommend you use it only within event handlers called as a result of
                                    processing <code>xforms-model-construct-done</code> or <code>xforms-ready</code>.
                                </p>
                            </note>
                        </li>
                        <li>
                            <a name="xxforms-get-session-attribute"/>
                            <p>
                                <code>xxforms:get-session-attribute($a as xs:string) document-node()?</code>
                            </p>
                            <p>
                                The <code>xxforms:get-session-attribute()</code> function returns the value of the given
                                session attribute.
                            </p>
                            <p>
                                Currently, this function always returns an XML document or an empty sequence. The types
                                of attribute objects supported are the same <a
                                href="processors-generators#scope-generator-types">types supported by the Scope
                                generator</a>.
                            </p>
                            <xml-source show-namespaces="false">
                                <comment> Get the "document" attribute and use it to replace instance "my-instance" </comment>
                                <xforms:insert nodeset="instance('my-instance')" origin="xxforms:get-session-attribute('document')"/>
                            </xml-source>
                        </li>
                        <li>
                            <a name="xxforms-repeat-current"/>
                            <p>
                                <code>xxforms:repeat-current($repeat-id as xs:string?) as node()</code>.
                            </p>
                            <note>
                                <p>
                                    This function is deprecated. Use <a
                                    href="#xxforms-context"><code>xxforms:context()</code></a> or the XForms 1.1
                                    <code>context()</code> function instead.
                                </p>
                            </note>
                            <p>
                                The <code>xxforms:repeat-current()</code> function allows you to obtain a reference to
                                an enclosing <code>xforms:repeat</code>'s current iteration node. It takes one optional
                                string parameter. If present, the id of the enclosing <code>xforms:repeat</code> is
                                searched. If absent, the function looks for the closest enclosing
                                <code>xforms:repeat</code>.
                            </p>
                            <xml-source show-namespaces="false">
                                <xforms:repeat nodeset="employee" id="employee-repeat">
                                    <tr>
                                        <td>
                                            <comment> The context is being set to another instance that controls the visibility of the group. </comment>
                                            <xforms:group ref="instance('control-instance')/input">
                                                <comment> Using xxforms:repeat-current() allows reclaiming the context of the repeat iteration. </comment>
                                                <xforms:input ref="xxforms:repeat-current('employee-repeat')/name">
                                                    <xforms:label>Employee Name</xforms:label>
                                                </xforms:input>
                                            </xforms:group>
                                        </td>
                                    </tr>
                                </xforms:repeat>
                            </xml-source>
                            <p>
                                The <code>xxforms:repeat-current()</code> function must be called from within an
                                <code>xforms:repeat</code> element.
                            </p>
                        </li>
                    </ul>
                </section>
                <section>
                    <title>eXForms Functions</title>
                    <p>
                        <a href="http://www.exforms.org/">eXForms</a> is a suggested set of extensions to XForms 1.0,
                        grouped into different modules. Orbeon Forms supports the <a
                        href="http://www.exforms.org/mips.html"><code>exf:mip</code></a> module, which includes the
                        following functions:
                    </p>
                    <ul>
                        <li>
                            <p><code>exf:relevant()</code></p>
                        </li>
                        <li>
                            <p><code>exf:readonly()</code></p>
                        </li>
                        <li>
                            <p><code>exf:required()</code></p>
                        </li>
                    </ul>
                    <p>
                        Orbeon Forms also supports the following from the <a
                        href="http://exforms.org/sorting.html">sorting module</a>:
                    </p>
                    <ul>
                        <li>
                            <p><code>exf:sort()</code></p>
                        </li>
                    </ul>
                    <p>
                        eXForms functions live in the <code>http://www.exforms.org/exf/1-0</code> namespace, usually
                        bound to the prefix <code>exf</code> or <code>exforms</code>.
                    </p>
                </section>
            </section>
            <a name="xforms-javascript"/>
            <section>
                <title>JavaScript Integration</title>
                <section>
                    <title>Rationale</title>
                    <p>
                        While XForms gets you a long way towards creating a dynamic user-friendly user interface, there
                        are some dynamic behaviors of the user interface that cannot be implemented easily or at all
                        with XForms, or you might already have some JavaScript code that you would like to reused. A
                        JavaScript API is provided to handle those cases, or other use cases involving JavaScript that
                        you might have.
                    </p>
                </section>
                <a name="xforms-javascript-get-set-value"/>
                <section>
                    <title>Getting and Setting Controls Value</title>
                    <p>
                        In JavaScript, you get the current value of an XForms control <code>var value =
                        ORBEON.xforms.Document.getValue("myControl")</code> where <code>myControl</code> is the id of
                        the XForms control, for instance: <code>&lt;xforms:input id="myControl"></code>.
                    </p>
                    <p>
                        You set the value of an XForms control with <code>ORBEON.xforms.Document.setValue("myControl",
                        "42")</code> where <code>myControl</code> is the id of the XForms control, and <code>42</code>
                        the new value. Setting the value with JavaScript is equivalent to changing the value of the
                        control in the browser. This will trigger the recalculation of the instances, and the dispatch
                        of the <code>xforms-value-changed</code> event. More formally, the <a
                        href="http://www.w3.org/TR/xforms/slice4.html#rpm-event-seq-vcwfc">Value Change</a> sequence of
                        events occurs.
                    </p>
                    <p>
                        As an example, consider you have the model below. It declares an instance with two elements
                        <code>foo</code> and <code>bar</code>, where <code>bar</code> is a copy of <code>foo</code>,
                        implemented with a <code>calculate</code> MIP.
                    </p>
                    <xml-source show-namespaces="false">
                        <xforms:model>
                            <xforms:instance id="instance">
                                <instance>
                                    <foo>42</foo>
                                    <bar/>
                                </instance>
                            </xforms:instance>
                            <xforms:bind nodeset="/instance/bar" calculate="/instance/foo"/>
                        </xforms:model>
                    </xml-source>
                    <p>
                        The input control below is bound to <code>foo</code>, and the output control is bound to
                        <code>bar</code>. When activated, the trigger executes JavaScript with the
                        <code>&lt;xxforms:script></code> action. It increments the value of the input control bound to
                        <code>foo</code>. When this happens the value displayed by the output control bound to
                        <code>bar</code>is incremented as well, as <code>bar</code> is a copy of <code>foo</code>.
                    </p>
                    <xml-source show-namespaces="false">
                        <xhtml:p>
                            <xforms:input ref="foo" id="foo">
                                <xforms:label class="fixed-width">Value of foo:</xforms:label>
                            </xforms:input>
                        </xhtml:p>
                        <xhtml:p>
                            <xforms:output ref="bar">
                                <xforms:label class="fixed-width">Value of bar:</xforms:label>
                            </xforms:output>
                        </xhtml:p>
                        <xhtml:p>
                            <xforms:trigger>
                                <xforms:label>Increment foo with JavaScript</xforms:label>
                                <xxforms:script ev:event="DOMActivate">
                                    var fooValue = ORBEON.xforms.Document.getValue("foo");
                                    ORBEON.xforms.Document.setValue("foo", Number(fooValue) + 1);
                                </xxforms:script>
                            </xforms:trigger>
                        </xhtml:p>
                    </xml-source>
                </section>
                <a name="xforms-javascript-events"/>
                <section>
                    <title>Dispatching Events</title>
                    <p>
                        You can dispatch your own events from JavaScript by calling the function
                        <code>ORBEON.xforms.Document.dispatchEvent()</code>. The parameters to this function are:
                    </p>
                    <table>
                        <tr>
                            <th>targetId</th>
                            <td>Mandatory</td>
                            <td>
                                Id of the target element. The element must be an element in the XForms namespace: you
                                cannot dispatch events to HTML elements. In addition, the id must identify either a
                                relevant and non-readonly XForms control, or a model object that supports event handlers
                                such as <code>&lt;xforms:model></code>, <code>&lt;xforms:instance></code>, or
                                <code>&lt;xforms:submission></code>.
                            </td>
                        </tr>
                        <tr>
                            <th>eventName</th>
                            <td>Mandatory</td>
                            <td>
                                <p>
                                    Name of the event.
                                </p>
                                <warning>
                                    <p>
                                        For security reasons, by default Orbeon Forms prohibits client-side JavaScript
                                        from dispatching any external events except <code>DOMActivate</code>,
                                        <code>DOMFocusIn</code> and <code>DOMFocusOut</code>. Furthermore, these events
                                        can only be dispatched to relevant and non-readonly XForms controls. In order to
                                        enable dispatching of custom events, you must first add the
                                        <code>xxforms:external-events</code> attribute on the first
                                        <code>&lt;xforms:model></code> element, for example:
                                    </p>
                                    <xml-source show-namespaces="false">
                                        <xforms:model xxforms:external-events="acme-super-event acme-famous-event">
                                            ...
                                        </xforms:model>
                                    </xml-source>
                                    <p>
                                        This attribute contains a space-separated list of event name. In this example,
                                        you explicitly enable your JavaScript code to fire the two events
                                        <code>acme-super-event</code> and <code>acme-famous-event</code> to any relevant
                                        and non-readonly XForms controls, or to any model object supporting event
                                        handlers. Note that you can only enable custom events, but you cannot enable
                                        standard XForms or DOM events in addition to <code>DOMActivate</code>,
                                        <code>DOMFocusIn</code> and <code>DOMFocusOut</code>.
                                    </p>
                                    <p>
                                        Since the event handlers for custom events can be called by JavaScript code that
                                        runs on the client, you need to be aware that these handlers can potentially be
                                        activated by anybody able to load the form in his browser.
                                    </p>
                                </warning>
                            </td>
                        </tr>
                        <tr>
                            <th>form</th>
                            <td>Optional</td>
                            <td>
                                The form object that corresponds to the XForms form you want to dispatch the event to.
                                This argument is only needed when you have multiple "XForms forms" on the same HTML
                                page. Typically, this would only happens if you are running your form in a portal and
                                you have multiple portlets using XForms on the same page. When the parameter is not
                                present or <code>null</code>, the first form on the HTML page with the class
                                <code>xforms-form</code> is used.
                            </td>
                        </tr>
                        <tr>
                            <th>bubbles</th>
                            <td>Optional</td>
                            <td>
                                Optional boolean indicating if this event bubbles, as defined in <a
                                href="http://www.w3.org/TR/DOM-Level-2-Events/">DOM2 Events</a>. The default value depends
                                on the definition of the custom event.
                            </td>
                        </tr>
                        <tr>
                            <th>cancelable</th>
                            <td>Optional</td>
                            <td>
                                Optional boolean indicating if this event bubbles, as defined in <a
                                href="http://www.w3.org/TR/DOM-Level-2-Events/">DOM2 Events</a>. The default value depends
                                on the definition of the custom event.
                            </td>
                        </tr>
                        <tr>
                            <th>incremental</th>
                            <td>Optional</td>
                            <td>
                                When <code>false</code> the event is sent to the XForms server right away. When
                                <code>true</code> the event is sent after a small delay, giving the opportinuty for other
                                events that would occur during that timespan to be aggregated with the current event.
                            </td>
                        </tr>
                        <tr>
                            <th>ignoreErrors</th>
                            <td>Optional</td>
                            <td>
                                When set to <code>true</code>, errors happening while the event is dispatched to the
                                server are ignored. This is in particular useful when you are using a JavaScript timer
                                (e.g. <code>window.setInterval()</code>) that runs a JavaScript function on a regular
                                interval to dispatch an event to the server, maybe to have part of the UI updated. In
                                some cases, you might not want to alert the user when a there is a maybe temporary
                                communication error while the event is being dispatched to the server. In those cases,
                                you call call <code>dispatchEvent</code> with <code>ignoreErrors</code> set to true.
                            </td>
                        </tr>
                    </table>
                    <p>
                        In most cases, you only need to call <code>dispatchEvent()</code> with a target id and event name,
                        as in:
                    </p>
                    <source>ORBEON.xforms.Document.dispatchEvent("main-model", "do-something");</source>
                    <p>
                        An event handler for the custom event can be in an XForms model or control, and can execute any
                        valid XForms action. Here an action is explicatly declared to handle the
                        <code>do-something</code> even on the XForms model:
                    </p>
                    <xml-source show-namespaces="false">
                        <xforms:model id="main-model" xxforms:external-events="do-something">
                            <xforms:action ev:event="do-something">
                                <xforms:setvalue ref="first-name" value="instance('default-values')/first-name"/>
                                <xforms:toggle case="first-name-case"/>
                            </xforms:action>
                        </xforms:model>
                    </xml-source>
                </section>
            </section>
            <a name="avts"/>
            <section>
                <title>Attribute Value Templates</title>
                <p>
                    Certain attributes in XForms are literal values defined by the form author at the time the form is
                    written, as opposed to being evaluated at runtime. Examples include the <code>action</code>
                    attribute on <code>&lt;xforms:submission></code>, or the <code>resource</code> attribute on
                    <code>&lt;xforms:load></code>.
                </p>
                <p>
                    To improve this, Orbeon Form supports a notation called <i>Attribute Value Templates</i> (AVTs),
                    borrowed from <a href="http://www.w3.org/TR/xslt20/">XSLT</a>, which allows including XPath
                    expressions within attributes. You include XPath expressions in attributes by enclosing them within
                    curly brackets (<code>{</code> and <code>}</code>).
                </p>
                <a name="avts-xforms"/>
                <section>
                    <title>AVTs on XForms Elements</title>
                    <p>
                        Consider this example:
                    </p>
                    <xml-source>
                        <xforms:load resource="/forms/detail/{instance('documents-instance')/documents/document[index('documents-repeat')]/id}"/>
                    </xml-source>
                    <p>
                        When <code>&lt;xforms:load></code> is executed, the <code>resource</code> attribute is
                        evaluated. The results is the concatenation of <code>/forms/detail/</code> and of the result of
                        the expression within brackets:
                    </p>
                    <xml-source>
                        instance('documents-instance')/documents/document[index('documents-repeat')]/id
                    </xml-source>
                    <p>
                        If the <code>id</code> element pointed to contains the string
                        <code>C728595E0E43A8BF50D8DED9F196A582</code>, the <code>resource</code> attribute takes the
                        value:
                    </p>
                    <xml-source>
                        /forms/detail/C728595E0E43A8BF50D8DED9F196A582
                    </xml-source>
                    <p>
                        Note the following:
                    </p>
                    <ul>
                        <li>
                            <p>
                                If you need curly brackets as literal values instead of enclosing an XPath expression,
                                escape them using double brackets (<code>{{</code> and <code>}}</code>).
                            </p>
                        </li>
                        <li>
                            <p>
                                You can use as many XPath expressions as you want within a single attributes, each of
                                them enclosed by curly brackets.
                            </p>
                        </li>
                    </ul>
                    <p>
                        AVTs are currently supported only within certain attributes:
                    </p>
                    <ul>
                        <li>
                            <p>
                                <code>&lt;xforms:submission></code> attributes:
                            </p>
                            <ul>
                                <li>
                                    <code>action</code> and <code>resource</code>
                                </li>
                                <li>
                                    <code>xxforms:target</code>
                                </li>
                                <li>
                                    <code>xxforms:username</code>
                                </li>
                                <li>
                                    <code>xxforms:password</code>
                                </li>
                                <li>
                                    <code>xxforms:readonly</code>
                                </li>
                                <li>
                                    <code>xxforms:shared</code>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <p>
                                <code>&lt;xforms:dispatch></code> attributes:
                            </p>
                            <ul>
                                <li>
                                    <code>name</code>
                                </li>
                                <li>
                                    <code>target</code>
                                </li>
                                <li>
                                    <code>bubbles</code>
                                </li>
                                <li>
                                    <code>cancelable</code>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <p>
                                <code>&lt;xforms:load></code> attributes:
                            </p>
                            <ul>
                                <li>
                                    <code>resource</code>
                                </li>
                                <li>
                                    <code>replace</code>
                                </li>
                                <li>
                                    <code>xxforms:target</code>
                                </li>
                                <li>
                                    <code>xxforms:show-progress</code>
                                </li>
                                <li>
                                    <code>f:url-type</code>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <p>
                                <code>&lt;xforms:setfocus></code>: <code>control</code> attribute.
                            </p>
                        </li>
                        <li>
                            <p>
                                <code>&lt;xforms:toggle></code>: <code>case</code> attribute.
                            </p>
                        </li>
                        <li>
                            <p>
                                <code>&lt;xxforms:show></code> attributes:
                            </p>
                            <ul>
                                <li>
                                    <code>dialog</code>
                                </li>
                                <li>
                                    <code>neighbor</code>
                                </li>
                                <li>
                                    <code>constrain</code>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <p>
                                <code>&lt;xxforms:hide></code>: <code>dialog</code> attribute.
                            </p>
                        </li>
                    </ul>
                    <p>
                        There are plans to support AVTs in more places in the future. Please send your suggestions!
                    </p>
                </section>
                <a name="avts-xhtml"/>
                <section>
                    <title>AVTs on XHTML Elements</title>
                    <p>
                        AVTs are also supported on XHTML elements. You must first enable this feature in
                        <code>properties.xml</code>:
                    </p>
                    <xml-source>
                        <property as="xs:boolean" name="oxf.xforms.host-language-avts" value="true"/>
                    </xml-source>
                    <p>
                        For example:
                    </p>
                    <xml-source>
                        <xhtml:table class="zebra-table">
                            <xhtml:tbody>
                                <xforms:repeat nodeset="*">
                                    <xhtml:tr class="zebra-row-{if (position() mod 2 = 0) then 'even' else 'odd'}">
                                        <xhtml:td>
                                            <xforms:output value="."/>
                                        </xhtml:td>
                                    </xhtml:tr>
                                </xforms:repeat>
                            </xhtml:tbody>
                        </xhtml:table>
                    </xml-source>
                    <p>
                        In the above example, the value of the <code>class</code> attribute on
                        <code>&lt;xhtml:tr></code> is determined dynamically through XPath and XForms. Even table rows
                        get the class <code>zebra-row-even</code> and odd table rows get the class
                        <code>zebra-row-odd</code>.
                    </p>
                    <p>
                        The values of XHTML attributes built using AVTs update as you interact with the XForms page. In
                        the example above, inserting or deleting table rows after the page is loaded will still
                        correctly update the <code>class</code> attribute.
                    </p>
                    <note>
                        <p>
                            At the moment, AVTs are only supported on XHTML elements within
                            <code>&lt;xhtml:body></code>.
                        </p>
                        <p>
                            It is not possible to use AVTs on the <code>id</code> attribute of XHTML elements.
                        </p>
                    </note>
                </section>
            </section>
            <a name="variables"/>
            <section>
                <title>Variables</title>
                <p>
                    Orbeon Forms supports declaring variables which look and behave very much like XSLT variables.
                    Variables are extremely useful, for example to avoid repeating long XPath expressions, or to give an
                    XPath expression unambiguous access to data computed in enclosing <code>&lt;xforms:group></code> or
                    <code>&lt;xforms:repeat></code> elements.
                </p>
                <p>
                    You define variables with the extension element <code>&lt;xxforms:variable></code>. You can also use
                    <code>&lt;exforms:variable></code> in the eXforms namespace. Either element supports the
                    following attributes:
                </p>
                <table>
                    <tr>
                        <th><code>name</code></th>
                        <td>Mandatory</td>
                        <td>
                            Name of the variable.
                        </td>
                    </tr>
                    <tr>
                        <th><code>select</code></th>
                        <td>Mandatory</td>
                        <td>
                            XPath 2.0 expression determining the value of the variable.
                        </td>
                    </tr>
                </table>
                <p>
                    Once a variable is declared, you can use it from XPath expressions for which the variable is
                    visible:
                </p>
                <xml-source  xmlns:exforms="http://www.exforms.org/exf/1-0">
                    <xhtml:body>
                        <comment> Variable pointing to the default instance's root element </comment>
                        <xxforms:variable name="instance" select="."/>
                        <comment> variable pointing to all the item children (using the "exforms" prefix this time) </comment>
                        <comment> It uses the variable declared above </comment>
                        <exforms:variable name="items" select="$instance/item"/>

                        <comment> The code below uses the variables in scope </comment>
                        <xforms:repeat nodeset="$items" id="items-repeat">
                            <exforms:variable name="current-item" select="."/>
                            <xxforms:variable name="current-position" select="position()"/>
                            <xforms:output id="my-count" ref="$current-item/value">
                                <xforms:label value="concat($current-item/label, ':')"/>
                                <xforms:setvalue ev:event="my-event" ref="$current-item/value" value="count($items) + $current-position"/>
                            </xforms:output>
                        </xforms:repeat>
                    </xhtml:body>
                </xml-source>
                <p>
                    Under the <code>&lt;xhtml:body></code> element, the following rules apply:
                </p>
                <ul>
                    <li>
                        <p>
                            You can declare XPath variables anywhere an XForms control can be declared, as well as
                            within <code>&lt;xforms:action></code>.
                        </p>
                    </li>
                    <li>
                        <p>
                            A variable is visible to any XPath expression on a following sibling element or on a
                            following sibling element's descendant element.
                        </p>
                    </li>
                </ul>
                <p>
                    In addition, variables are supported within <code>&lt;xforms:model></code>, as well as within
                    <code>&lt;xforms:action></code> in a model. Under the <code>&lt;xforms:model></code> element, the
                    following rules apply:
                </p>
                <ul>
                    <li>
                        <p>
                            Variables have to be declared as direct children of an <code>&lt;xforms:model></code>
                            element.
                        </p>
                    </li>
                    <li>
                        <p>
                            Variables defined within a given model are also visible from XPath expression under the
                            <code>&lt;xhtml:body></code> element whenever that model is in scope:
                        </p>
                    </li>
                </ul>
                <xml-source  xmlns:exforms="http://www.exforms.org/exf/1-0">
                    <xhtml:head>
                        <xforms:model id="my-model">
                            <xforms:instance id="my-instance">...</xforms:instance>
                            <xxforms:variable name="my" select="."/>
                        </xforms:model>
                        <xforms:model id="her-model">
                            <xforms:instance id="her-instance">...</xforms:instance>
                            <xxforms:variable name="her" select="instance('her-instance')"/>
                        </xforms:model>
                    </xhtml:head>
                    <xhtml:body>
                        <comment> $my is visible from here, but not $her </comment>
                        <xforms:output value="$my">
                            <xforms:label>My stuff:</xforms:label>
                        </xforms:output>
                        <xforms:group model="her-model">
                            <comment> $her is visible from here, but not $my </comment>
                            <xforms:output value="$her">
                            <xforms:label>Her stuff:</xforms:label>
                        </xforms:output>
                        </xforms:group>
                    </xhtml:body>
                </xml-source>
                <p>
                    Currently you cannot declare variables in these locations:
                </p>
                <ul>
                    <li>
                        <p>
                            Within XForms core controls such as <code>&lt;xforms:input></code>, including within nested
                            items or itemsets (except within <code>&lt;xforms:action></code> elements, where they are
                            allowed).
                        </p>
                    </li>
                    <li>
                        <p>
                            Within nested model elements, including <code>&lt;xforms:bind></code> or
                            <code>&lt;xforms:submission></code> (except within <code>&lt;xforms:action></code>
                            elements, where they are allowed).
                        </p>
                    </li>
                </ul>
            </section>
            <a name="dialog"/>
            <section>
                <title>Dialogs</title>
                <a name="dialog-dialog"/>
                <section>
                    <title>The <code>xxforms:dialog</code> Control</title>
                    <p>
                        You declare dialogs directly under the <code>&lt;xhtml:body></code> element with:
                    </p>
                    <xml-source>
                        <xxforms:dialog id="my-dialog-id" appearance="full | minimal" level="modeless" close="true" draggable="true" visible="false">
                            <xforms:label>Dialog title</xforms:label>
                            Content of the dialog (XHTML + XForms)
                        </xxforms:dialog>
                    </xml-source>
                    <ul>
                        <li>
                            When you have <code>appearance="full"</code> on the dialog, you define the title of the
                            dialog with the embedded <code>&lt;xforms:label></code> element.
                        </li>
                        <li>
                            Inside an <code>&lt;xxforms:dialog></code> you can use all the XHTML and XForms elements you
                            can normally use elsewhere on the page. You can have other XForms controls, or show anything
                            you would like to with HTML.
                        </li>
                        <li>
                            The attributes on the <code>&lt;xxforms:dialog></code> are as follows:
                        </li>
                    </ul>
                    <table>
                        <tr>
                            <th><code>id</code></th>
                            <td>Mandatory</td>
                            <td>
                                The ID of the dialog. You reference this ID when opening the dialog with
                                <code>&lt;xxforms:show dialog="my-dialog-id"></code>.
                            </td>
                        </tr>
                        <tr>
                            <th>appearance</th>
                            <td>
                                Optional. Possible values are:
                                <ul>
                                    <li><code>full</code> (default)</li>
                                    <li><code>minimal</code></li>
                                </ul>
                            </td>
                            <td>
                                You can set the appearance to either <code>full</code> or <code>minimal</code>:
                                <ul>
                                    <li>
                                        The first screenshot below shows a dialog with <code>appearance="full"</code>
                                        while the second one shows a dialog with <code>appearance="minimal"</code>.
                                    </li>
                                    <li>
                                        In general, you will use the minimal dialog when you want to show a limited set
                                        of information which is related to a certain element in the page. The minimal
                                        dialog is sometime also referred to as a "drop-down dialog".
                                    </li>
                                    <li>
                                        Some of the other attributes on <code>&lt;xxforms:dialog></code> can only be
                                        used for the full or the minimal dialog. You will find more details on this
                                        below.
                                    </li>
                                </ul>

                                <img src="../apps/doc/images/reference-xforms-dialog-full.png"/>
                                <img src="../apps/doc/images/reference-xforms-dialog-minimal.png"/>
                            </td>
                        </tr>
                        <tr>
                            <th><code>level</code></th>
                            <td>
                                Optional. Can only be used appearance is set to <code>full</code>. Possible values are:
                                <ul>
                                    <li><code>modal</code> (default)</li>
                                    <li><code>modeless</code></li>
                                </ul>
                            </td>
                            <td>
                                When set to <code>modal</code> the rest the page is grayed out and you can't interact
                                with any ontrol on the page outside of the dialog. When set to <code>modeless</code> you
                                can still use other controls on the page.
                            </td>
                        </tr>
                        <tr>
                            <th><code>close</code></th>
                            <td>
                                Optional. Can only be used appearance is set to <code>full</code>. Possible values are:
                                <ul>
                                    <li><code>true</code> (default)</li>
                                    <li><code>false</code></li>
                                </ul>
                            </td>
                            <td>
                                A "x" is shown in the dialog title bar when <code>close</code> is set to
                                <code>true</code>. If you specify <code>close="false"</code>, then you should provide a
                                way to close the dialog, for instance by having you own "Close" button inside the
                                dialog. This is typically useful when you want to force users to enter some data before
                                proceeding and you don't want them to cancel the current operation by closing the
                                dialog.
                            </td>
                        </tr>
                        <tr>
                            <th><code>draggable</code></th>
                            <td>
                                Optional. Can only be used appearance is set to <code>full</code>. Possible values are:
                                <ul>
                                    <li><code>true</code> (default)</li>
                                    <li><code>false</code></li>
                                </ul>
                            </td>
                            <td>
                                When set to <code>false</code>, you won't be able to move dialog on the page by using
                                drag and drop in the dialog title bar.
                            </td>
                        </tr>
                        <tr>
                            <th><code>visible</code></th>
                            <td>
                                Optional. Whether the dialog is initially visible when the page loads. Possible values
                                are:
                                <ul>
                                    <li><code>true</code></li>
                                    <li><code>false</code> (default)</li>
                                </ul>
                            </td>
                            <td>
                                When set to <code>true</code>, the dialog appears immediately when the page loads.
                            </td>
                        </tr>
                        <tr>
                            <th><code>neighbor</code></th>
                            <td>Optional</td>
                            <td>
                                Optional. Use only with <code>minimal</code> appearance. The id of the control next to
                                which the dialog should display when opening.
                            </td>
                        </tr>
                    </table>
                </section>
                <a name="dialog-show-hide"/>
                <section added="2008-03-01">
                    <title>The <code>xxforms:show</code> and <code>xxforms:hide</code> Actions</title>
                    <p>
                        You open a dialog by using the <code>xxforms:show</code> action:
                    </p>
                    <xml-source>
                        <xforms:trigger>
                            <xforms:label>Show Dialog</xforms:label>
                            <xxforms:show ev:event="DOMActivate" dialog="hello-dialog"/>
                        </xforms:trigger>
                    </xml-source>
                    <p>
                        If the dialog is already open, no action takes place.
                    </p>
                    <p>
                        <code>xxforms:show</code> supports the following attributes:
                    </p>
                    <table>
                        <tr>
                            <th><code>dialog</code></th>
                            <td>Mandatory</td>
                            <td>
                                The id of an existing dialog to open.
                            </td>
                        </tr>
                        <tr>
                            <th><code>neighbor</code></th>
                            <td>Optional</td>
                            <td>
                                Optional. Use only with <code>minimal</code> appearance. The id of the control next to
                                which the dialog should display when opening.
                            </td>
                        </tr>
                        <tr>
                            <th><code>constrain</code></th>
                            <td>Optional</td>
                            <td>
                                Whether to constrain the dialog to the viewport. Possible values
                                are:
                                <ul>
                                    <li><code>true</code> (default)</li>
                                    <li><code>false</code></li>
                                </ul>
                            </td>
                        </tr>
                    </table>
                    <p>
                        You close a dialog by using the <code>xxforms:hide</code> action:
                    </p>
                    <xml-source>
                        <xforms:trigger>
                            <xforms:label>Hide Dialog</xforms:label>
                            <xxforms:hide ev:event="DOMActivate" dialog="hello-dialog"/>
                        </xforms:trigger>
                    </xml-source>
                    <p>
                        If the dialog is already closed, no action takes place.
                    </p>
                    <p>
                        <code>xxforms:hide</code> supports the following attributes:
                    </p>
                    <table>
                        <tr>
                            <th><code>dialog</code></th>
                            <td>Mandatory</td>
                            <td>
                                The id of an existing dialog to close.
                            </td>
                        </tr>
                    </table>
                </section>
                <a name="xxforms-dialog-open"/>
                <section added="2008-03-01">
                    <title>The <code>xxforms-dialog-open</code> Event</title>
                    <p>
                        Dispatched in response to: <code>xxforms:show</code> action executed with an existing dialog id.
                    </p>
                    <p>
                        Target: <code>dialog</code>
                    </p>
                    <p>
                        Bubbles: Yes
                    </p>
                    <p>
                        Cancelable: Yes
                    </p>
                    <p>
                        Context Info: none
                    </p>
                    <p>
                        Default Action: Open the dialog.
                    </p>
                    <p>
                        You can respond to this event before the dialog opens, for example to perform initialization of
                        data:
                    </p>
                    <xml-source>
                        <xxforms:dialog id="hello-dialog">
                            <xhtml:div>
                                Hello!
                            </xhtml:div>
                            <xxforms:setvalue ev:event="xxforms-dialog-open" ref="..." value="..."/>
                        </xxforms:dialog>
                    </xml-source>
                </section>
                <a name="xxforms-dialog-close"/>
                <section added="2008-03-01">
                    <title>The <code>xxforms-dialog-close</code> Event</title>
                    <p>
                        Dispatched in response to: <code>xxforms:hide</code> action executed with an existing dialog id.
                    </p>
                    <p>
                        Target: <code>dialog</code>
                    </p>
                    <p>
                        Bubbles: Yes
                    </p>
                    <p>
                        Cancelable: Yes
                    </p>
                    <p>
                        Context Info: none
                    </p>
                    <p>
                        Default Action: Close the dialog.
                    </p>
                </section>
            </section>
            <a name="submission-extensions"/>
            <section>
                <title>Submission Extensions</title>
                <a name="submission-auth-extension"/>
                <section>
                    <title>HTTP Authentication</title>
                    <p>
                        The <code>xforms:submission</code> element supports optional <code>xxforms:username</code> and
                        <code>xxforms:password</code> attributes that allow specifying HTTP authentication credentials.
                        You can specify either both attributes, or only the <code>xxforms:username</code> attribute. The
                        latter case is equivalent to setting the value of <code>xxforms:password</code> to an empty
                        string.
                    </p>
                    <xml-source show-namespaces="false">
                        <xforms:submission id="save-submission" ref="instance('my-instance')"
                                   method="put" resource="/exist/rest/ops/my-file.xml" replace="none" xxforms:username="admin" xxforms:password=""/>
                    </xml-source>
                </section>
                <a name="submission-show-progress"/>
                <section>
                    <title>Loading Indicator</title>
                    <p>
                        When an <code>xforms:submission</code> with <code>replace="all"</code> is executed, in general,
                        the browser will load another page. While this happens, the loading indicator, by default shown
                        in red at the top right of the window, is displayed. However, when the browser is served not a
                        web page but say a ZIP file, the browser might ask you in you want to download it, and then stay
                        in the current page. When this happens, the loading indicator does not go away.
                    </p>
                    <p>
                        In those cases where you know that the target page does not replace the current page, you can
                        prevent the loading indicator from being displayed by adding the
                        <code>xxforms:show-progress="false"</code> attribute:
                    </p>
                    <xml-source show-namespaces="false">
                        <xforms:submission xxforms:show-progress="false"/>
                    </xml-source>
                    <p>
                        Similarly the <code>xxforms:show-progress="false"</code> attribute can be used with the
                        <code>xforms:load</code> action:
                    </p>
                    <xml-source show-namespaces="false">
                        <xforms:load xxforms:show-progress="false"/>
                    </xml-source>
                </section>
                <a name="submission-target"/>
                <section>
                    <title>Target</title>
                    <p>
                        You can use the <code>xxforms:target</code> attribute on both <code>xforms:submission</code> and
                        <code>xforms:load</code>. It behaves just like the <a
                        href="http://www.w3.org/TR/html401/present/frames.html#adef-target">HTML target attribute</a>.
                        When used on <code>xforms:submission</code>, it makes sense to use this attribute only when you
                        have a <code>replace="all"</code>, as the <code>replace="instance"</code> doesn't load another
                        page.
                    </p>
                </section>
                <a name="submission-xxforms-instance"/>
                <section>
                    <title><code>xxforms:instance</code> Attribute</title>
                    <p>
                        On an <code>&lt;xforms:submission></code> element with <code>replace="instance"</code>, the
                        optional <code>instance</code> attribute specifies a destination instance for the result. That
                        attribute is processed like the <code>instance()</code> function, which means that the instance
                        specified must be in the current model.
                    </p>
                    <p>
                        The <code>xxforms:instance</code> extension attribute can be use instead of the standard
                        <code>instance</code> attribute. It works like <code>instance</code>, except that the instance
                        is searched globally among all models. <code>xxforms:instance</code> is to the
                        <code>instance</code> attribute what the <a
                        href="xxforms-instance"><code>xxforms:instance()</code></a> function is to the standard
                        <code>instance()</code> function.
                    </p>
                    <xml-source>
                        <xforms:submission id="my-submission" method="post" resource="http://example.org/"
                                           replace="instance" xxforms:instance="my-instance"/>
                    </xml-source>
                </section>
                <a name="submission-binary"/>
                <section>
                    <title>Submitting Binary Content</title>
                    <p>
                        XForms 1.1 does not explicitly support submitting binary content, but does not prohibit it
                        either. Orbeon Forms supports sending the content of a binary resource specified by a URI. Such
                        resources are easily obtained with <code>&lt;xforms:upload></code>, for example. To perform a
                        binary submission:
                    </p>
                    <ul>
                        <li>
                            <p>
                                The <code>post</code> or <code>put</code> method is required.
                            </p>
                        </li>
                        <li>
                            <p>
                                You must use a binary <code>serialization</code> attribute. This includes all
                                mediatypes which are not XML or text, including <code>application/octet-stream</code>,
                                <code>image/*</code>, etc.
                            </p>
                        </li>
                        <li>
                            <p>
                                The node referred to by the submission must be of type <code>xs:anyURI</code>.
                            </p>
                        </li>
                    </ul>
                    <xml-source>
                        <xforms:instance id="attachment">
                            <attachment>file:/Users/jdoe/Applications/apache-tomcat-5.5.20/temp/xforms_upload_30877.tmp</attachment>
                        </xforms:instance>
                        <xforms:bind nodeset="instance('attachment')" type="xs:anyURI"/>
                        ...
                        <xforms:submission id="save-submission"
                            ref="instance('attachment')"
                            method="put" serialization="application/octet-stream"
                            replace="none"
                            resource="http://example.com/foo.bin"/>
                        ...
                    </xml-source>
                    <p>
                        Alternatively, you can set the type information using the <code>xsi:type</code> attribute:
                    </p>
                    <xml-source>
                        <xforms:instance id="attachment">
                            <attachment xsi:type="xs:anyURI">file:/Users/jdoe/Applications/apache-tomcat-5.5.20/temp/xforms_upload_30877.tmp</attachment>
                        </xforms:instance>
                    </xml-source>
                </section>
            </section>
            <a name="other-extensions"/>
            <section>
                <title>Other Extensions</title>
                <a name="xxforms-script-extension"/>
                <section>
                    <title><code>&lt;xxforms:script></code> Action</title>
                    <p>
                        The <code>&lt;xxforms:script></code> action allows you to call client-side JavaScript as a
                        result of XForms events:
                    </p>
                    <xml-source show-namespaces="false">
                        <xforms:action ev:event="xforms-value-changed">
                            <xforms:setvalue ref=".">test</xforms:setvalue>
                            <xxforms:script>
                                var v = 2;
                                myValueChanged(v);
                            </xxforms:script>
                        </xforms:action>
                    </xml-source>
                    <p>
                        Scripts run with <code>&lt;xxforms:script></code> have access to the following JavaScript
                        variables:
                    </p>
                    <ul>
                        <li>
                            <p>
                                <b>this</b>. The element observing the event causing <code>&lt;xxforms:script></code>
                                to run.
                            </p>
                        </li>
                        <li>
                            <p>
                                <b>event</b>. Object containing a "target" propeterty. <code>event.target</code> returns
                                the element which is the target of the event causing <code>&lt;xxforms:script></code> to
                                run.
                            </p>
                        </li>
                    </ul>
                    <note>
                        <p>
                            <code>&lt;xxforms:script></code> actions are currently always executed <i>last</i> in a
                            sequence of XForms actions, even if they appear before other XForms actions.
                        </p>
                    </note>
                </section>
                <a name="xxforms-readonly"/>
                <section>
                    <title>Read-Only XForms Instances with <code>xxforms:readonly</code></title>
                    <p>
                        Orbeon Forms supports an extension attribute, <code>xxforms:readonly</code>, on the
                        <code>&lt;xforms:instance></code> and <code>&lt;xforms:submission></code> elements. When set to
                        <code>true</code>, this attribute signals that once loaded, the instance is read-only, with the
                        following consequences:
                    </p>
                    <ul>
                        <li>
                            <p>
                                The instance is loaded into a smaller, more efficient, read-only data structure in
                                memory.
                            </p>
                        </li>
                        <li>
                            <p>
                                Instance values <i>cannot</i> be updated, and no Model Item Properties (MIPs) can be
                                assigned with <code>&lt;xforms:bind></code> to the instance. But a read-only instance
                                can be replaced entirely by an <code>&lt;xforms:submission replace="instance"></code>
                            </p>
                        </li>
                        <li>
                            <p>
                                When using client-side state handling, less data may be transmitted between server and
                                client.
                            </p>
                        </li>
                    </ul>
                    <p>
                        Read-only instances are particularly appropriate for loading internationalization resources,
                        which can be large but don't change. Example:
                    </p>
                    <xml-source>
                        <xforms:instance id="resources-instance" src="/forms/resources/en" xxforms:readonly="true"/>
                    </xml-source>
                    <p>
                        The <code>xxforms:readonly</code> attribute on <code>&lt;xforms:instance></code> determines if
                        the instance is read-only until that instance is being replaced. After an instance is replaced,
                        it can be read-only or not irrelevant of the of <code>xxforms:readonly</code> on
                        <code>&lt;xforms:instance></code>. When the instance is replaced, the replaced instance is
                        read-only if and only if the <code>&lt;xforms:submission></code> that does the replacement has a
                        attribute <code>xxforms:readonly="true"</code>.
                    </p>
                </section>
                <a name="xxforms-shared"/>
                <section>
                    <title>Sharing of Read-Only XForms Instances with <code>xxforms:shared</code></title>
                    <p>
                        Orbeon Forms supports an extension attribute, <code>xxforms:shared</code>, on the
                        <code>&lt;xforms:instance></code> and <code>&lt;xforms:submission></code> elements. This
                        attribute can be used only when an XForms instance is marked as read-only with
                        <code>xxforms:readonly="true"</code>. <code>xxforms:shared</code> can take two values:
                        <code>document</code> (the default if the attribute is not specified) and
                        <code>application</code>. When <code>application</code> is specified:
                    </p>
                    <ul>
                        <li>
                            <p>
                                The instance can be shared at the application level identified just by its source URL.
                            </p>
                        </li>
                        <li>
                            <p>
                                The instance is not stored into the XForms document's state, but in a global cache,
                                therefore potentially saving memory. If, upon loading an XForms document, the instance
                                is found in the cache, it is directly retrieved from the cache. This can save time
                                especially if the URL can take significant time to load.
                            </p>
                        </li>
                        <li>
                            <p>
                                The URL must refer to a constant XML document and authorization credentials such as
                                username and password should not cause different data to be loaded.
                            </p>
                        </li>
                    </ul>
                    <p>
                        Here is how you use the attribute on <code>&lt;xforms:instance></code>:
                    </p>
                    <xml-source>
                        <xforms:instance id="resources-instance" src="/forms/resources/en" xxforms:readonly="true" xxforms:shared="application"/>
                    </xml-source>
                    <p>
                        When used on <code>&lt;xforms:submission></code>, the submission has to use
                        <code>method="get"</code> method and <code>replace="instance"</code>:
                    </p>
                    <xml-source>
                        <xforms:submission serialization="none" resource="/forms/resources/fr" method="get"
                                           replace="instance" instance="resources-instance" xxforms:readonly="true" xxforms:shared="application"/>
                    </xml-source>
                    <p>
                        You set the size of the shared instances cache using a property in <code>properties.xml</code>:
                    </p>
                    <xml-source>
                        <property as="xs:integer" name="oxf.xforms.cache.shared-instances.size"          value="10"/>
                    </xml-source>
                    <p>
                        You can force the XForms engine to remove a shared instance from the cache by dispatching the
                        <code>xxforms-instance-invalidate</code> event to it. The next time an XForms document requires
                        this instance, it will not be found in the cache and therefore reloaded. Example:
                    </p>
                    <xml-source>
                        <xforms:action ev:event="DOMActivate">
                            <xforms:send submission="save-submission"/>
                            <xforms:dispatch name="xxforms-instance-invalidate" target="data-to-save-instance"/>
                        </xforms:action>
                    </xml-source>
                    <p>
                        It is also possible to remove all shared instances from the cache by using the
                        <code>xxforms:invalidate-instances</code> action, for example:
                    </p>
                    <xml-source>
                        <xxforms:invalidate-instances ev:event="DOMActivate"/>
                    </xml-source>
                    <p>
                        When using <code>xxforms:readonly="true"</code>, another attribute, <code>xxforms:ttl</code>,
                        can be used to set a <i>time to live</i> for the instance in cache. This duration is expressed
                        in milliseconds and has to be greater than zero. When a shared instance if found in cache but
                        has an associated time to live, if it was put in the cache more than time to live milliseconds
                        in the past, then the instance is discarded from the cache and retrieved again by URI as if it
                        had not been found in cache at all. The following example expires the shared instance after one
                        hour:
                    </p>
                    <xml-source>
                        <xforms:instance id="resources-instance" src="/forms/resources/en" xxforms:readonly="true" xxforms:shared="application" xxforms:ttl="3600000"/>
                    </xml-source>
                    <warning>
                        When using <code>xxforms:shared="application"</code>, be sure that the data contained in the
                        instance does not contain information that could be inadvertently shared with other XForms
                        documents. It is recommended to use it to load localized resources or similar types of data.
                    </warning>
                </section>
                <a name="xxforms-refresh-items"/>
                <section>
                    <title>Controlling Item Sets Refreshes with <code>xxforms:refresh-items</code></title>
                    <p>
                        XForms specifies that items and itemsets are re-evaluated when processing
                        <code>xforms-refresh</code>. This may happen quite often, and may lead to time-consuming
                        re-evaluations especially when there are many or large itemsets.
                    </p>
                    <p>
                        Orbeon Forms supports an extension attribute, <code>xxforms:refresh-items</code>, on the
                        <code>&lt;xforms:select></code> and <code>&lt;xforms:select1></code> elements. When set to
                        <code>true</code> (the default), items and itemsets are re-computed upon
                        <code>xforms-refresh</code> event processing. When set to <code>false</code>, this attribute
                        signals that once computed, the set of items for the control will not be recomputed upon
                        <code>xforms-refresh</code> event processing.
                    </p>
                    <p>
                        If you know that itemsets do not change over time, setting <code>xxforms:refresh-items</code> to
                        <code>false</code> disables refreshing of the items during <code>xforms-refresh</code> and may
                        yield significant performance improvements. For example:
                    </p>
                    <xml-source>
                        <xforms:select1 ref="state" xxforms:refresh-items="false">
                            <xforms:label>State</xforms:label>
                            <xforms:item>
                                <xforms:label>[Select...]</xforms:label>
                                <xforms:value/>
                            </xforms:item>
                            <xforms:itemset nodeset="instance('schema-instance')/xs:simpleType[@name = 'state']//xs:enumeration">
                                <xforms:label ref="@value"/>
                                <xforms:value ref="@value"/>
                            </xforms:itemset>
                        </xforms:select1>
                    </xml-source>
                </section>
                <a name="internal-group"/>
                <section>
                    <title><code>xxforms:internal</code> Appearance on <code>&lt;xforms:group></code></title>
                    <p>
                        <code>&lt;xforms:group></code> supports the <code>xxforms:internal</code> appearance, which
                        causes the group to have no representation at all on the client:
                    </p>
                    <xml-source>
                        <xforms:group model="my-model" appearance="xxforms:internal">
                            <comment> More XForms controls </comment>
                        </xforms:group>
                    </xml-source>
                    <p>
                        In general you won't have a need for this appearance, but it is useful as an optimization, as it
                        leads to less HTML sent to the client. You may use it when a group is used only to change the
                        in-scope evaluation context for nested controls and when you don't need changes to relevance
                        which apply directly to the group to be reflected in the client.
                    </p>
                </section>
                <a name="tree"/>
                <section>
                    <title>Trees with the <code>xxforms:tree</code> Appearance</title>
                    <p>
                        [TODO: describe the Orbeon Forms <code>xxforms:tree</code> appearance on
                        <code>xforms:select</code> and <code>xforms:select1</code>]
                    </p>
                </section>
                <a name="menu"/>
                <section>
                    <title>Menus with the <code>xxforms:menu</code> Appearance</title>
                    <p>
                        [TODO: describe the Orbeon Forms <code>xxforms:tree</code> appearance on
                        <code>xforms:select1</code>]
                    </p>
                </section>
                <a name="autocomplete"/>
                <section>
                    <title>Autocomplete box <code>xxforms:tree</code> Appearance</title>
                    <p>
                        [TODO: describe the Orbeon Forms <code>xxforms:autocomplete</code> appearance on
                        <code>xforms:select</code> and <code>xforms:select1</code>]
                    </p>
                </section>
                <a name="events-multiple"/>
                <section>
                    <title>Multiple Event Names, Observers and Targets on Event Handlers</title>
                    <p>
                        The <code>ev:event</code>, <code>ev:observer</code> and <code>ev:target</code> attributes,
                        defined by the <a href="http://www.w3.org/TR/xml-events/">XML Events specification</a>, only
                        support one event name, observer, or target respectively. Orbeon Forms supports as an extension
                        a list of space-separated values. The behavior is as follows:
                    </p>
                    <ul>
                        <li>
                            <p>
                                For <code>ev:event</code>: the handler is called if any of the specified events matches.
                            </p>
                            <xml-source>
                                <xforms:action ev:event="DOMFocusIn DOMFocusOut">
                                    <comment> Reacting to either the "DOMFocusIn" and "DOMFocusOut" events </comment>
                                    ...
                                </xforms:action>
                            </xml-source>
                        </li>
                        <li>
                            <p>
                                For <code>ev:observer</code>: the event handler is attached to all the observers
                                specified.
                            </p>
                            <xml-source>
                                <xforms:action ev:event="DOMActivate" ev:observer="my-input my-trigger">
                                    <comment> Observing both the "my-input" and "my-trigger" controls </comment>
                                    ...
                                </xforms:action>
                            </xml-source>
                        </li>
                        <li>
                            <p>
                                For <code>ev:target</code>: the handler is called if any of the specified targets
                                matches.
                            </p>
                            <xml-source>
                                <xforms:action ev:event="xforms-submit-done" ev:target="create-submission update-submission">
                                    <comment> Checking that either the "create-submission" and "update-submission" controls is a target </comment>
                                    ...
                                </xforms:action>
                            </xml-source>
                        </li>
                    </ul>
                    <p>
                        This feature has been <a
                        href="http://lists.w3.org/Archives/Public/www-html-editor/2008JanMar/0012.html">requested</a>
                        for inclusion in XML Events 2.
                    </p>
                </section>
                <a name="modal-trigger"/>
                <section>
                    <title>Modal Trigger Behavior</title>
                    <p>
                        Usually, activating a trigger on the client doesn't prevent further actions in the user
                        interface. Sometimes, it is however useful to block such further actions until some processing
                        is complete, for example calling a submission that saves a document.
                    </p>
                    <p>
                        You can obtain this behavior by using the <code>xforms-trigger-appearance-modal</code> class on
                        <code>&lt;xforms:trigger></code>:
                    </p>
                    <xml-source>
                        <xforms:trigger class="xforms-trigger-appearance-modal">
                            <xforms:label>Save</xforms:label>
                            <xforms:send ev:event="DOMActivate" submission="save-submission"/>
                        </xforms:trigger>
                    </xml-source>
                    <p>
                        With this class, user input is blocked until all the events triggered by
                        <code>DOMActivate</code> are processed. In the meanwhile, the page is grayed out and an icon
                        appears indicating that background processing is taking place.
                    </p>
                </section>
            </section>
        </section>
        <a name="configuration"/>
        <section>
            <title>Configuration</title>
            <a name="xforms-state-handling"/>
            <section>
                <title>State Handling</title>
                <a name="state-handling-rationale"/>
                <section>
                    <title>Rationale</title>
                    <p>
                        The Orbeon Forms XForms engine requires keeping processing state while operating on an XForms page.
                        Such state includes the current values of XForms instances, selected repeated elements, and more.
                        With Orbeon Forms, XForms state information can be handled in one of two ways:
                    </p>
                    <ul>
                        <li>
                            <p>
                                <b>Server-side:</b> in this case, state information is stored on the server. Only very
                                little state information circulates between client and server. The most frequently used
                                state information is stored in memory. Less frequently used state information is stored
                                on disk in a local database.
                            </p>
                            <p>
                                Benefits of the approach:
                            </p>
                            <ul>
                                <li>
                                    <p>
                                        Resulting HTML page are smaller. HTML pages increase in size as more XForms
                                        controls are used, but they don't increase in size proportionally to the size of
                                        XForms instances.
                                    </p>
                                </li>
                                <li>
                                    <p>
                                        Small amounts of data circulate between the client browser and the Orbeon Forms
                                        XForms server.
                                    </p>
                                </li>
                                <li>
                                    <p>
                                        This means that very large XForms instances can be processed without any impact
                                        on the amount of data that is transmitted between the client and the server.
                                    </p>
                                </li>
                            </ul>
                            <p>
                                Drawbacks of the approach:
                            </p>
                            <ul>
                                <li>
                                    <p>
                                        The Orbeon Forms XForms server needs to be stateful. It uses server memory to
                                        store state information even when no request is being processed. This creates
                                        additional demand for resources on the server and slightly complicates the task
                                        of tuning the server.
                                    </p>
                                </li>
                                <li>
                                    <p>
                                        State information can become unavailable when sessions expire or when the server
                                        is restarted. When state information becomes unavailable for a page, that page
                                        will no longer function unless it is reloaded.
                                    </p>
                                </li>
                            </ul>
                            <note>
                                Orbeon Forms ensures that it is possible to open multiple client browser windows
                                showing the same page within the same session.
                            </note>
                        </li>
                        <li>
                            <p>
                                <b>Client-side:</b> in this case, static initial state information is sent along with the
                                initial HTML page, and dynamic state is exchanged over the wire between the client browser
                                and the Orbeon Forms XForms server when necessary.
                            </p>
                            <p>
                                Benefits of the approach:
                            </p>
                            <ul>
                                <li>
                                    <p>
                                        The Orbeon Forms server is entirely stateless. It only requires memory while
                                        processing a client request. It can be restarted without consequence for the XForms
                                        engine.
                                    </p>
                                </li>
                                <li>
                                    <p>
                                        State information does not expire as long as the user keeps the
                                        application page open in the web browser.
                                    </p>
                                </li>
                            </ul>
                            <p>
                                Drawbacks of the approach:
                            </p>
                            <ul>
                                <li>
                                    <p>
                                        Resulting HTML pages are larger. In particular, the size of state data grows
                                        when XForms instances grow, regardless of whether many XForms controls are
                                        bound to instance data.
                                    </p>
                                </li>
                                <li>
                                    <p>
                                        More data circulates between the client browser and the Orbeon Forms XForms server.
                                    </p>
                                </li>
                            </ul>
                            <note>
                                Orbeon Forms compresses and encrypts XForms state information sent to the client.
                            </note>
                        </li>
                    </ul>
                    <p>
                        By default, Orbeon forms store XForms state information on the server. Please change this
                        default to client-side only if you have well understood the tradeoffs explained above.
                    </p>
                </section>
                <a name="state-handling-configuration"/>
                <section>
                    <title>Configuring State Handling</title>
                    <p>
                        State handling can be configured globally for all pages, or locally for each individual page
                        served. Global configuration is performed in <code>properties.xml</code> with the
                        <code>oxf.xforms.state-handling</code> property. When missing or set to <code>client</code>,
                        state is stored client-side. When set to <code>server</code>, state is stored server-side. For
                        example:
                    </p>
                    <xml-source>
                        <comment> Store state on the server </comment>
                        <property as="xs:string" name="oxf.xforms.state-handling" value="server"/>
                    </xml-source>
                    <p>
                        The global configuration can be overridden for each page by setting the
                        <code>xxforms:state-handling</code> attribute in the page. This attribute can be set  on the
                        root element of the XHTML page, or on the first <code>xforms:model</code> element. Only the
                        first such attribute encountered by the XForms engine is used:
                    </p>
                    <xml-source show-namespaces="false">
                        <xforms:model xxforms:state-handling="client">
                            ...
                        </xforms:model>
                    </xml-source>
                    <p>
                        When storing state on the server, the maximum size of the data to be stored globally in memory
                        can be selected using the <code>oxf.xforms.store.application.size</code> property. The size is
                        specified in bytes:
                    </p>
                    <xml-source>
                        <comment> Allow a maximum of 20 MB of state information among all users </comment>
                        <property as="xs:integer" name="oxf.xforms.store.application.size"               value="20000000"/>
                    </xml-source>
                    <p>
                        When the allowed memory space for state information is full, Orbeon passivates state information
                        to a local eXist database. Configuration parameters for the connection to the eXist database
                        can be changed. The defaults are as follows:
                    </p>
                    <xml-source>
                        <comment> Disk-based store connection information </comment>
                        <property as="xs:string"  name="oxf.xforms.store.application.username"           value="guest"/>
                        <property as="xs:string"  name="oxf.xforms.store.application.password"           value="guest"/>
                        <property as="xs:anyURI"  name="oxf.xforms.store.application.uri"                value="xmldb:exist:///"/>
                        <property as="xs:string"  name="oxf.xforms.store.application.collection"         value="/db/orbeon/xforms/cache/"/>
                    </xml-source>
                    <p>
                        Whether state information is kept client-side or server-side, a property controls whether the XForms
                        engine should try to optimize state reconstruction by using a cache. This property should usually
                        be set to <code>true</code>:
                    </p>
                    <xml-source>
                        <comment> This should usually be set to "true" </comment>
                        <property as="xs:boolean" name="oxf.xforms.cache.document"                       value="true"/>
                    </xml-source>
                    <p>
                        If the above property is set to <code>true</code>, the number of XForms documents that can be
                        held in that document cache at a given time is configured with the following property:
                    </p>
                    <xml-source>
                        <comment> Store at most 10 documents in the cache </comment>
                        <property as="xs:integer" name="oxf.xforms.cache.documents.size"                 value="10"/>
                    </xml-source>
                    <p>
                        Note that this represents XForms documents in a particular state of interaction with a user,
                        which means that if to users load the same XForms page two entries will be needed in the cache.
                    </p>
                </section>
                <a name="session-heartbeat"/>
                <section added="2008-03-01">
                    <title>Session Heartbeat</title>
                    <p>
                        If you happen to leave a browser window open on your computer, chances are that you will get
                        back to that window and keep using the application. The last thing you want to happen when you
                        come back is lose your session and therefore your data.
                    </p>
                    <p>
                        This is not always a correct guess of course: you may just happen to leave a window or tab open
                        without planning to use it again. Conversely you may have a page which is not actually visible,
                        for example in your browser history, yet you will come back to it. This approach wouldnt be
                        good for banking applications either. Still, in many situations, such as filling-out large
                        forms, it sounds like a good idea to keep your session alive for open pages.
                    </p>
                    <p>
                        To achieve this goal you could make all server sessions longer. However this is harder to
                        configure for the application developer, and this wont discriminate between pages that are
                        actually open on a client and the ones that are not. And while it may be ideal to have
                        infinitely long sessions, unfortunately many applications are not ready for this kind of
                        approach.
                    </p>
                    <p>
                        So Orbeon Forms supports a "session heartbeat" feature. Here is how this works:
                    </p>
                    <ul>
                        <li>
                            <p>
                                When this feature is enabled (the default), an open XForms page in a client browser
                                regularly pings the server through Ajax to keep the current server session alive.
                            </p>
                        </li>
                        <li>
                            <p>
                                The ping delay is automatically computed based on the servers session timeout. The
                                client pings the server at 80% of the session expiration time after the last interaction
                                with the server.
                            </p>
                        </li>
                        <li>
                            <p>
                                We are careful not to hit the XForms engine too much, in fact we do a very limited
                                amount of work on the server for each ping, so they should run fast.
                            </p>
                        </li>
                        <li>
                            <p>
                                XForms state information for pages hit with the heartbeat just migrates to the <a
                                href="#state-handling-configuration">disk store</a> over time if RAM is used by other
                                pages, so keeping even large numbers of pages open should not have any negative impact
                                on server RAM.
                            </p>
                        </li>
                        <li>
                            <p>
                                When a user gets back to using the page, state information migrates back from disk to
                                RAM, and the page will be live again.
                            </p>
                        </li>
                        <li>
                            <p>
                                Sessions do eventually expire as nobody keeps a browser open forever.
                            </p>
                        </li>
                    </ul>
                    <p>
                        Note that whenever an application keeps sessions alive for a long time, it is a good idea to
                        keep as little data as possible in the session. The Orbeon Forms XForms engine itself uses a <a
                        href="#state-handling-configuration">global state store</a> and does not use session objects
                        for storage, but do remember to keep your sessions small!
                    </p>
                    <p>
                        The session heartbeat should help prevent many occurrences of "session expired" error messages.
                        As an Orbeon Forms application developer you dont have to worry about anything: the session
                        heartbeat is enabled by default. You can configure it globally in <code>properties.xml</code>:
                    </p>
                    <xml-source>
                        <property as="xs:boolean" name="oxf.xforms.session-heartbeat" value="true"/>
                    </xml-source>
                    <p>
                        You can also override the global default by specifying a property on the first XForms model of a
                        page:
                    </p>
                    <xml-source>
                        <xforms:model id="my-model" xxforms:session-heartbeat="false"/>
                    </xml-source>
                </section>
            </section>
            <a name="xforms-resources"/>
            <section>
                <title>JavaScript and CSS Resources</title>
                <a name="xforms-minimal-resources"/>
                <section>
                    <title>Minimal Resources</title>
                    <p>
                        Most JavaScript and CSS files used by the XForms engine are available in two versions:
                    </p>
                    <ul>
                        <li>
                            <p>A full version, which may contain comments, spaces, longer identifiers, etc.</p>
                        </li>
                        <li>
                            <p>A minimal version, which is usually much smaller</p>
                        </li>
                    </ul>
                    <p>
                        Both versions work exactly the same. For development and debugging of the XForms engine itself, the full
                        version is easier to work with. But if you never work directly with these JavaScript and CSS files, as
                        well as for deployment, the minimal versions are recommended as they will load faster in the user's web
                        browser. You enable minimal resources in <code>properties.xml</code> as follows:
                    </p>
                    <xml-source>
                        <comment> Enable minimal resources </comment>
                        <property as="xs:boolean" name="oxf.xforms.minimal-resources" value="true"/>
                    </xml-source>
                </section>
                <a name="xforms-combined-resources"/>
                <section>
                    <title>Combined Resources</title>
                    <p>
                        Serving CSS and JavaScript can have a high performance cost on page loads. This is particularly
                        important with the intensive use of JavaScript in Orbeon Forms. In particular, it can be shown that
                        serving many small files is slower than serving a single large file. In theory, HTTP pipelining can
                        improve very much on this, but this is (very unfortunately) useless in practice at the time of writing
                        because Internet Explorer doesn't implement it at all and Firefox / Mozilla do implemente it but do not
                        enable it by default. This is why Orbeon Forms supports the option of combining the multiple JavaScript
                        and CSS files required for a given XForms page into a single JavaScript file and a single CSS file.
                    </p>
                    <p>
                        You enable this feature in <code>properties.xml</code> as follows
                    </p>
                    <xml-source>
                        <comment> Enable combined resources </comment>
                        <property as="xs:boolean" name="oxf.xforms.combined-resources" value="true"/>
                    </xml-source>
                    <p>
                        When this is enabled, Orbeon Forms refers to a single JavaScript file and a single CSS file for
                        XForms-related functionality. The URL identifies special resources needed by the page, for example:
                    </p>
                    <xml-source>
                        <link rel="stylesheet" href="/ops/xforms-server/xforms-range-autocomplete-min.css" type="text/css"/>
                        <script type="text/javascript" src="/ops/xforms-server/xforms-range-autocomplete-min.js"/>
                    </xml-source>
                    <p>
                        This in short tells the XForms server to produce the minimal CSS and JavaScript for the XForms engine
                        including support for the "range" and "autocomplete" features. Note that you don't have to write these
                        URLs yourself: the Orbeon Forms XForms engine adds them automatically to your page.
                    </p>
                    <p>
                        When the Orbeon Forms XForms server receives a request for a combined resource, it determine what files
                        need to be combined and outputs them all together. Furthmore, for CSS files, all URLs referred to with
                        <code>url()</code> are rewritten, so that links to images, in particular, remain correct.
                    </p>
                    <p>
                        In addition, you can enable caching of combined resources with:
                    </p>
                    <xml-source>
                        <comment> Enable caching of combined resources </comment>
                        <property as="xs:boolean" name="oxf.xforms.cache-combined-resources" value="true"/>
                    </xml-source>
                    <p>
                        This cache works differently from other Orbeon Forms caches, as the result is stored in the resources,
                        typically under:
                    </p>
                    <xml-source>
                        WEB-INF/resources/xforms-server/
                    </xml-source>
                    <p>
                        One benefit of this mechanism is that it allows making such combined files to be served by an Apache
                        front-end.
                    </p>
                </section>
                <a name="versioned-resources"/>
                <section added="2008-03-01">
                    <title>Versioned Resources</title>
                    <p>
                        To further improve caching efficiency, Orbeon Forms supports enabling <i>versioned
                        resources</i>. Usually, a resource such as a CSS, JavaScript or image file, is served through
                        URLs like this one:
                    </p>
                    <xml-source>
                        http://localhost:8080/orbeon/xforms-server/xforms-dialog-min.js
                    </xml-source>
                    <p>
                        When configuring caching on the server, for example by using an Apache front-end, you may face
                        a dilemma:
                    </p>
                    <ul>
                        <li>
                            <p>
                                Caching aggressively (with an expiration date far in the future and no revalidation) so
                                that the client asks for the resource as rarely as possible. Doing so may cause
                                resources on the client to be out of date.
                            </p>
                        </li>
                        <li>
                            <p>
                                Caching for a shorter period of time or by forcing revalidation so that your client
                                always has a fresh version of the resources. Doing so may cause longer page loads and
                                more load on the server.
                            </p>
                        </li>
                    </ul>
                    <p>
                        Orbeon Forms solves this by providing the option of using versioned resources, that is inserting
                        automatically a version number within resource URLs. You enable versioned resources in
                        <code>properties.xml</code>:
                    </p>
                    <xml-source>
                        <property as="xs:boolean" name="oxf.resources.versioned" value="true"/>
                    </xml-source>
                    <p>
                        With this, the resource above is served as follows:
                    </p>
                    <xml-source>
                        http://localhost:8080/orbeon/xforms-server/3.6.0.200803010236/xforms-dialog-min.js
                    </xml-source>
                    <p>
                        The XForms Server component, which serves the resource in this case, sets an expiration date far
                        in the future. For example, this is the description of the cache entry in the Firefox
                        <code>about:cache</code> page:
                    </p>
                    <pre class="ops-doc-code">
          Key: http://localhost:8080/orbeon/xforms-server/3.6.0.200803010236/xforms-dialog-min.css
    Data size: 22524 bytes
  Fetch count: 2
Last modified: 2008-03-01 17:04:25
      Expires: 2011-12-25 17:10:42</pre>
                    <p>
                        This means that the resource can effectively be cached "for ever" by a client. In case the
                        client visits Orbeon Forms pages often, the resources will be availabe from cache, therefore
                        reducing page loading times and server load as well.
                    </p>
                    <p>
                        When Orbeon Forms is upgraded on the server, the version number changes as well. An XForms page
                        will refer to resources with the new version number, so the cached resource is not used by the
                        browser and a new resource is loaded from the server, before being cached. This "magic" is
                        enabled simply with the inclusion of the Orbeon Forms version number in the URL.
                    </p>
                    <p>
                        Only CSS and JavaScript resources used by the XForms engine are loaded through the XForms
                        Server component. Other resources like images referred by XForms stylesheets are served by the
                        Page Flow Controller, through URLs like this one:
                    </p>
                    <xml-source>
                        http://localhost:8080/orbeon/ops/images/xforms/error.gif
                    </xml-source>
                    <p>
                        With resource versioning enabled, the URL becomes:
                    </p>
                    <xml-source>
                        http://localhost:8080/orbeon/3.6.0.200803010236/ops/images/xforms/error.gif
                    </xml-source>
                    <p>
                        When resource versioning is enabled, the Page Flow Controller by default serves all the
                        resources defined in <code>&lt;files></code> elements by first checking the
                        <code>oxf.resources.versioned</code> property. If versioning is enabled, the PFC removes the
                        version number from the URL before searching for the resource on disk. It is possible to turn
                        this behavior on and off selectively with the <code>versioned</code> attribute. Here is how to
                        turn off versioning for PDF files in <code>page-flow.xml</code>:
                    </p>
                    <xml-source>
                        <config xmlns="http://www.orbeon.com/oxf/controller" xmlns:oxf="http://www.orbeon.com/oxf/processors">
                            <comment xmlns=""> GIF images are loaded following oxf.resources.versioned </comment>
                            <files path-info="*.gif"/>
                            <comment xmlns=""> More file definitions here </comment>
                            ...
                            <comment xmlns=""> PDF files are not versioned </comment>
                            <files path-info="*.pdf" versioned="false"/>
                            <comment xmlns=""> More file definitions here </comment>
                            ...
                            <comment xmlns=""> More page definitions here </comment>
                            ...
                        </config>
                    </xml-source>
                    <p>
                        Conversely, resource URLs produced by an XForms page are automatically rewritten following the
                        Page Flow's <code>&lt;files></code> definitions.
                    </p>
                    <p>
                        The versioning mechanism is made available to your own application resources as well. Any
                        resource whose path doesn't start with <code>/ops/</code> or <code>/config/</code> is considered
                        part of your application, not of Orbeon Forms. In that case, the Orbeon Forms version number is
                        not used, but you specify instead an application version number in <code>properties.xml</code>:
                    </p>
                    <xml-source>
                        <property as="xs:string"  name="oxf.resources.version-number" value="1.6.3"/>
                    </xml-source>
                    <p>
                        Note that if this property is commented out or missing, no versioning takes place for your
                        application resources even if <code>oxf.resources.versioned</code> is set to <code>true</code>.
                    </p>
                    <p>
                        For deployed application, you should upgrade the application version number whenever you modify
                        application resources so that clients retrieve the proper resources.
                    </p>
                    <p>
                        The following scenario shows the entire lifecycle for application resources:
                    </p>
                    <ul>
                        <li>
                            <p>
                                You an image as <code>RESOURCES/apps/foo/bar.png</code>
                            </p>
                        </li>
                        <li>
                            <p>
                                You refer to it as:
                            </p>
                            <xml-source>
                                <xhtml:body>
                                    <xhtml:img src="/apps/foo/bar.png" alt="My Image"/>
                                </xhtml:body>
                            </xml-source>
                        </li>
                        <li>
                            <p>
                                With versioning enabled, the image path is rewritten automatically as follows:
                            </p>
                            <xml-source>
                                /1.6.3/apps/foo/bar.png
                            </xml-source>
                            <p>
                                Note that the application resource number is used because the resource is not part of
                                Orbeon Forms.
                            </p>
                        </li>
                        <li>
                            <p>
                                Your browser sees a URL like:
                            </p>
                            <xml-source>
                                http://localhost:8080/orbeon/1.6.3/apps/foo/bar.png
                            </xml-source>
                        </li>
                        <li>
                            <p>
                                When the browser loads the image, the PFC receives back:
                            </p>
                            <xml-source>
                                /1.6.3/apps/foo/bar.png
                            </xml-source>
                        </li>
                        <li>
                            <p>
                                The PFC knows that PNG files are versioned, so removes the version number and sends
                                this resource to the browser:
                            </p>
                            <xml-source>
                                RESOURCES/apps/foo/bar.png
                            </xml-source>
                        </li>
                    </ul>
                    <p>
                        From client-side JavaScript, you can access the application version number as follow:
                    </p>
                    <xml-source>
                        var version = ORBEON.util.Utils.getProperty(APPLICATION_RESOURCES_VERSION_PROPERTY);
                    </xml-source>
                    <p>
                       At the moment, the resources served by the PFC (that is all the resources except the XForms
                       engine's CSS and JavaScript resources) do not automatically get a special expiration date. If
                       you want to fully leverage client-side caching capabilities, you may want to use an Apache
                       front-end or a Servlet filter to modify the Expires header of those resources. With Apache, you
                       can use <a href="http://httpd.apache.org/docs/2.2/mod/mod_expires.html">mod_expires</a>.
                    </p>
                    <p>
                        In case you use Apache, you can in addition configure a rewriting rule with <a
                        href="http://httpd.apache.org/docs/2.2/mod/mod_rewrite.html">mod_rewrite</a> to allow Apache to
                        directly load resources containing a version number, as <a href="#apache">shown below</a>.
                    </p>
                    <note>
                        <p>
                            We recommend restarting Orbeon Forms after changing the <code>oxf.resources.versioned</code>
                            property, as data in Orbeon Forms caches may not be made aware of the change until the next
                            restart.
                        </p>
                    </note>
                </section>
                <a name="apache"/>
                <section added="2008-03-01">
                    <title>Examples of Apache Configurations</title>
                    <p>
                        Here is how you can configure Apache to serve Orbeon Forms resources. This assumes the
                        following:
                    </p>
                    <ul>
                        <li>
                            <p>
                                Orbeon Forms deployed under the <code>/orbeon</code> context
                            </p>
                        </li>
                        <li>
                            <p>
                                Orbeon Forms exploded WAR file under <code>/home/orbeon/war/</code>
                            </p>
                        </li>
                        <li>
                            <p>
                                <code>orbeon-resources-public.jar</code> unziped under <code>/home/orbeon/war/WEB-INF/orbeon-resources-public/</code>
                            </p>
                        </li>
                        <li>
                            <p>
                                <code>oxf.xforms.cache-combined-resources</code> set to <code>true</code> in <code>properties.xml</code>
                            </p>
                        </li>
                    </ul>
                    <p>
                        Without <a href="#versioned-resources">resources versioning</a>:
                    </p>
                    <pre class="ops-doc-code">
RewriteEngine on
# Rewrite CSS and JavaScript resources served by the XForms Server
# -> make sure "oxf.xforms.cache-combined-resources" is set to "true" in properties.xml
RewriteRule ^/orbeon/(xforms-server/.*\.(css|js))$ /home/orbeon/war/WEB-INF/resources/$1 [L]
# Serve /config/theme resources
# -> make sure orbeon-resources-public.jar is unzipped under "orbeon-resources-public"
RewriteRule ^/orbeon/(config/theme/.*\.(css|png|gif))$ /home/orbeon/war/WEB-INF/orbeon-resources-public/$1 [L]
# Serve /ops resources
# -> make sure orbeon-resources-public.jar is unzipped under "orbeon-resources-public"
RewriteRule ^/orbeon/(ops/.*\.(css|js|gif|png|jpg|html|htc))$ /home/orbeon/war/WEB-INF/orbeon-resources-public/$1 [L]
# Serve remaining resources
RewriteRule ^/orbeon/(.*\.(css|js|gif|png|jpg|html|htc))$ /home/orbeon/war/WEB-INF/resources/$1 [L]</pre>
                    <p>
                        With <a href="#versioned-resources">resources versioning</a>:
                    </p>
                    <pre class="ops-doc-code">
RewriteEngine on
# Rewrite CSS and JavaScript resources served by the XForms Server
# -> make sure "oxf.xforms.cache-combined-resources" is set to "true" in properties.xml
RewriteRule ^/orbeon/xforms-server/[^/]+/(.*\.(css|js))$ /home/orbeon/war/WEB-INF/resources/xforms-server/$1 [L]
# Serve /config/theme resources
# -> make sure orbeon-resources-public.jar is unzipped under "orbeon-resources-public"
RewriteRule ^/orbeon/[^/]+/(config/theme/.*\.(css|png|gif))$ /home/orbeon/war/WEB-INF/orbeon-resources-public/$1 [L]
# Serve /ops resources
# -> make sure orbeon-resources-public.jar is unzipped under "orbeon-resources-public"
RewriteRule ^/orbeon/[^/]+/(ops/.*\.(css|js|gif|png|jpg|html|htc))$ /home/orbeon/war/WEB-INF/orbeon-resources-public/$1 [L]
# Serve remaining resources
RewriteRule ^/orbeon/[^/]+/(.*\.(css|js|gif|png|jpg|html|htc))$ /home/orbeon/war/WEB-INF/resources/$1 [L]</pre>
                </section>
            </section>
            <a name="xforms-back-forward"/>
            <section>
                <title>Browser Navigation (Back and Forward) Handling</title>
                <p>
                    When visiting an XForms page by using your browser's Back and Forward buttons, or other
                    browser-history mechanisms, Orbeon Forms by default restores the appearance of that page as it was
                    when you left it. (Browsers don't automatically handle this behavior with Ajax applications!) This
                    behavior best matches the usual user experience obtained when navigating regular web pages.
                </p>
                <p>
                    In certain situations, it can be useful instead to ask the XForms page to reload entirely. You
                    control this by using the <code>xxforms:revisit-handling</code> attribute on the first XForms model
                    of the page you want to reload. This attribute supports two values: <code>restore</code> (the
                    default) and <code>reload</code>. Example:
                </p>
                <xml-source>
                    <xforms:model xxforms:revisit-handling="reload"/>
                </xml-source>
                <note>
                    It is recommended to use the <code>reload</code> value carefully, as reloading pages upon browser
                    navigation often does not match the expectation of the user.
                </note>
            </section>
            <a name="xforms-debugging"/>
            <section>
                <title>Debugging XForms Pages</title>
                <a name="xforms-logging"/>
                <section added="2006-10-21">
                    <title>Enabling XForms Logging</title>
                    <p>
                        When a fatal error occurs, the XForms engine throws a Java exception which either results in an error
                        page in your web browser (when the error occurrs during page initialization) or in an error message at
                        the top of the displayed XForms page (when the error occurs during an Ajax request after the page is
                        loaded). The main Java exception is also logged on the server.
                    </p>
                    <p>
                        Sometimes, this provides enough information to the developer to figure out what went wrong. But
                        often this is not sufficient. The best tool available is the XForms engine logging facility. To
                        enable it, make sure you uncomment the following lines in <code>config/log4j.xml</code>:
                    </p>
                    <xml-source>
                        <category name="org.orbeon.oxf.xforms.processor.XFormsServer">
                            <priority value="debug"/>
                        </category>
                        <category name="org.orbeon.oxf.xforms.processor.XFormsModelSubmission">
                            <priority value="debug"/>
                        </category>
                    </xml-source>
                    <note>
                        <p>
                            You must restart your Servlet container for those changes to be taken into account.
                        </p>
                    </note>
                    <p>
                        These settings enable verbose logging of the XForms engine's operations, in particular:
                    </p>
                    <ul>
                        <li>
                            <p>
                                Dispatching of events.
                            </p>
                        </li>
                        <li>
                            <p>
                                Execution of actions.
                            </p>
                        </li>
                        <li>
                            <p>
                                Loading of instances.
                            </p>
                        </li>
                        <li>
                            <p>
                                Execution of submissions.
                            </p>
                        </li>
                        <li>
                            <p>
                                Resulting XForms instances.
                            </p>
                        </li>
                        <li>
                            <p>
                                XForms cache-related operations.
                            </p>
                        </li>
                    </ul>
                    <p>
                        The following shows a sample XForms logging session:
                    </p>
                    <pre class="ops-doc-code">
event - dispatching {name: "DOMFocusIn", id: "xforms-element-222", location: "line 28 of XFormsDOMFocusInEvent.java"}
  action - executing {action name: "setvalue"}
setvalue - setting instance value {value: "4", instance: "fr-form-instance"}
event - dispatching {name: "xforms-recalculate", id: "fr-form-model", location: "line 1895 of XFormsModel.java"}
  model - performing recalculate {model id: "fr-form-model"}
  model - done recalculating {time: "4"}
event - dispatching {name: "xforms-revalidate", id: "fr-form-model", location: "line 1900 of XFormsModel.java"}
  model - performing revalidate {model id: "fr-form-model"}
  model - done rebuilding {model id: "fr-form-model", time: "1"}
event - dispatching {name: "xforms-refresh", id: "fr-form-model", location: "line 1905 of XFormsModel.java"}
  model - performing refresh {model id: "fr-form-model"}
  controls - start building
    model - evaluated variables {count: "1"}
  controls - end building {time (ms): "22"}
  event - dispatching {name: "xforms-value-changed", id: "xforms-element-222", location: "line 27 of XFormsValueChangeEvent.java"}
    action - executing {action name: "setvalue"}
      setvalue - setting instance value {value: "dirty", instance: "fr-persistence-instance"}
  event - dispatching {name: "xforms-valid", id: "xforms-element-222", location: "line 27 of XFormsValidEvent.java"}
event - dispatching {name: "xforms-recalculate", id: "fr-persistence-model", location: "line 1895 of XFormsModel.java"}
  model - performing recalculate {model id: "fr-persistence-model"}
  model - done recalculating {time: "5"}
event - dispatching {name: "xforms-revalidate", id: "fr-persistence-model", location: "line 1900 of XFormsModel.java"}
  model - performing revalidate {model id: "fr-persistence-model"}
  model - done rebuilding {model id: "fr-persistence-model", time: "5"}
event - dispatching {name: "xforms-refresh", id: "fr-persistence-model", location: "line 1905 of XFormsModel.java"}
  model - performing refresh {model id: "fr-persistence-model"}
  controls - start building
    model - evaluated variables {count: "1"}
  controls - end building {time (ms): "9"}
  event - dispatching {name: "xforms-value-changed", id: "fr-data-status-input", location: "line 27 of XFormsValueChangeEvent.java"}
  event - dispatching {name: "xforms-valid", id: "fr-data-status-input", location: "line 27 of XFormsValidEvent.java"}
controls - evaluating controls
controls - done evaluating controls {time (ms): "4"}</pre>
                </section>
                <a name="xforms-instance-inspector"/>
                <section>
                    <title>The Instance Inspector</title>
                    <p>
                        The Instance Inspector allows you to visualize all the instances of your XForms page. You enable
                        it by adding the following within your XForms page's <code>xhtml:body</code> element, typically
                        just before closing that element:
                    </p>
                    <xml-source>
                        <xhtml:body>
                            ...
                            <widget:xforms-instance-inspector xmlns:widget="http://orbeon.org/oxf/xml/widget"/>
                        </xhtml:body>
                    </xml-source>
                    <p>
                        This is an example of how the Instance Inspector looks like in  your page:
                    </p>
                    <img src="../apps/doc/images/instance-inspector.png"/>
                    <p>
                        You can select which model and instand to view, and decide whether to see plain XML or formatted
                        XML.
                    </p>
                </section>
            </section>
        </section>
    </body>
</document>
