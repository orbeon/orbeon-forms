<!--
  Copyright (C) 2010 Orbeon, Inc.

  This program is free software; you can redistribute it and/or modify it under the terms of the
  GNU Lesser General Public License as published by the Free Software Foundation; either version
  2.1 of the License, or (at your option) any later version.

  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
  See the GNU Lesser General Public License for more details.

  The full text of the license is available at http://www.gnu.org/copyleft/lesser.html
  -->
<group description="XForms Validation" xmlns:p="http://www.orbeon.com/oxf/pipeline"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:xh="http://www.w3.org/1999/xhtml"
    xmlns:oxf="http://www.orbeon.com/oxf/processors"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xxi="http://orbeon.org/oxf/xml/xinclude"
    xmlns:xf="http://www.w3.org/2002/xforms"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:xbl="http://www.w3.org/ns/xbl"
    xmlns:fr="http://orbeon.org/oxf/xml/form-runner">

    <test description="Schema validation with type deriving from simple type" name="oxf:pipeline">
        <!-- See http://forge.ow2.org/tracker/index.php?func=detail&aid=308399&group_id=168&atid=350207 -->
        <input name="config" href="wrap-xforms-state.xpl"/>
        <input name="document">
            <xh:html xmlns:xxf="http://orbeon.org/oxf/xml/xforms">
                <xh:head>
                    <xf:model id="model">
                        <xf:instance id="instance">
                            <values>
                                <value code="1">One</value>
                                <value code="3"/>
                                <value code="">Five</value>
                                <value code="7">Seven</value>
                            </values>
                        </xf:instance>

                        <xs:schema attributeFormDefault="unqualified" elementFormDefault="qualified">

                            <xs:element name="value" type="myValueType"/>

                            <xs:complexType name="myValueType">
                                <xs:simpleContent>
                                    <xs:restriction base="xs:string">
                                        <xs:minLength value="1"/>
                                        <xs:attribute name="code" type="xs:integer" use="required"/>
                                    </xs:restriction>
                                </xs:simpleContent>
                            </xs:complexType>
                        </xs:schema>
                    </xf:model>
                </xh:head>
                <xh:body>
                    <xf:input ref="value[1]"/>
                    <xf:input ref="value[2]"/>
                    <xf:input ref="value[3]"/>
                    <xf:input ref="value[4]"/>
                </xh:body>
            </xh:html>
        </input>
        <output name="response">
            <xxf:event-response xmlns:xxf="http://orbeon.org/oxf/xml/xforms">
                <xxf:dynamic-state>
                    <dynamic-state/>
                </xxf:dynamic-state>
                <xxf:action>
                    <xxf:control-values>
                        <xxf:value id="xf-1">One</xxf:value>
                        <xxf:control id="xf-2" level="error"/><xxf:value id="xf-2"/>
                        <xxf:value id="xf-3">Five</xxf:value>
                        <xxf:value id="xf-4">Seven</xxf:value>
                    </xxf:control-values>
                </xxf:action>
            </xxf:event-response>
        </output>
    </test>

    <test description="Schema validation with union" name="oxf:pipeline">
        <input name="config" href="wrap-xforms-state.xpl"/>
        <input name="document">
            <xh:html xmlns:xxf="http://orbeon.org/oxf/xml/xforms">
                <xh:head>
                    <xf:model id="model">
                        <xf:instance id="instance">
                            <values>
                                <value>2009</value>
                                <value>2009-03</value>
                                <value>2009-03-09</value>
                                <value>2009-13</value>
                                <value>2009-03-32</value>
                            </values>
                        </xf:instance>

                        <xf:bind ref="value" type="uwdcdate"/>

                        <xs:schema attributeFormDefault="unqualified" elementFormDefault="qualified">
                            <xs:simpleType name="uwdcdate">
                                <xs:union memberTypes="xs:gYear xs:gYearMonth xs:date"/>
                            </xs:simpleType>
                        </xs:schema>
                    </xf:model>
                </xh:head>
                <xh:body>
                    <xf:input ref="value[1]"/>
                    <xf:input ref="value[2]"/>
                    <xf:input ref="value[3]"/>
                    <xf:input ref="value[4]"/>
                    <xf:input ref="value[5]"/>
                </xh:body>
            </xh:html>
        </input>
        <output name="response">
            <xxf:event-response xmlns:xxf="http://orbeon.org/oxf/xml/xforms">
                <xxf:dynamic-state>
                    <dynamic-state/>
                </xxf:dynamic-state>
                <xxf:action>
                    <xxf:control-values>
                        <xxf:control id="xf-2" type="uwdcdate"/><xxf:value id="xf-2">2009</xxf:value>
                        <xxf:control id="xf-3" type="uwdcdate"/><xxf:value id="xf-3">2009-03</xxf:value>
                        <xxf:control id="xf-4" type="uwdcdate"/><xxf:value id="xf-4">2009-03-09</xxf:value>
                        <xxf:control id="xf-5" level="error" type="uwdcdate"/><xxf:value id="xf-5">2009-13</xxf:value>
                        <xxf:control id="xf-6" level="error" type="uwdcdate"/><xxf:value id="xf-6">2009-03-32</xxf:value>
                    </xxf:control-values>
                </xxf:action>
            </xxf:event-response>
        </output>
    </test>

</group>
