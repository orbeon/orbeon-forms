<?xml version="1.0" encoding="UTF-8"?>
<infinispan
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="urn:infinispan:config:14.0 https://infinispan.org/schemas/infinispan-config-14.0.xsd"
    xmlns="urn:infinispan:config:14.0">

    <cache-container name="orbeon-container" statistics="false">
        <!-- ORBEON: This uses port 7800 "for its JGroups cluster transport" by default. -->
        <transport cluster="orbeon-cluster" stack="tcp"/>

        <serialization marshaller="org.infinispan.commons.marshall.JavaSerializationMarshaller">
          <allow-list>
              <class>org.orbeon.oxf.xforms.state.DynamicState</class>
              <regex>scala.*</regex>
          </allow-list>
        </serialization>

        <global-state>
            <persistent-location path="orbeon/cache" relative-to="orbeon.webapp.tmpdir"/>
        </global-state>

        <!-- XForms state store -->
        <replicated-cache name="xforms.state">
            <persistence passivation="true">
                <file-store purge="true" path="xforms.state" shared="false">
                    <write-behind modification-queue-size="1024" />
                </file-store>
            </persistence>
            <memory max-count="1" when-full="REMOVE"/>
        </replicated-cache>

        <!-- XForms resources store -->
        <replicated-cache name="xforms.resources">
            <memory max-count="200" when-full="REMOVE"/>
        </replicated-cache>

        <!-- External mode store -->
        <replicated-cache name="form-runner.external-mode-store">
            <expiration lifespan="960000" interval="120000"/>
            <memory max-count="200" when-full="REMOVE"/>
        </replicated-cache>

        <!-- Form Runner form definition cache -->
        <local-cache name="form-runner.persistence.form-definition">
            <expiration lifespan="300000" interval="120000"/>
            <memory max-count="10" when-full="REMOVE"/>
        </local-cache>

        <local-cache name="orbeon.properties">
            <memory max-count="50" when-full="REMOVE"/>
        </local-cache>

    </cache-container>
</infinispan>
